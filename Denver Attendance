i have run this Query and it Works but we got Wrong data 
like i have review many door have clearance count is more than 2 but here dispplay only 1 count ..
also only few door display clearance details but 90% door display null clerance it is not possible

need t  to fix 

i have upload Schema details and frotend details kindly review each column carefully and fix the issue 


USE [ACVSUJournal_00010021];
GO

SET NOCOUNT ON;

-- Door + Clearance aggregated details
SELECT
  D.ObjectID                 AS DoorObjectID,
  D.Name                     AS DoorName,
  D.GUID                     AS DoorGUID,
  D.ControllerID             AS ControllerID,

  clr.ClearanceCount         AS [Clearance Count],
  clr.ClearanceNames         AS [Clearance Details],       -- concatenated Clearance.Name
  clr.ClearanceDescriptions  AS [Clearance Descriptions],  -- concatenated Clearance.Description
  clr.LatestClearanceTime    AS [Last Modified Time],
  op.Name                    AS [Last Modified By]

FROM ACVSCore.Access.Door D

OUTER APPLY (
    -- Aggregate clearances for this door (assumes Clearance.ObjectID = Door.ObjectID)
    SELECT
      COUNT(1) AS ClearanceCount,

      -- concatenated clearance names (comma separated)
      STUFF((
        SELECT ', ' + ISNULL(C2.Name,'')
        FROM ACVSCore.Access.Clearance C2
        WHERE C2.ObjectID = D.ObjectID
        FOR XML PATH(''), TYPE
      ).value('.', 'NVARCHAR(MAX)'), 1, 2, '') AS ClearanceNames,

      -- concatenated clearance descriptions (semicolon separated to avoid comma collisions)
      STUFF((
        SELECT '; ' + ISNULL(C2.Description,'')
        FROM ACVSCore.Access.Clearance C2
        WHERE C2.ObjectID = D.ObjectID
        FOR XML PATH(''), TYPE
      ).value('.', 'NVARCHAR(MAX)'), 1, 2, '') AS ClearanceDescriptions,

      -- latest LastModifiedTime for clearances on this door
      (SELECT TOP(1) C3.LastModifiedTime
       FROM ACVSCore.Access.Clearance C3
       WHERE C3.ObjectID = D.ObjectID
       ORDER BY C3.LastModifiedTime DESC
      ) AS LatestClearanceTime,

      -- LastModifiedByID from the most recent clearance row
      (SELECT TOP(1) C4.LastModifiedByID
       FROM ACVSCore.Access.Clearance C4
       WHERE C4.ObjectID = D.ObjectID
       ORDER BY C4.LastModifiedTime DESC
      ) AS LastModifiedByID
) clr

LEFT JOIN ACVSCore.Access.Personnel op
  ON op.ObjectID = clr.LastModifiedByID

ORDER BY D.Name;
GO

