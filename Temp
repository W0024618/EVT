Once Check API Responce then Update file and Give me Fully Updted file carefully...

http://10.199.22.57:3008/api/occupancy/history
{
  "success": true,
  "summaryByDate": [
    {
      "date": "2025-08-20",
      "day": "Wednesday",
      "region": {
        "name": "APAC",
        "total": 1402,
        "Employee": 1244,
        "Contractor": 158
      },
      "partitions": {
        "Pune": {
          "total": 1026,
          "Employee": 914,
          "Contractor": 112
        },
        "Quezon City": {
          "total": 335,
          "Employee": 296,
          "Contractor": 39
        },
        "Taguig City": {
          "total": 26,
          "Employee": 21,
          "Contractor": 5
        },
        "JP.Tokyo": {
          "total": 8,
          "Employee": 7,
          "Contractor": 1
        },
        "MY.Kuala Lumpur": {
          "total": 7,
          "Employee": 6,
          "Contractor": 1
        }
      }
    },
    {
      "date": "2025-08-21",
      "day": "Thursday",
      "region": {
        "name": "APAC",
        "total": 1199,
        "Employee": 1052,
        "Contractor": 147
      },
      "partitions": {
        "Quezon City": {
          "total": 283,
          "Employee": 245,
          "Contractor": 38
        },
        "Pune": {
          "total": 901,
          "Employee": 794,
          "Contractor": 107
        },
        "JP.Tokyo": {
          "total": 9,
          "Employee": 8,
          "Contractor": 1
        },
        "MY.Kuala Lumpur": {
          "total": 6,
          "Employee": 5,
          "Contractor": 1
        }
      }
    },
    {
      "date": "2025-08-22",
      "day": "Friday",
      "region": {
        "name": "APAC",
        "total": 713,
        "Employee": 575,
        "Contractor": 138
      },
      "partitions": {
        "Quezon City": {
          "total": 230,
          "Employee": 187,
          "Contractor": 43
        },
        "Pune": {
          "total": 469,
          "Employee": 377,
          "Contractor": 92
        },
        "MY.Kuala Lumpur": {
          "total": 3,
          "Employee": 2,
          "Contractor": 1
        },
        "JP.Tokyo": {
          "total": 9,
          "Employee": 8,
          "Contractor": 1
        },
        "Taguig City": {
          "total": 2,
          "Employee": 1,
          "Contractor": 1
        }
      }
    },
    {
      "date": "2025-08-23",
      "day": "Saturday",
      "region": {
        "name": "APAC",
        "total": 180,
        "Employee": 102,
        "Contractor": 78
      },
      "partitions": {
        "Quezon City": {
          "total": 136,
          "Employee": 100,
          "Contractor": 36
        },
        "Pune": {
          "total": 42,
          "Employee": 1,
          "Contractor": 41
        },
        "JP.Tokyo": {
          "total": 1,
          "Employee": 1,
          "Contractor": 0
        },
        "Taguig City": {
          "total": 1,
          "Employee": 0,
          "Contractor": 1
        }
      }
    },
    {
      "date": "2025-08-24",
      "day": "Sunday",
      "region": {
        "name": "APAC",
        "total": 140,
        "Employee": 58,
        "Contractor": 82
      },
      "partitions": {
        "Quezon City": {
          "total": 91,
          "Employee": 56,
          "Contractor": 35
        },
        "Pune": {
          "total": 48,
          "Employee": 1,
          "Contractor": 47
        },
        "JP.Tokyo": {
          "total": 1,
          "Employee": 1,
          "Contractor": 0
        }
      }
    },
    {
      "date": "2025-08-25",
      "day": "Monday",
      "region": {
        "name": "APAC",
        "total": 1080,
        "Employee": 929,
        "Contractor": 151
      },
      "partitions": {
        "Quezon City": {
          "total": 136,
          "Employee": 103,
          "Contractor": 33
        },
        "Pune": {
          "total": 929,
          "Employee": 813,
          "Contractor": 116
        },
        "JP.Tokyo": {
          "total": 9,
          "Employee": 8,
          "Contractor": 1
        },
        "MY.Kuala Lumpur": {
          "total": 6,
          "Employee": 5,
          "Contractor": 1
        }
      }
    },
    {
      "date": "2025-08-26",
      "day": "Tuesday",
      "region": {
        "name": "APAC",
        "total": 1172,
        "Employee": 1022,
        "Contractor": 150
      },
      "partitions": {
        "Quezon City": {
          "total": 292,
          "Employee": 251,
          "Contractor": 41
        },
        "Pune": {
          "total": 852,
          "Employee": 747,
          "Contractor": 105
        },
        "MY.Kuala Lumpur": {
          "total": 3,
          "Employee": 2,
          "Contractor": 1
        },
        "Taguig City": {
          "total": 15,
          "Employee": 13,
          "Contractor": 2
        },
        "JP.Tokyo": {
          "total": 10,
          "Employee": 9,
          "Contractor": 1
        }
      }
    },
    {
      "date": "2025-08-27",
      "day": "Wednesday",
      "region": {
        "name": "APAC",
        "total": 470,
        "Employee": 372,
        "Contractor": 98
      },
      "partitions": {
        "Quezon City": {
          "total": 384,
          "Employee": 344,
          "Contractor": 40
        },
        "Pune": {
          "total": 56,
          "Employee": 2,
          "Contractor": 54
        },
        "JP.Tokyo": {
          "total": 9,
          "Employee": 8,
          "Contractor": 1
        },
        "Taguig City": {
          "total": 16,
          "Employee": 14,
          "Contractor": 2
        },
        "MY.Kuala Lumpur": {
          "total": 5,
          "Employee": 4,
          "Contractor": 1
        }
      }
    },
    {
      "date": "2025-08-28",
      "day": "Thursday",
      "region": {
        "name": "APAC",
        "total": 1227,
        "Employee": 1085,
        "Contractor": 142
      },
      "partitions": {
        "Quezon City": {
          "total": 380,
          "Employee": 338,
          "Contractor": 42
        },
        "Pune": {
          "total": 817,
          "Employee": 721,
          "Contractor": 96
        },
        "Taguig City": {
          "total": 15,
          "Employee": 13,
          "Contractor": 2
        },
        "MY.Kuala Lumpur": {
          "total": 6,
          "Employee": 5,
          "Contractor": 1
        },
        "JP.Tokyo": {
          "total": 9,
          "Employee": 8,
          "Contractor": 1
        }
      }
    },
    {
      "date": "2025-08-29",
      "day": "Friday",
      "region": {
        "name": "APAC",
        "total": 852,
        "Employee": 717,
        "Contractor": 135
      },
      "partitions": {
        "Quezon City": {
          "total": 274,
          "Employee": 235,
          "Contractor": 39
        },
        "Pune": {
          "total": 554,
          "Employee": 462,
          "Contractor": 92
        },
        "Taguig City": {
          "total": 16,
          "Employee": 14,
          "Contractor": 2
        },
        "JP.Tokyo": {
          "total": 7,
          "Employee": 6,
          "Contractor": 1
        },
        "MY.Kuala Lumpur": {
          "total": 1,
          "Employee": 0,
          "Contractor": 1
        }
      }
    },
    {
      "date": "2025-08-30",
      "day": "Saturday",
      "region": {
        "name": "APAC",
        "total": 183,
        "Employee": 104,
        "Contractor": 79
      },
      "partitions": {
        "Quezon City": {
          "total": 137,
          "Employee": 102,
          "Contractor": 35
        },
        "Pune": {
          "total": 46,
          "Employee": 2,
          "Contractor": 44
        }
      }
    },
    {
      "date": "2025-08-31",
      "day": "Sunday",
      "region": {
        "name": "APAC",
        "total": 140,
        "Employee": 58,
        "Contractor": 82
      },
      "partitions": {
        "Quezon City": {
          "total": 90,
          "Employee": 58,
          "Contractor": 32
        },
        "Pune": {
          "total": 50,
          "Employee": 0,
          "Contractor": 50
        }
      }
    },
    {
      "date": "2025-09-01",
      "day": "Monday",
      "region": {
        "name": "APAC",
        "total": 980,
        "Employee": 827,
        "Contractor": 153
      },
      "partitions": {
        "Pune": {
          "total": 731,
          "Employee": 625,
          "Contractor": 106
        },
        "Quezon City": {
          "total": 229,
          "Employee": 186,
          "Contractor": 43
        },
        "Taguig City": {
          "total": 12,
          "Employee": 9,
          "Contractor": 3
        },
        "JP.Tokyo": {
          "total": 8,
          "Employee": 7,
          "Contractor": 1
        }
      }
    },
    {
      "date": "2025-09-02",
      "day": "Tuesday",
      "region": {
        "name": "APAC",
        "total": 1165,
        "Employee": 1009,
        "Contractor": 156
      },
      "partitions": {
        "Quezon City": {
          "total": 270,
          "Employee": 233,
          "Contractor": 37
        },
        "Pune": {
          "total": 858,
          "Employee": 746,
          "Contractor": 112
        },
        "MY.Kuala Lumpur": {
          "total": 6,
          "Employee": 3,
          "Contractor": 3
        },
        "JP.Tokyo": {
          "total": 11,
          "Employee": 10,
          "Contractor": 1
        },
        "Taguig City": {
          "total": 20,
          "Employee": 17,
          "Contractor": 3
        }
      }
    }
  ],
  "details": [
    {
      "LocaleMessageTime": "2025-08-20T01:33:27.000Z",
      "ObjectName1": "Gavle, Pravin",
      "Door": "APAC_IN_PUN_PODIUM_ST3 DOOR 2 (GREEN)",
      "EmployeeID": "",
      "PersonnelType": "Property Management",
      "PersonGUID": "B355CB5B-BE42-4071-85BA-01438F3E4CC7",
      "CompanyName": "Poona Security India Pvt.Ltd",
      "PrimaryLocation": "Business Bay - Pune",
      "PartitionNameFriendly": "Pune",
      "CardNumber": "410369",
      "Direction": "InDirection"
    },
    {
      "LocaleMessageTime": "2025-08-20T01:57:01.000Z",
      "ObjectName1": "Paste, Vrutik",
      "Door": "APAC_IN_PUN_PODIUM_GSOC DOOR Restricted door",
      "EmployeeID": "W0019061",
      "PersonnelType": "Contractor",
      "PersonGUID": "40D0E1B5-6EDB-4CEB-A5DA-E51DD3E2380D",
      "CompanyName": "Poona Security India Pvt.Ltd",
      "PrimaryLocation": "Pune - Business Bay",
      "PartitionNameFriendly": "Pune",
      "CardNumber": "615830",
      "Direction": "InDirection"
    },
    {
      "LocaleMessageTime": "2025-08-20T02:02:03.000Z",
      "ObjectName1": "Kamble, Babasaheb",
      "Door": "APAC_IN_PUN_PODIUM_YELLOW_MDF Restricted Door",
      "EmployeeID": "W0021569",
      "PersonnelType": "Contractor",
      "PersonGUID": "23C94636-681A-424C-9E0C-F7AF8A0472B0",
      "CompanyName": "Vedant Enterprises Pvt. Ltd.",
      "PrimaryLocation": "Pune - Business Bay",
      "PartitionNameFriendly": "Pune",
      "CardNumber": "615768",
      "Direction": "InDirection"
    },
    {
      "LocaleMessageTime": "2025-08-20T02:04:37.000Z",
      "ObjectName1": "Chavan, Jairam",
      "Door": "APAC_IN_PUN_TOWER B_MAIN RECEPTION DOOR",
      "EmployeeID": "",
      "PersonnelType": "Property Management",
      "PersonGUID": "DA313E78-54C7-40A4-A10C-D18E71C6E4B3",
      "CompanyName": "Poona Security India Pvt. Ltd",
      "PrimaryLocation": "Business Bay - Pune",
      "PartitionNameFriendly": "Pune",
      "CardNumber": "413837",
      "Direction": "OutDirection"
    },







http://10.199.22.57:3006/api/occupancy/history


{
  "success": true,
  "summaryByDate": [
    {
      "date": "2025-08-17",
      "day": "Sunday",
      "region": {
        "name": "NAMER",
        "total": 5,
        "Employee": 3,
        "Contractor": 2
      },
      "partitions": {
        "US.CO.OBS": {
          "total": 5,
          "Employee": 3,
          "Contractor": 2
        }
      }
    },
    {
      "date": "2025-08-18",
      "day": "Monday",
      "region": {
        "name": "NAMER",
        "total": 630,
        "Employee": 573,
        "Contractor": 57
      },
      "partitions": {
        "US.CO.OBS": {
          "total": 529,
          "Employee": 477,
          "Contractor": 52
        },
        "US.FL.Miami": {
          "total": 18,
          "Employee": 17,
          "Contractor": 1
        },
        "USA/Canada Default": {
          "total": 47,
          "Employee": 44,
          "Contractor": 3
        },
        "US.NYC": {
          "total": 36,
          "Employee": 35,
          "Contractor": 1
        }
      }
    },
    {
      "date": "2025-08-19",
      "day": "Tuesday",
      "region": {
        "name": "NAMER",
        "total": 746,
        "Employee": 690,
        "Contractor": 56
      },
      "partitions": {
        "US.CO.OBS": {
          "total": 625,
          "Employee": 576,
          "Contractor": 49
        },
        "US.FL.Miami": {
          "total": 29,
          "Employee": 26,
          "Contractor": 3
        },
        "USA/Canada Default": {
          "total": 52,
          "Employee": 49,
          "Contractor": 3
        },
        "US.NYC": {
          "total": 40,
          "Employee": 39,
          "Contractor": 1
        }
      }
    },
    {
      "date": "2025-08-20",
      "day": "Wednesday",
      "region": {
        "name": "NAMER",
        "total": 799,
        "Employee": 734,
        "Contractor": 65
      },
      "partitions": {
        "US.CO.OBS": {
          "total": 667,
          "Employee": 608,
          "Contractor": 59
        },
        "US.FL.Miami": {
          "total": 29,
          "Employee": 27,
          "Contractor": 2
        },
        "USA/Canada Default": {
          "total": 67,
          "Employee": 64,
          "Contractor": 3
        },
        "US.NYC": {
          "total": 36,
          "Employee": 35,
          "Contractor": 1
        }
      }
    },
    {
      "date": "2025-08-21",
      "day": "Thursday",
      "region": {
        "name": "NAMER",
        "total": 574,
        "Employee": 524,
        "Contractor": 50
      },
      "partitions": {
        "US.CO.OBS": {
          "total": 487,
          "Employee": 444,
          "Contractor": 43
        },
        "US.FL.Miami": {
          "total": 23,
          "Employee": 20,
          "Contractor": 3
        },
        "USA/Canada Default": {
          "total": 35,
          "Employee": 32,
          "Contractor": 3
        },
        "US.NYC": {
          "total": 29,
          "Employee": 28,
          "Contractor": 1
        }
      }
    },
    {
      "date": "2025-08-22",
      "day": "Friday",
      "region": {
        "name": "NAMER",
        "total": 350,
        "Employee": 311,
        "Contractor": 39
      },
      "partitions": {
        "US.CO.OBS": {
          "total": 297,
          "Employee": 264,
          "Contractor": 33
        },
        "US.FL.Miami": {
          "total": 12,
          "Employee": 10,
          "Contractor": 2
        },
        "USA/Canada Default": {
          "total": 28,
          "Employee": 25,
          "Contractor": 3
        },
        "US.NYC": {
          "total": 13,
          "Employee": 12,
          "Contractor": 1
        }
      }
    },
    {
      "date": "2025-08-23",
      "day": "Saturday",
      "region": {
        "name": "NAMER",
        "total": 12,
        "Employee": 1,
        "Contractor": 11
      },
      "partitions": {
        "US.CO.OBS": {
          "total": 11,
          "Employee": 0,
          "Contractor": 11
        },
        "USA/Canada Default": {
          "total": 1,
          "Employee": 1,
          "Contractor": 0
        }
      }
    },
    {
      "date": "2025-08-24",
      "day": "Sunday",
      "region": {
        "name": "NAMER",
        "total": 5,
        "Employee": 3,
        "Contractor": 2
      },
      "partitions": {
        "US.CO.OBS": {
          "total": 3,
          "Employee": 1,
          "Contractor": 2
        },
        "US.NYC": {
          "total": 1,
          "Employee": 1,
          "Contractor": 0
        },
        "USA/Canada Default": {
          "total": 1,
          "Employee": 1,
          "Contractor": 0
        }
      }
    },
    {
      "date": "2025-08-25",
      "day": "Monday",
      "region": {
        "name": "NAMER",
        "total": 624,
        "Employee": 575,
        "Contractor": 49
      },
      "partitions": {
        "US.CO.OBS": {
          "total": 517,
          "Employee": 475,
          "Contractor": 42
        },
        "USA/Canada Default": {
          "total": 55,
          "Employee": 52,
          "Contractor": 3
        },
        "US.FL.Miami": {
          "total": 22,
          "Employee": 19,
          "Contractor": 3
        },
        "US.NYC": {
          "total": 30,
          "Employee": 29,
          "Contractor": 1
        }
      }
    },
    {
      "date": "2025-08-26",
      "day": "Tuesday",
      "region": {
        "name": "NAMER",
        "total": 735,
        "Employee": 689,
        "Contractor": 46
      },
      "partitions": {
        "US.CO.OBS": {
          "total": 624,
          "Employee": 585,
          "Contractor": 39
        },
        "USA/Canada Default": {
          "total": 51,
          "Employee": 48,
          "Contractor": 3
        },
        "US.FL.Miami": {
          "total": 25,
          "Employee": 22,
          "Contractor": 3
        },
        "US.NYC": {
          "total": 35,
          "Employee": 34,
          "Contractor": 1
        }
      }
    },
    {
      "date": "2025-08-27",
      "day": "Wednesday",
      "region": {
        "name": "NAMER",
        "total": 798,
        "Employee": 732,
        "Contractor": 66
      },
      "partitions": {
        "US.CO.OBS": {
          "total": 670,
          "Employee": 610,
          "Contractor": 60
        },
        "US.FL.Miami": {
          "total": 32,
          "Employee": 30,
          "Contractor": 2
        },
        "USA/Canada Default": {
          "total": 57,
          "Employee": 54,
          "Contractor": 3
        },
        "US.NYC": {
          "total": 39,
          "Employee": 38,
          "Contractor": 1
        }
      }
    },
    {
      "date": "2025-08-28",
      "day": "Thursday",
      "region": {
        "name": "NAMER",
        "total": 571,
        "Employee": 523,
        "Contractor": 48
      },
      "partitions": {
        "US.CO.OBS": {
          "total": 493,
          "Employee": 451,
          "Contractor": 42
        },
        "US.FL.Miami": {
          "total": 15,
          "Employee": 13,
          "Contractor": 2
        },
        "USA/Canada Default": {
          "total": 42,
          "Employee": 39,
          "Contractor": 3
        },
        "US.NYC": {
          "total": 21,
          "Employee": 20,
          "Contractor": 1
        }
      }
    },
    {
      "date": "2025-08-29",
      "day": "Friday",
      "region": {
        "name": "NAMER",
        "total": 303,
        "Employee": 259,
        "Contractor": 44
      },
      "partitions": {
        "US.CO.OBS": {
          "total": 248,
          "Employee": 210,
          "Contractor": 38
        },
        "US.FL.Miami": {
          "total": 11,
          "Employee": 10,
          "Contractor": 1
        },
        "USA/Canada Default": {
          "total": 30,
          "Employee": 26,
          "Contractor": 4
        },
        "US.NYC": {
          "total": 14,
          "Employee": 13,
          "Contractor": 1
        }
      }
    },
    {
      "date": "2025-08-30",
      "day": "Saturday",
      "region": {
        "name": "NAMER",
        "total": 9,
        "Employee": 4,
        "Contractor": 5
      },
      "partitions": {
        "US.CO.OBS": {
          "total": 8,
          "Employee": 3,
          "Contractor": 5
        },
        "US.NYC": {
          "total": 1,
          "Employee": 1,
          "Contractor": 0
        }
      }
    },
    {
      "date": "2025-08-31",
      "day": "Sunday",
      "region": {
        "name": "NAMER",
        "total": 5,
        "Employee": 3,
        "Contractor": 2
      },
      "partitions": {
        "US.CO.OBS": {
          "total": 5,
          "Employee": 3,
          "Contractor": 2
        }
      }
    },
    {
      "date": "2025-09-01",
      "day": "Monday",
      "region": {
        "name": "NAMER",
        "total": 8,
        "Employee": 5,
        "Contractor": 3
      },
      "partitions": {
        "US.CO.OBS": {
          "total": 8,
          "Employee": 5,
          "Contractor": 3
        }
      }
    },
    {
      "date": "2025-09-02",
      "day": "Tuesday",
      "region": {
        "name": "NAMER",
        "total": 1,
        "Employee": 0,
        "Contractor": 1
      },
      "partitions": {
        "US.CO.OBS": {
          "total": 1,
          "Employee": 0,
          "Contractor": 1
        }
      }
    }
  ],
  "details": [
    {
      "LocaleMessageTime": "2025-08-17T02:18:54.000Z",
      "ObjectName1": "Dean, Taje",
      "Door": "US.CO.HQ. 09. IDF Room_11:00:98 Restricted Door",
      "EmployeeID": "W0026151",
      "CardNumber": "617976",
      "PartitionName2": "US.CO.OBS",
      "PersonGUID": "5EC24130-835B-4D6F-8CFC-E9C2B1993F4B",
      "PersonnelType": "Contractor",
      "Direction": "InDirection"
    },
    {
      "LocaleMessageTime": "2025-08-17T06:15:31.000Z",
      "ObjectName1": "Silvestre, Martha",
      "Door": "US.CO.HQ. 09. North Lobby Doors-IN",
      "EmployeeID": "302421",
      "CardNumber": "613622",
      "PartitionName2": "US.CO.OBS",
      "PersonGUID": "5AF79981-14D9-4467-A8F7-FCDDD28A08AB",
      "PersonnelType": "Employee",
      "Direction": "InDirection"
    },
    {
      "LocaleMessageTime": "2025-08-17T14:02:42.000Z",
      "ObjectName1": "Barcelona, Aishah",
      "Door": "US.CO.HQ. 01. Focus Area West-IN",
      "EmployeeID": "W0026149",
      "CardNumber": "618944",
      "PartitionName2": "US.CO.OBS",
      "PersonGUID": "3660778A-1F90-4B7D-B7D8-53995AC4CB7F",
      "PersonnelType": "Terminated Contractor",
      "Direction": "InDirection"
    },
    {
      "LocaleMessageTime": "2025-08-17T15:03:40.000Z",
      "ObjectName1": "Nataraja, Akshay",
      "Door": "US.CO.HQ. 12. North Lobby Doors-IN",
      "EmployeeID": "328794",
      "CardNumber": "618190",
      "PartitionName2": "US.CO.OBS",
      "PersonGUID": "0789101D-A5E5-411B-82F3-8D9C259DC326",
      "PersonnelType": "Employee",
      "Direction": "InDirection"
    },
    {
      "LocaleMessageTime": "2025-08-17T17:44:38.000Z",
      "ObjectName1": "Carlson, William",
      "Door": "US.CO.HQ. 11. North Lobby Doors-IN",
      "EmployeeID": "320609",
      "CardNumber": "604004",
      "PartitionName2": "US.CO.OBS",
      "PersonGUID": "3C9D0580-D8CE-42D8-94B4-A2F5DFF176D9",
      "PersonnelType": "Terminated Personnel",
      "Direction": "InDirection"
    },
    {
      "LocaleMessageTime": "2025-08-18T00:40:33.000Z",
      "ObjectName1": "Dean, Taje",
      "Door": "US.CO.HQ. 01. Focus Area West-IN",
      "EmployeeID": "W0026151",
      "CardNumber": "617976",
      "PartitionName2": "US.CO.OBS",
      "PersonGUID": "5EC24130-835B-4D6F-8CFC-E9C2B1993F4B",
      "PersonnelType": "Contractor",
      "Direction": "InDirection"
    },
    {
      "LocaleMessageTime": "2025-08-18T03:51:03.000Z",
      "ObjectName1": "D'Nicuola, Jeff",
      "Door": "US.CO.HQ. 09. South Lobby Doors-IN",
      "EmployeeID": "305776",
      "CardNumber": "232397",
      "PartitionName2": "US.CO.OBS",
      "PersonGUID": "52B69EA4-1DD6-44A4-972A-EA2F87D2858E",
      "PersonnelType": "Employee",
      "Direction": "InDirection"
    },
    {
      "LocaleMessageTime": "2025-08-18T03:57:24.000Z",
      "ObjectName1": "Laird, Heather",
      "Door": "US.CO.HQ. 11. North Lobby Doors-IN",
      "EmployeeID": "301966",
      "CardNumber": "232962",
      "PartitionName2": "US.CO.OBS",
      "PersonGUID": "B0BF3506-A8A6-4A81-9D2F-6EDB5EF16924",
      "PersonnelType": "Employee",
      "Direction": "InDirection"
    },
    {
      "LocaleMessageTime": "2025-08-18T04:20:16.000Z",
      "ObjectName1": "Del Barco, Rene F",
      "Door": "US.CO.HQ. 09. North Lobby Doors-IN",
      "EmployeeID": "236001",
      "CardNumber": "608735",
      "PartitionName2": "US.CO.OBS",
      "PersonGUID": "E4443CC3-EC80-47A9-99E0-F470A967AE6E",
      "PersonnelType": "Employee",
      "Direction": "InDirection"
    },
    {
      "LocaleMessageTime": "2025-08-18T04:53:06.000Z",
      "ObjectName1": "Formento, Dennis",
      "Door": "US.CO.HQ. 13. North Lobby Doors-IN",
      "EmployeeID": "199599",
      "CardNumber": "231699",
      "PartitionName2": "US.CO.OBS",
      "PersonGUID": "2909F487-2D9B-4413-A230-EF5D02BA465A",
      "PersonnelType": "Employee",
      "Direction": "InDirection"
    },








http://10.199.22.57:3007/api/occupancy/history


{
  "success": true,
  "summaryByDate": [
    {
      "date": "2025-08-19",
      "day": "Tuesday",
      "region": {
        "name": "EMEA",
        "total": 750,
        "Employee": 707,
        "Contractor": 43
      },
      "partitions": {
        "IE.Dublin": {
          "total": 38,
          "Employee": 35,
          "Contractor": 3
        },
        "MA.Casablanca": {
          "total": 20,
          "Employee": 19,
          "Contractor": 1
        },
        "UK.London": {
          "total": 19,
          "Employee": 17,
          "Contractor": 2
        },
        "AUT.Vienna": {
          "total": 42,
          "Employee": 38,
          "Contractor": 4
        },
        "ES.Madrid": {
          "total": 47,
          "Employee": 44,
          "Contractor": 3
        },
        "IT.Rome": {
          "total": 18,
          "Employee": 17,
          "Contractor": 1
        },
        "LT.Vilnius": {
          "total": 528,
          "Employee": 500,
          "Contractor": 28
        },
        "DU.Abu Dhab": {
          "total": 32,
          "Employee": 31,
          "Contractor": 1
        },
        "RU.Moscow": {
          "total": 6,
          "Employee": 6,
          "Contractor": 0
        }
      }
    },
    {
      "date": "2025-08-20",
      "day": "Wednesday",
      "region": {
        "name": "EMEA",
        "total": 775,
        "Employee": 733,
        "Contractor": 42
      },
      "partitions": {
        "LT.Vilnius": {
          "total": 555,
          "Employee": 528,
          "Contractor": 27
        },
        "IE.Dublin": {
          "total": 38,
          "Employee": 35,
          "Contractor": 3
        },
        "AUT.Vienna": {
          "total": 46,
          "Employee": 42,
          "Contractor": 4
        },
        "ES.Madrid": {
          "total": 50,
          "Employee": 48,
          "Contractor": 2
        },
        "UK.London": {
          "total": 25,
          "Employee": 23,
          "Contractor": 2
        },
        "DU.Abu Dhab": {
          "total": 31,
          "Employee": 30,
          "Contractor": 1
        },
        "IT.Rome": {
          "total": 19,
          "Employee": 17,
          "Contractor": 2
        },
        "MA.Casablanca": {
          "total": 2,
          "Employee": 2,
          "Contractor": 0
        },
        "RU.Moscow": {
          "total": 9,
          "Employee": 8,
          "Contractor": 1
        }
      }
    },
    {
      "date": "2025-08-21",
      "day": "Thursday",
      "region": {
        "name": "EMEA",
        "total": 604,
        "Employee": 568,
        "Contractor": 36
      },
      "partitions": {
        "LT.Vilnius": {
          "total": 419,
          "Employee": 397,
          "Contractor": 22
        },
        "UK.London": {
          "total": 21,
          "Employee": 19,
          "Contractor": 2
        },
        "AUT.Vienna": {
          "total": 39,
          "Employee": 35,
          "Contractor": 4
        },
        "IE.Dublin": {
          "total": 24,
          "Employee": 22,
          "Contractor": 2
        },
        "ES.Madrid": {
          "total": 39,
          "Employee": 36,
          "Contractor": 3
        },
        "DU.Abu Dhab": {
          "total": 37,
          "Employee": 36,
          "Contractor": 1
        },
        "IT.Rome": {
          "total": 18,
          "Employee": 17,
          "Contractor": 1
        },
        "RU.Moscow": {
          "total": 7,
          "Employee": 6,
          "Contractor": 1
        }
      }
    },
    {
      "date": "2025-08-22",
      "day": "Friday",
      "region": {
        "name": "EMEA",
        "total": 383,
        "Employee": 349,
        "Contractor": 34
      },
      "partitions": {
        "LT.Vilnius": {
          "total": 253,
          "Employee": 234,
          "Contractor": 19
        },
        "MA.Casablanca": {
          "total": 12,
          "Employee": 11,
          "Contractor": 1
        },
        "AUT.Vienna": {
          "total": 22,
          "Employee": 20,
          "Contractor": 2
        },
        "IE.Dublin": {
          "total": 17,
          "Employee": 15,
          "Contractor": 2
        },
        "ES.Madrid": {
          "total": 24,
          "Employee": 21,
          "Contractor": 3
        },
        "UK.London": {
          "total": 15,
          "Employee": 13,
          "Contractor": 2
        },
        "IT.Rome": {
          "total": 13,
          "Employee": 11,
          "Contractor": 2
        },
        "DU.Abu Dhab": {
          "total": 21,
          "Employee": 20,
          "Contractor": 1
        },
        "RU.Moscow": {
          "total": 6,
          "Employee": 4,
          "Contractor": 2
        }
      }
    },
    {
      "date": "2025-08-23",
      "day": "Saturday",
      "region": {
        "name": "EMEA",
        "total": 39,
        "Employee": 34,
        "Contractor": 5
      },
      "partitions": {
        "LT.Vilnius": {
          "total": 34,
          "Employee": 31,
          "Contractor": 3
        },
        "AUT.Vienna": {
          "total": 2,
          "Employee": 2,
          "Contractor": 0
        },
        "IE.Dublin": {
          "total": 2,
          "Employee": 1,
          "Contractor": 1
        },
        "MA.Casablanca": {
          "total": 1,
          "Employee": 0,
          "Contractor": 1
        }
      }
    },
    {
      "date": "2025-08-24",
      "day": "Sunday",
      "region": {
        "name": "EMEA",
        "total": 28,
        "Employee": 23,
        "Contractor": 5
      },
      "partitions": {
        "LT.Vilnius": {
          "total": 23,
          "Employee": 20,
          "Contractor": 3
        },
        "AUT.Vienna": {
          "total": 2,
          "Employee": 2,
          "Contractor": 0
        },
        "IE.Dublin": {
          "total": 1,
          "Employee": 0,
          "Contractor": 1
        },
        "MA.Casablanca": {
          "total": 1,
          "Employee": 1,
          "Contractor": 0
        },
        "RU.Moscow": {
          "total": 1,
          "Employee": 0,
          "Contractor": 1
        }
      }
    },
    {
      "date": "2025-08-25",
      "day": "Monday",
      "region": {
        "name": "EMEA",
        "total": 612,
        "Employee": 569,
        "Contractor": 43
      },
      "partitions": {
        "LT.Vilnius": {
          "total": 407,
          "Employee": 380,
          "Contractor": 27
        },
        "MA.Casablanca": {
          "total": 19,
          "Employee": 18,
          "Contractor": 1
        },
        "IE.Dublin": {
          "total": 33,
          "Employee": 30,
          "Contractor": 3
        },
        "UK.London": {
          "total": 1,
          "Employee": 0,
          "Contractor": 1
        },
        "AUT.Vienna": {
          "total": 43,
          "Employee": 39,
          "Contractor": 4
        },
        "ES.Madrid": {
          "total": 46,
          "Employee": 43,
          "Contractor": 3
        },
        "IT.Rome": {
          "total": 22,
          "Employee": 21,
          "Contractor": 1
        },
        "DU.Abu Dhab": {
          "total": 34,
          "Employee": 33,
          "Contractor": 1
        },
        "RU.Moscow": {
          "total": 7,
          "Employee": 5,
          "Contractor": 2
        }
      }
    },
    {
      "date": "2025-08-26",
      "day": "Tuesday",
      "region": {
        "name": "EMEA",
        "total": 792,
        "Employee": 748,
        "Contractor": 44
      },
      "partitions": {
        "LT.Vilnius": {
          "total": 544,
          "Employee": 517,
          "Contractor": 27
        },
        "MA.Casablanca": {
          "total": 21,
          "Employee": 20,
          "Contractor": 1
        },
        "AUT.Vienna": {
          "total": 46,
          "Employee": 40,
          "Contractor": 6
        },
        "IE.Dublin": {
          "total": 37,
          "Employee": 35,
          "Contractor": 2
        },
        "ES.Madrid": {
          "total": 60,
          "Employee": 57,
          "Contractor": 3
        },
        "UK.London": {
          "total": 16,
          "Employee": 15,
          "Contractor": 1
        },
        "IT.Rome": {
          "total": 27,
          "Employee": 25,
          "Contractor": 2
        },
        "DU.Abu Dhab": {
          "total": 35,
          "Employee": 34,
          "Contractor": 1
        },
        "RU.Moscow": {
          "total": 6,
          "Employee": 5,
          "Contractor": 1
        }
      }
    },
    {
      "date": "2025-08-27",
      "day": "Wednesday",
      "region": {
        "name": "EMEA",
        "total": 847,
        "Employee": 800,
        "Contractor": 47
      },
      "partitions": {
        "LT.Vilnius": {
          "total": 567,
          "Employee": 542,
          "Contractor": 25
        },
        "MA.Casablanca": {
          "total": 23,
          "Employee": 22,
          "Contractor": 1
        },
        "AUT.Vienna": {
          "total": 60,
          "Employee": 53,
          "Contractor": 7
        },
        "IE.Dublin": {
          "total": 31,
          "Employee": 28,
          "Contractor": 3
        },
        "UK.London": {
          "total": 29,
          "Employee": 27,
          "Contractor": 2
        },
        "ES.Madrid": {
          "total": 67,
          "Employee": 64,
          "Contractor": 3
        },
        "IT.Rome": {
          "total": 27,
          "Employee": 25,
          "Contractor": 2
        },
        "DU.Abu Dhab": {
          "total": 35,
          "Employee": 33,
          "Contractor": 2
        },
        "RU.Moscow": {
          "total": 8,
          "Employee": 6,
          "Contractor": 2
        }
      }
    },
    {
      "date": "2025-08-28",
      "day": "Thursday",
      "region": {
        "name": "EMEA",
        "total": 652,
        "Employee": 614,
        "Contractor": 38
      },
      "partitions": {
        "LT.Vilnius": {
          "total": 426,
          "Employee": 405,
          "Contractor": 21
        },
        "UK.London": {
          "total": 28,
          "Employee": 26,
          "Contractor": 2
        },
        "MA.Casablanca": {
          "total": 17,
          "Employee": 16,
          "Contractor": 1
        },
        "AUT.Vienna": {
          "total": 50,
          "Employee": 45,
          "Contractor": 5
        },
        "IE.Dublin": {
          "total": 24,
          "Employee": 22,
          "Contractor": 2
        },
        "ES.Madrid": {
          "total": 43,
          "Employee": 40,
          "Contractor": 3
        },
        "DU.Abu Dhab": {
          "total": 35,
          "Employee": 34,
          "Contractor": 1
        },
        "IT.Rome": {
          "total": 19,
          "Employee": 18,
          "Contractor": 1
        },
        "RU.Moscow": {
          "total": 10,
          "Employee": 8,
          "Contractor": 2
        }
      }
    },
    {
      "date": "2025-08-29",
      "day": "Friday",
      "region": {
        "name": "EMEA",
        "total": 381,
        "Employee": 347,
        "Contractor": 34
      },
      "partitions": {
        "LT.Vilnius": {
          "total": 246,
          "Employee": 226,
          "Contractor": 20
        },
        "UK.London": {
          "total": 17,
          "Employee": 15,
          "Contractor": 2
        },
        "MA.Casablanca": {
          "total": 15,
          "Employee": 14,
          "Contractor": 1
        },
        "AUT.Vienna": {
          "total": 30,
          "Employee": 27,
          "Contractor": 3
        },
        "ES.Madrid": {
          "total": 17,
          "Employee": 15,
          "Contractor": 2
        },
        "DU.Abu Dhab": {
          "total": 20,
          "Employee": 19,
          "Contractor": 1
        },
        "IE.Dublin": {
          "total": 15,
          "Employee": 13,
          "Contractor": 2
        },
        "IT.Rome": {
          "total": 11,
          "Employee": 9,
          "Contractor": 2
        },
        "RU.Moscow": {
          "total": 10,
          "Employee": 9,
          "Contractor": 1
        }
      }
    },
    {
      "date": "2025-08-30",
      "day": "Saturday",
      "region": {
        "name": "EMEA",
        "total": 30,
        "Employee": 24,
        "Contractor": 6
      },
      "partitions": {
        "LT.Vilnius": {
          "total": 25,
          "Employee": 21,
          "Contractor": 4
        },
        "AUT.Vienna": {
          "total": 1,
          "Employee": 1,
          "Contractor": 0
        },
        "IE.Dublin": {
          "total": 1,
          "Employee": 1,
          "Contractor": 0
        },
        "MA.Casablanca": {
          "total": 2,
          "Employee": 1,
          "Contractor": 1
        },
        "RU.Moscow": {
          "total": 1,
          "Employee": 0,
          "Contractor": 1
        }
      }
    },
    {
      "date": "2025-08-31",
      "day": "Sunday",
      "region": {
        "name": "EMEA",
        "total": 32,
        "Employee": 25,
        "Contractor": 7
      },
      "partitions": {
        "LT.Vilnius": {
          "total": 28,
          "Employee": 23,
          "Contractor": 5
        },
        "IE.Dublin": {
          "total": 1,
          "Employee": 0,
          "Contractor": 1
        },
        "MA.Casablanca": {
          "total": 1,
          "Employee": 1,
          "Contractor": 0
        },
        "RU.Moscow": {
          "total": 1,
          "Employee": 1,
          "Contractor": 0
        },
        "UK.London": {
          "total": 1,
          "Employee": 0,
          "Contractor": 1
        }
      }
    },
    {
      "date": "2025-09-01",
      "day": "Monday",
      "region": {
        "name": "EMEA",
        "total": 585,
        "Employee": 545,
        "Contractor": 40
      },
      "partitions": {
        "LT.Vilnius": {
          "total": 354,
          "Employee": 330,
          "Contractor": 24
        },
        "UK.London": {
          "total": 22,
          "Employee": 21,
          "Contractor": 1
        },
        "MA.Casablanca": {
          "total": 21,
          "Employee": 20,
          "Contractor": 1
        },
        "AUT.Vienna": {
          "total": 44,
          "Employee": 39,
          "Contractor": 5
        },
        "IE.Dublin": {
          "total": 29,
          "Employee": 26,
          "Contractor": 3
        },
        "ES.Madrid": {
          "total": 42,
          "Employee": 40,
          "Contractor": 2
        },
        "IT.Rome": {
          "total": 27,
          "Employee": 25,
          "Contractor": 2
        },
        "DU.Abu Dhab": {
          "total": 37,
          "Employee": 36,
          "Contractor": 1
        },
        "RU.Moscow": {
          "total": 9,
          "Employee": 8,
          "Contractor": 1
        }
      }
    },
    {
      "date": "2025-09-02",
      "day": "Tuesday",
      "region": {
        "name": "EMEA",
        "total": 825,
        "Employee": 794,
        "Contractor": 31
      },
      "partitions": {
        "LT.Vilnius": {
          "total": 561,
          "Employee": 542,
          "Contractor": 19
        },
        "MA.Casablanca": {
          "total": 22,
          "Employee": 21,
          "Contractor": 1
        },
        "IE.Dublin": {
          "total": 35,
          "Employee": 34,
          "Contractor": 1
        },
        "AUT.Vienna": {
          "total": 49,
          "Employee": 45,
          "Contractor": 4
        },
        "IT.Rome": {
          "total": 26,
          "Employee": 24,
          "Contractor": 2
        },
        "UK.London": {
          "total": 26,
          "Employee": 26,
          "Contractor": 0
        },
        "ES.Madrid": {
          "total": 58,
          "Employee": 56,
          "Contractor": 2
        },
        "DU.Abu Dhab": {
          "total": 39,
          "Employee": 37,
          "Contractor": 2
        },
        "RU.Moscow": {
          "total": 9,
          "Employee": 9,
          "Contractor": 0
        }
      }
    }
  ],
  "details": [
    {
      "LocaleMessageTime": "2025-08-19T08:00:56.000Z",
      "ObjectName1": "Clark, Maria",
      "Door": "EMEA_IRE_DUB_Main Entrance",
      "EmployeeID": "313823",
      "Text5": "Dublin - The Loft, Dundrum Town Centre",
      "PartitionName2": "IE.Dublin",
      "PersonGUID": "C79FBFD7-28E4-4A02-8FF0-E8F312EEF3FE",
      "PersonnelType": "Employee",
      "CardNumber": "609142",
      "AdmitCode": "Admit",
      "Direction": "OutDirection",
      "SwipeDate": "2025-08-19T00:00:00.000Z"
    },
    {
      "LocaleMessageTime": "2025-08-19T08:01:29.000Z",
      "ObjectName1": "Kiernan, Jenny",
      "Door": "EMEA_IRE_DUB_Main Entrance",
      "EmployeeID": "307039",
      "Text5": "Dublin - The Loft, Dundrum Town Centre",
      "PartitionName2": "IE.Dublin",
      "PersonGUID": "5EED2402-EE3D-45CA-8C9C-26DDB15F0DA4",
      "PersonnelType": "Employee",
      "CardNumber": "421876",
      "AdmitCode": "Admit",
      "Direction": "InDirection",
      "SwipeDate": "2025-08-19T00:00:00.000Z"
    },
    {
      "LocaleMessageTime": "2025-08-19T08:01:33.000Z",
      "ObjectName1": "Barroug, Jamila",
      "Door": "EMEA_MOR_CASA_07_01_Main Entrance",
      "EmployeeID": "320566",
      "Text5": "Casablanca - 1100 Boulevard Al",
      "PartitionName2": "MA.Casablanca",
      "PersonGUID": "7F658171-98FE-4D73-B457-04B3AEF2E042",
      "PersonnelType": "Employee",
      "CardNumber": "602552",
      "AdmitCode": "Admit",
      "Direction": "InDirection",
      "SwipeDate": "2025-08-19T00:00:00.000Z"
    },
    {
      "LocaleMessageTime": "2025-08-19T08:06:38.000Z",
      "ObjectName1": "Anandita, Edwina Fiqhe",
      "Door": "EMEA_IRE_DUB_Main Entrance",
      "EmployeeID": "328211",
      "Text5": "Dublin - The Loft, Dundrum Town Centre",
      "PartitionName2": "IE.Dublin",
      "PersonGUID": "B3635077-2C01-4FC5-8701-0FCC3AC63965",
      "PersonnelType": "Employee",
      "CardNumber": "619081",
      "AdmitCode": "Admit",
      "Direction": "InDirection",
      "SwipeDate": "2025-08-19T00:00:00.000Z"
    },
    {
      "LocaleMessageTime": "2025-08-19T08:06:59.000Z",
      "ObjectName1": "Marhaba, Ahmed",
      "Door": "EMEA_MOR_CASA_07_01_Main Entrance",
      "EmployeeID": "W0020932",
      "Text5": "Casablanca - 1100 Boulevard Al",
      "PartitionName2": "MA.Casablanca",
      "PersonGUID": "8DA8F24A-0D08-45EF-ADAD-0440BDB9589E",
      "PersonnelType": "Contractor",
      "CardNumber": "615282",
      "AdmitCode": "Admit",
      "Direction": "InDirection",
      "SwipeDate": "2025-08-19T00:00:00.000Z"
    },
    {
      "LocaleMessageTime": "2025-08-19T08:07:11.000Z",
      "ObjectName1": "Campion, Fergus",
      "Door": "EMEA_IRE_DUB_Office to Stairwell Door",
      "EmployeeID": "303613",
      "Text5": "Dublin - The Loft, Dundrum Town Centre",
      "PartitionName2": "IE.Dublin",
      "PersonGUID": "B1EA2DD2-7C48-458C-9DA6-EB4DED286D53",
      "PersonnelType": "Employee",
      "CardNumber": "421892",
      "AdmitCode": "Admit",
      "Direction": "OutDirection",
      "SwipeDate": "2025-08-19T00:00:00.000Z"
    },








http://10.199.22.57:4000/api/occupancy/history
{
  "success": true,
  "summaryByDate": [
    {
      "date": "2025-08-18",
      "day": "Monday",
      "region": {
        "name": "LACA",
        "total": 917,
        "Employee": 798,
        "Contractor": 119
      },
      "partitions": {
        "CR.Costa Rica Partition": {
          "total": 528,
          "Employee": 468,
          "Contractor": 60,
          "TempBadge": 0
        },
        "AR.Cordoba": {
          "total": 216,
          "Employee": 177,
          "Contractor": 39
        },
        "BR.Sao Paulo": {
          "total": 57,
          "Employee": 48,
          "Contractor": 9
        },
        "MX.Mexico City": {
          "total": 69,
          "Employee": 64,
          "Contractor": 5
        },
        "PA.Panama City": {
          "total": 22,
          "Employee": 19,
          "Contractor": 3
        },
        "PE.Lima": {
          "total": 25,
          "Employee": 22,
          "Contractor": 3
        }
      }
    },
    {
      "date": "2025-08-19",
      "day": "Tuesday",
      "region": {
        "name": "LACA",
        "total": 1237,
        "Employee": 1105,
        "Contractor": 132
      },
      "partitions": {
        "CR.Costa Rica Partition": {
          "total": 794,
          "Employee": 723,
          "Contractor": 71,
          "TempBadge": 0
        },
        "AR.Cordoba": {
          "total": 221,
          "Employee": 184,
          "Contractor": 37
        },
        "MX.Mexico City": {
          "total": 75,
          "Employee": 70,
          "Contractor": 5
        },
        "BR.Sao Paulo": {
          "total": 70,
          "Employee": 58,
          "Contractor": 12
        },
        "PA.Panama City": {
          "total": 21,
          "Employee": 19,
          "Contractor": 2
        },
        "PE.Lima": {
          "total": 56,
          "Employee": 51,
          "Contractor": 5
        }
      }
    },
    {
      "date": "2025-08-20",
      "day": "Wednesday",
      "region": {
        "name": "LACA",
        "total": 1348,
        "Employee": 1207,
        "Contractor": 141
      },
      "partitions": {
        "CR.Costa Rica Partition": {
          "total": 848,
          "Employee": 783,
          "Contractor": 65,
          "TempBadge": 0
        },
        "AR.Cordoba": {
          "total": 271,
          "Employee": 218,
          "Contractor": 53
        },
        "MX.Mexico City": {
          "total": 73,
          "Employee": 68,
          "Contractor": 5
        },
        "PA.Panama City": {
          "total": 23,
          "Employee": 20,
          "Contractor": 3
        },
        "BR.Sao Paulo": {
          "total": 74,
          "Employee": 64,
          "Contractor": 10
        },
        "PE.Lima": {
          "total": 59,
          "Employee": 54,
          "Contractor": 5
        }
      }
    },
    {
      "date": "2025-08-21",
      "day": "Thursday",
      "region": {
        "name": "LACA",
        "total": 1005,
        "Employee": 879,
        "Contractor": 126
      },
      "partitions": {
        "CR.Costa Rica Partition": {
          "total": 619,
          "Employee": 555,
          "Contractor": 64,
          "TempBadge": 0
        },
        "AR.Cordoba": {
          "total": 217,
          "Employee": 175,
          "Contractor": 42
        },
        "PA.Panama City": {
          "total": 22,
          "Employee": 19,
          "Contractor": 3
        },
        "BR.Sao Paulo": {
          "total": 48,
          "Employee": 40,
          "Contractor": 8
        },
        "MX.Mexico City": {
          "total": 54,
          "Employee": 49,
          "Contractor": 5
        },
        "PE.Lima": {
          "total": 45,
          "Employee": 41,
          "Contractor": 4
        }
      }
    },
    {
      "date": "2025-08-22",
      "day": "Friday",
      "region": {
        "name": "LACA",
        "total": 601,
        "Employee": 482,
        "Contractor": 119
      },
      "partitions": {
        "CR.Costa Rica Partition": {
          "total": 367,
          "Employee": 305,
          "Contractor": 62,
          "TempBadge": 0
        },
        "AR.Cordoba": {
          "total": 164,
          "Employee": 125,
          "Contractor": 39
        },
        "BR.Sao Paulo": {
          "total": 36,
          "Employee": 27,
          "Contractor": 9
        },
        "MX.Mexico City": {
          "total": 10,
          "Employee": 7,
          "Contractor": 3
        },
        "PA.Panama City": {
          "total": 9,
          "Employee": 7,
          "Contractor": 2
        },
        "PE.Lima": {
          "total": 15,
          "Employee": 11,
          "Contractor": 4
        }
      }
    },
    {
      "date": "2025-08-23",
      "day": "Saturday",
      "region": {
        "name": "LACA",
        "total": 57,
        "Employee": 14,
        "Contractor": 43
      },
      "partitions": {
        "CR.Costa Rica Partition": {
          "total": 39,
          "Employee": 12,
          "Contractor": 27,
          "TempBadge": 0
        },
        "AR.Cordoba": {
          "total": 14,
          "Employee": 1,
          "Contractor": 13
        },
        "PA.Panama City": {
          "total": 1,
          "Employee": 0,
          "Contractor": 1
        },
        "PE.Lima": {
          "total": 2,
          "Employee": 1,
          "Contractor": 1
        },
        "BR.Sao Paulo": {
          "total": 1,
          "Employee": 0,
          "Contractor": 1
        }
      }
    },
    {
      "date": "2025-08-24",
      "day": "Sunday",
      "region": {
        "name": "LACA",
        "total": 34,
        "Employee": 15,
        "Contractor": 19
      },
      "partitions": {
        "CR.Costa Rica Partition": {
          "total": 29,
          "Employee": 15,
          "Contractor": 14,
          "TempBadge": 0
        },
        "AR.Cordoba": {
          "total": 5,
          "Employee": 0,
          "Contractor": 5
        }
      }
    },
    {
      "date": "2025-08-25",
      "day": "Monday",
      "region": {
        "name": "LACA",
        "total": 959,
        "Employee": 832,
        "Contractor": 127
      },
      "partitions": {
        "CR.Costa Rica Partition": {
          "total": 581,
          "Employee": 513,
          "Contractor": 68,
          "TempBadge": 0
        },
        "AR.Cordoba": {
          "total": 228,
          "Employee": 188,
          "Contractor": 40
        },
        "BR.Sao Paulo": {
          "total": 68,
          "Employee": 57,
          "Contractor": 11
        },
        "PA.Panama City": {
          "total": 23,
          "Employee": 21,
          "Contractor": 2
        },
        "MX.Mexico City": {
          "total": 30,
          "Employee": 27,
          "Contractor": 3
        },
        "PE.Lima": {
          "total": 29,
          "Employee": 26,
          "Contractor": 3
        }
      }
    },
    {
      "date": "2025-08-26",
      "day": "Tuesday",
      "region": {
        "name": "LACA",
        "total": 1258,
        "Employee": 1114,
        "Contractor": 144
      },
      "partitions": {
        "CR.Costa Rica Partition": {
          "total": 783,
          "Employee": 715,
          "Contractor": 68,
          "TempBadge": 0
        },
        "AR.Cordoba": {
          "total": 266,
          "Employee": 215,
          "Contractor": 51
        },
        "BR.Sao Paulo": {
          "total": 77,
          "Employee": 67,
          "Contractor": 10
        },
        "MX.Mexico City": {
          "total": 44,
          "Employee": 38,
          "Contractor": 6
        },
        "PE.Lima": {
          "total": 62,
          "Employee": 56,
          "Contractor": 6
        },
        "PA.Panama City": {
          "total": 26,
          "Employee": 23,
          "Contractor": 3
        }
      }
    },
    {
      "date": "2025-08-27",
      "day": "Wednesday",
      "region": {
        "name": "LACA",
        "total": 1302,
        "Employee": 1153,
        "Contractor": 149
      },
      "partitions": {
        "CR.Costa Rica Partition": {
          "total": 843,
          "Employee": 777,
          "Contractor": 66,
          "TempBadge": 0
        },
        "AR.Cordoba": {
          "total": 239,
          "Employee": 184,
          "Contractor": 55
        },
        "PA.Panama City": {
          "total": 21,
          "Employee": 18,
          "Contractor": 3
        },
        "BR.Sao Paulo": {
          "total": 76,
          "Employee": 63,
          "Contractor": 13
        },
        "MX.Mexico City": {
          "total": 59,
          "Employee": 53,
          "Contractor": 6
        },
        "PE.Lima": {
          "total": 64,
          "Employee": 58,
          "Contractor": 6
        }
      }
    },
    {
      "date": "2025-08-28",
      "day": "Thursday",
      "region": {
        "name": "LACA",
        "total": 1001,
        "Employee": 860,
        "Contractor": 141
      },
      "partitions": {
        "AR.Cordoba": {
          "total": 199,
          "Employee": 148,
          "Contractor": 51
        },
        "CR.Costa Rica Partition": {
          "total": 617,
          "Employee": 551,
          "Contractor": 66,
          "TempBadge": 0
        },
        "BR.Sao Paulo": {
          "total": 55,
          "Employee": 45,
          "Contractor": 10
        },
        "MX.Mexico City": {
          "total": 45,
          "Employee": 39,
          "Contractor": 6
        },
        "PA.Panama City": {
          "total": 28,
          "Employee": 25,
          "Contractor": 3
        },
        "PE.Lima": {
          "total": 57,
          "Employee": 52,
          "Contractor": 5
        }
      }
    },
    {
      "date": "2025-08-29",
      "day": "Friday",
      "region": {
        "name": "LACA",
        "total": 567,
        "Employee": 464,
        "Contractor": 103
      },
      "partitions": {
        "CR.Costa Rica Partition": {
          "total": 349,
          "Employee": 288,
          "Contractor": 61,
          "TempBadge": 0
        },
        "PE.Lima": {
          "total": 13,
          "Employee": 10,
          "Contractor": 3
        },
        "AR.Cordoba": {
          "total": 119,
          "Employee": 94,
          "Contractor": 25
        },
        "BR.Sao Paulo": {
          "total": 46,
          "Employee": 38,
          "Contractor": 8
        },
        "MX.Mexico City": {
          "total": 28,
          "Employee": 24,
          "Contractor": 4
        },
        "PA.Panama City": {
          "total": 12,
          "Employee": 10,
          "Contractor": 2
        }
      }
    },
    {
      "date": "2025-08-30",
      "day": "Saturday",
      "region": {
        "name": "LACA",
        "total": 64,
        "Employee": 20,
        "Contractor": 44
      },
      "partitions": {
        "CR.Costa Rica Partition": {
          "total": 39,
          "Employee": 13,
          "Contractor": 26,
          "TempBadge": 0
        },
        "AR.Cordoba": {
          "total": 24,
          "Employee": 6,
          "Contractor": 18
        },
        "PA.Panama City": {
          "total": 1,
          "Employee": 1,
          "Contractor": 0
        }
      }
    },
    {
      "date": "2025-08-31",
      "day": "Sunday",
      "region": {
        "name": "LACA",
        "total": 28,
        "Employee": 15,
        "Contractor": 13
      },
      "partitions": {
        "CR.Costa Rica Partition": {
          "total": 24,
          "Employee": 15,
          "Contractor": 9,
          "TempBadge": 0
        },
        "AR.Cordoba": {
          "total": 4,
          "Employee": 0,
          "Contractor": 4
        }
      }
    },
    {
      "date": "2025-09-01",
      "day": "Monday",
      "region": {
        "name": "LACA",
        "total": 873,
        "Employee": 757,
        "Contractor": 116
      },
      "partitions": {
        "CR.Costa Rica Partition": {
          "total": 481,
          "Employee": 423,
          "Contractor": 58,
          "TempBadge": 0
        },
        "AR.Cordoba": {
          "total": 233,
          "Employee": 196,
          "Contractor": 37
        },
        "BR.Sao Paulo": {
          "total": 65,
          "Employee": 56,
          "Contractor": 9
        },
        "MX.Mexico City": {
          "total": 24,
          "Employee": 20,
          "Contractor": 4
        },
        "PA.Panama City": {
          "total": 25,
          "Employee": 22,
          "Contractor": 3
        },
        "PE.Lima": {
          "total": 45,
          "Employee": 40,
          "Contractor": 5
        }
      }
    },
    {
      "date": "2025-09-02",
      "day": "Tuesday",
      "region": {
        "name": "LACA",
        "total": 19,
        "Employee": 3,
        "Contractor": 16
      },
      "partitions": {
        "CR.Costa Rica Partition": {
          "total": 7,
          "Employee": 1,
          "Contractor": 6,
          "TempBadge": 0
        },
        "AR.Cordoba": {
          "total": 10,
          "Employee": 1,
          "Contractor": 9
        },
        "BR.Sao Paulo": {
          "total": 2,
          "Employee": 1,
          "Contractor": 1
        }
      }
    }
  ],
  "details": [
    {
      "LocaleMessageTime": "2025-08-18T00:00:26.000Z",
      "ObjectName1": "Hernandez, Sofia",
      "Door": "LACA CR E3 Main Lobby",
      "EmployeeID": "W0022873",
      "Text5": "Santa Ana - Parque Empresarial",
      "PartitionName2": "CR.Costa Rica Partition",
      "PersonGUID": "98DA6E7A-3EE1-47AA-B843-599EB1A6EF21",
      "PersonnelType": "Contractor",
      "CardNumber": "612791",
      "AdmitCode": "Admit",
      "Direction": "OutDirection",
      "SwipeDate": "2025-08-18T00:00:00.000Z"
    },
    {
      "LocaleMessageTime": "2025-08-18T02:41:18.000Z",
      "ObjectName1": "Parrales, Jorge",
      "Door": "LACA CR A1 Main Lobby Door",
      "EmployeeID": "W0020261",
      "Text5": "Santa Ana - Parque Empresarial",
      "PartitionName2": "CR.Costa Rica Partition",
      "PersonGUID": "A5D4AFCF-BF71-48E8-A387-693B20820960",
      "PersonnelType": "Contractor",
      "CardNumber": "612769",
      "AdmitCode": "Admit",
      "Direction": "InDirection",
      "SwipeDate": "2025-08-18T00:00:00.000Z"
    },
    {
      "LocaleMessageTime": "2025-08-18T03:33:22.000Z",
      "ObjectName1": "Torres, Richard",
      "Door": "LACA CR A2 Main Lobby Door",
      "EmployeeID": "236473",
      "Text5": "Santa Ana - Parque Empresarial",
      "PartitionName2": "CR.Costa Rica Partition",
      "PersonGUID": "4C3B90A3-03F5-4186-AD16-2DE2965F8B87",
      "PersonnelType": "Employee",
      "CardNumber": "605777",
      "AdmitCode": "Admit",
      "Direction": "InDirection",
      "SwipeDate": "2025-08-18T00:00:00.000Z"
    },
    {
      "LocaleMessageTime": "2025-08-18T04:22:52.000Z",
      "ObjectName1": "Castro, Austin Donyette",
      "Door": "LACA CR A3 Main Lobby Door",
      "EmployeeID": "310808",
      "Text5": "Santa Ana - Parque Empresarial",
      "PartitionName2": "CR.Costa Rica Partition",
      "PersonGUID": "86BF5BBA-AE43-40B0-9E9B-4EE3FAC8D771",
      "PersonnelType": "Employee",
      "CardNumber": "418290",
      "AdmitCode": "Admit",
      "Direction": "InDirection",
      "SwipeDate": "2025-08-18T00:00:00.000Z"
    },





Check Above Each APi responce acrefully and Give me Fully updated file carefully.....


# C:\Users\W0024618\Desktop\global-page\backend\attendance-analytics\data_compare_service_v2.py
"""
New comparison service (v2)

Features:
- Loads canonical Active Employee sheet from DATA_DIR/active_employee.*
- Filters by Region Code, Location City, Location Description, Location State/Province
- Cross-checks against AttendanceSummary DB (today and Mon-Fri of current week)
- Calculates:
    - total active in selection (from sheet)
    - visited today count and percentage vs sheet total
    - current status (on leave) counts
    - employee type counts (Regular vs WFH, etc.)
    - For Regular employees: compute days present in Mon-Fri week, counts for present>=3, present==5
    - Defaulter lists (present only 1 time, present <3 times) with leave flag
- Optional export to Excel (writes to OUTPUT_DIR, returns filename)
- Public function: compare_ccure_vs_sheets(...) - backwards-compatible signature with optional extra filters
"""
import sys
import re
import uuid
import logging
from pathlib import Path
from datetime import date, datetime, timedelta
from typing import Optional, Dict, Any, List

import pandas as pd

# DB imports (same as your project)
from db import SessionLocal
from models import AttendanceSummary, ActiveEmployee

# Use settings if present to find DATA_DIR / OUTPUT_DIR
try:
    from settings import DATA_DIR as SETTINGS_DATA_DIR, OUTPUT_DIR as SETTINGS_OUTPUT_DIR
    DATA_DIR = Path(SETTINGS_DATA_DIR)
    OUTPUT_DIR = Path(SETTINGS_OUTPUT_DIR)
except Exception:
    DATA_DIR = Path(__file__).resolve().parent / "data"
    OUTPUT_DIR = Path(__file__).resolve().parent / "output"

DATA_DIR.mkdir(parents=True, exist_ok=True)
OUTPUT_DIR.mkdir(parents=True, exist_ok=True)

logger = logging.getLogger("data_compare_service_v2")
logger.setLevel(logging.INFO)
if not logger.handlers:
    ch = logging.StreamHandler(sys.stdout)
    ch.setFormatter(logging.Formatter("%(asctime)s %(levelname)s %(name)s: %(message)s"))
    logger.addHandler(ch)


# ----------------------------
# Helpers
# ----------------------------
def _find_active_employee_file():
    for ext in (".xlsx", ".xls", ".csv"):
        p = DATA_DIR / f"active_employee{ext}"
        if p.exists():
            return p
    # try case-insensitive search
    for p in DATA_DIR.iterdir():
        if p.is_file() and "active_employee" in p.name.lower():
            return p
    return None

def _normalize_key(k):
    if k is None:
        return None
    return str(k).strip()

def _safe_int(v, default=0):
    try:
        if v is None or v == "":
            return default
        return int(v)
    except Exception:
        try:
            return int(float(v))
        except Exception:
            return default

def _week_monday_and_friday(ref_date: Optional[date] = None):
    if ref_date is None:
        ref_date = date.today()
    # ISO weekday: Monday=1
    iso = ref_date.isoweekday()
    monday = ref_date - timedelta(days=(iso - 1))
    friday = monday + timedelta(days=4)
    return monday, friday

def _maybe_mark_on_leave(status_str: Optional[str]) -> bool:
    if not status_str:
        return False
    s = str(status_str).strip().lower()
    for tok in ("leave", "vacation", "on leave", "holiday", "sabbatical", "furlough", "loa"):
        if tok in s:
            return True
    return False

# ----------------------------
# Core loader: active employees (sheet)
# ----------------------------
def load_active_employees_dataframe() -> pd.DataFrame:
    """
    Loads canonical active_employee spreadsheet into a normalized DataFrame.
    Returns DataFrame with (at least) these normalized columns:
      employee_id, full_name, location_city, location_desc, location_state, region_code,
      current_status, employee_type, raw_row (JSON)
    """
    src = _find_active_employee_file()
    if not src:
        raise FileNotFoundError(f"Active employee canonical file not found in {DATA_DIR}")
    ext = src.suffix.lower()
    if ext in (".xls", ".xlsx"):
        df = pd.read_excel(src, sheet_name=0, dtype=str)
    else:
        df = pd.read_csv(src, dtype=str)

    # normalize column names (strip)
    df.columns = [c.strip() for c in df.columns]

    def _first_present(row, candidates):
        for c in candidates:
            if c in row and pd.notna(row[c]) and str(row[c]).strip() != "":
                return row[c]
        return None

    # build normalized rows
    rows = []
    for _, row in df.iterrows():
        emp_id = _first_present(row, ['Employee ID','EmployeeID','Employee Id','EmpID','Emp Id'])
        full_name = _first_present(row, ['Full Name','FullName','EmpName','Name']) or (
            f"{row.get('First Name','') or ''} {row.get('Last Name','') or ''}".strip()
        )
        location_city = _first_present(row, ['Location City','Location City ' ,'Location','City','LocationCity'])
        location_desc = _first_present(row, ['Location Description','Location Description ','LocationDescription'])
        location_state = _first_present(row, ['Location State / Province','Location State / Province ','Location State','State','Province'])
        region_code = _first_present(row, ['Region Code','Region','RegionCode'])
        current_status = _first_present(row, ['Current Status','Status','Employee Status','Employee_Status'])
        employee_type = _first_present(row, ['Employee Type','Type','Time Type'])
        rows.append({
            "employee_id": _normalize_key(emp_id),
            "full_name": _normalize_key(full_name),
            "location_city": _normalize_key(location_city),
            "location_desc": _normalize_key(location_desc),
            "location_state": _normalize_key(location_state),
            "region_code": (str(region_code).strip() if region_code is not None else None),
            "current_status": _normalize_key(current_status),
            "employee_type": _normalize_key(employee_type),
            "raw_row": row.to_dict()
        })
    ndf = pd.DataFrame(rows)
    # ensure columns exist
    for col in ("employee_id","full_name","location_city","location_desc","location_state","region_code","current_status","employee_type","raw_row"):
        if col not in ndf:
            ndf[col] = None
    # drop rows without employee_id (these cannot be matched)
    ndf = ndf[ndf["employee_id"].notna() & (ndf["employee_id"].str.strip() != "")]
    ndf.reset_index(drop=True, inplace=True)
    return ndf

# ----------------------------
# Attendance summary queries
# ----------------------------

def _fetch_presence_for_employees(employee_ids: List[str], start_date: date, end_date: date) -> Dict[str, Dict[date,int]]:
    """
    Robust fetch presence: chunked queries + fallback broad query + normalization.
    Returns mapping { employee_id_from_sheet: { date_obj: 0/1, ... }, ... }

    Notes:
      - Works if DB employee_id values are formatted slightly differently (leading zeros,
        non-digit chars). We do chunked IN queries (fast) and, if those return nothing,
        we fallback to pulling the full date-range rows and matching in Python using normalization.
      - Ensures each employee has a 0/1 entry for every date in the range.
    """
    if not employee_ids:
        return {}

    # ensure keys are strings and trimmed
    orig_ids = [str(e).strip() for e in employee_ids]
    norm_id_set = set([s for s in orig_ids if s])

    # prepare result container keyed by original (trimmed) employee id
    result: Dict[str, Dict[date, int]] = {eid: {} for eid in orig_ids}

    rows = []
    chunk_size = 500
    try:
        with SessionLocal() as db:
            # chunked IN queries first (fast if DB matches exactly)
            for i in range(0, len(orig_ids), chunk_size):
                chunk = orig_ids[i:i+chunk_size]
                try:
                    q = db.query(AttendanceSummary).filter(
                        AttendanceSummary.date >= start_date,
                        AttendanceSummary.date <= end_date,
                        AttendanceSummary.employee_id.in_(chunk)
                    )
                    rows_chunk = q.all()
                    if rows_chunk:
                        rows.extend(rows_chunk)
                except Exception:
                    logger.exception("chunked query failed for _fetch_presence_for_employees (continuing)")
                    continue

            # fallback: if no rows found (or very few), fetch all AttendanceSummary rows in date-range
            # and do normalized matching in Python. This handles format mismatches.
            if not rows:
                try:
                    rows = db.query(AttendanceSummary).filter(
                        AttendanceSummary.date >= start_date,
                        AttendanceSummary.date <= end_date
                    ).all()
                    logger.info("[presence_fetch] fallback broad query returned %d rows for %s -> %s", len(rows), start_date, end_date)
                except Exception:
                    logger.exception("fallback broad query failed in _fetch_presence_for_employees")
                    rows = []
    except Exception:
        logger.exception("DB session error in _fetch_presence_for_employees")
        rows = []

    # Build mapping from DB rows into normalized keys
    for r in rows:
        try:
            raw_eid = r.employee_id
            if raw_eid is None:
                continue
            db_key = str(raw_eid).strip()
            match_key = None

            # direct match
            if db_key in norm_id_set:
                match_key = db_key
            else:
                # try remove non-digits and leading zeros
                digits = re.sub(r'\D+', '', db_key)
                if digits:
                    cand = digits.lstrip('0') or digits
                    if cand in norm_id_set:
                        match_key = cand

                # try reverse: if any orig id equals db_key after stripping its leading zeros
                if match_key is None:
                    for o in orig_ids:
                        if o == db_key or o.lstrip('0') == db_key or db_key.lstrip('0') == o:
                            match_key = o
                            break

            if not match_key:
                # no match to any requested employee id; skip
                continue

            d = r.date
            present = 0
            try:
                present = int(r.presence_count or 0)
            except Exception:
                present = 1 if (r.presence_count and str(r.presence_count).strip() != "0") else 0

            result.setdefault(match_key, {})
            # if multiple rows for same employee/date exist, treat any positive as presence
            prev = result[match_key].get(d, 0)
            result[match_key][d] = 1 if (prev == 1 or present > 0) else 0
        except Exception:
            continue

    # ensure each employee has entries for every date in the range (fill zeros)
    cur = start_date
    while cur <= end_date:
        for eid in orig_ids:
            result.setdefault(eid, {})
            if cur not in result[eid]:
                result[eid][cur] = 0
        cur = cur + timedelta(days=1)

    # logging to help debug counts (will appear in server logs)
    try:
        total_date_entries = sum(len(d) for d in result.values())
        logger.info("[presence_fetch] built presence_map for %d employees (total date-entries=%d)", len(result), total_date_entries)
    except Exception:
        pass

    return result

# ----------------------------
# Main comparison function
# ----------------------------
def compare_ccure_vs_sheets(
    mode: str = "full",
    stats_detail: str = "ActiveProfiles",
    limit_list: int = 200,
    export: bool = False,
    # extra optional filters (if present, will be applied)
    region_filter: Optional[str] = None,        # e.g. "APAC"
    location_city: Optional[str] = None,       # e.g. "Pune"
    location_state: Optional[str] = None,
    location_description: Optional[str] = None,
    week_ref_date: Optional[str] = None        # "YYYY-MM-DD" - week to evaluate (Mon-Fri)
) -> Dict[str, Any]:
    """
    Rich comparison API:
      - mode/stats_detail kept for compatibility
      - additional optional filters: region_filter, location_city, location_state, location_description
      - week_ref_date optional: if provided, week considered is that date's Mon-Fri; else current week
      - export: if True, writes an excel summary report to OUTPUT_DIR and returns filename in result
    """
    try:
        # load active employees
        df = load_active_employees_dataframe()
    except Exception as e:
        logger.exception("Failed to load active employees")
        return {"error": f"active sheet load failed: {e}"}

    # normalize filters
    rf = region_filter.strip().lower() if region_filter else None
    lc = location_city.strip().lower() if location_city else None
    ls = location_state.strip().lower() if location_state else None
    ld = location_description.strip().lower() if location_description else None

    # apply filters
    sel = df.copy()
    if rf:
        sel = sel[sel["region_code"].fillna("").str.strip().str.lower() == rf]
    if lc:
        sel = sel[sel["location_city"].fillna("").str.strip().str.lower() == lc]
    if ls:
        sel = sel[sel["location_state"].fillna("").str.strip().str.lower() == ls]
    if ld:
        sel = sel[sel["location_desc"].fillna("").str.strip().str.lower() == ld]

    total_active = len(sel)
    # gather lists
    employee_ids = sel["employee_id"].astype(str).str.strip().tolist()

    # get "today" headcount by checking AttendanceSummary presence_count > 0 for date==today
    today = date.today()
    monday, friday = _week_monday_and_friday(date.fromisoformat(week_ref_date)) if week_ref_date else _week_monday_and_friday(today)

    # fetch presence for week (Mon-Fri)
    presence_map = _fetch_presence_for_employees(employee_ids, monday, friday)

    # compute today count (today might be within Mon-Fri window)
    today_count = 0
    for eid in employee_ids:
        pm = presence_map.get(eid, {})
        # presence_map stores per-day 0/1 for the Mon-Fri window; if today in map use that, otherwise fallback DB query for single date
        if today in pm:
            if pm[today] > 0:
                today_count += 1
        else:
            # fallback single-day check (try normalized lookup)
            try:
                with SessionLocal() as db:
                    # try exact match first
                    row = db.query(AttendanceSummary).filter(AttendanceSummary.employee_id == eid, AttendanceSummary.date == today).first()
                    if row and getattr(row, "presence_count", 0) > 0:
                        today_count += 1
                        continue
                    # try digits-only / no-leading-zero match
                    digits = re.sub(r'\D+', '', eid)
                    if digits:
                        cand = digits.lstrip('0') or digits
                        row2 = db.query(AttendanceSummary).filter(AttendanceSummary.employee_id == cand, AttendanceSummary.date == today).first()
                        if row2 and getattr(row2, "presence_count", 0) > 0:
                            today_count += 1
            except Exception:
                continue

    today_pct = round((today_count / float(total_active)) * 100.0, 2) if total_active > 0 else None

    # compute current status -> leave checks
    sel["on_leave"] = sel["current_status"].apply(lambda x: _maybe_mark_on_leave(x))
    leave_count = int(sel["on_leave"].sum())

    # employee type breakdown
    sel["employee_type_norm"] = sel["employee_type"].fillna("").str.strip().str.lower()
    type_counts = sel["employee_type_norm"].value_counts().to_dict()

    # Focus on Regular employees for presence checks
    regular_df = sel[sel["employee_type_norm"].str.contains("regular", na=False)]
    regular_ids = regular_df["employee_id"].astype(str).str.strip().tolist()

    # compute days present Monday-Friday per regular employee
    regular_presence: Dict[str, Dict[str, Any]] = {}
    for eid in regular_ids:
        week_map = presence_map.get(eid, {})
        # consider only Mon-Fri keys from week_map (already so)
        days_present = sum(1 for d, v in week_map.items() if v and (monday <= d <= friday))
        days_present = int(days_present)
        regular_presence[eid] = {
            "days_present": days_present,
            "on_leave": bool(sel[sel["employee_id"] == eid]["on_leave"].any()),
            "full_name": sel[sel["employee_id"] == eid]["full_name"].iloc[0] if not sel[sel["employee_id"] == eid].empty else None
        }

    # counts
    present_5_count = sum(1 for v in regular_presence.values() if v["days_present"] >= 5)
    present_3_or_more_count = sum(1 for v in regular_presence.values() if v["days_present"] >= 3)
    present_less_than_3_count = sum(1 for v in regular_presence.values() if v["days_present"] < 3)
    present_only_1_count = sum(1 for v in regular_presence.values() if v["days_present"] == 1)

    # lists (limit each to limit_list)
    present_5_list = []
    present_3_list = []
    defaulters_list = []   # those present 1 or <3 depending

    for eid, info in regular_presence.items():
        entry = {
            "employee_id": eid,
            "full_name": info["full_name"],
            "days_present": info["days_present"],
            "on_leave": info["on_leave"]
        }
        if info["days_present"] >= 5:
            present_5_list.append(entry)
        if info["days_present"] >= 3:
            present_3_list.append(entry)
        if info["days_present"] < 3:
            defaulters_list.append(entry)

    # Limit returned lists
    present_5_list = sorted(present_5_list, key=lambda x: (-x["days_present"], x["full_name"] or ""))[:limit_list]
    present_3_list = sorted(present_3_list, key=lambda x: (-x["days_present"], x["full_name"] or ""))[:limit_list]
    defaulters_list = sorted(defaulters_list, key=lambda x: (x["days_present"], x["on_leave"], x["full_name"] or ""))[:limit_list]

    # Build response
    summary = {
        "filters": {
            "region": region_filter,
            "location_city": location_city,
            "location_state": location_state,
            "location_description": location_description,
            "week_monday": monday.isoformat(),
            "week_friday": friday.isoformat()
        },
        "counts": {
            "total_active_in_sheet": total_active,
            "today_headcount_from_summary": today_count,
            "today_headcount_pct_vs_sheet": today_pct,
            "on_leave_count_in_sheet": leave_count,
            "employee_type_counts": type_counts
        },
        "regular_attendance_summary": {
            "regular_total": len(regular_ids),
            "present_5_day_count": present_5_count,
            "present_3_or_more_count": present_3_or_more_count,
            "present_less_than_3_count": present_less_than_3_count,
            "present_only_1_day_count": present_only_1_count
        }
    }

    details = {
        "present_5_days": present_5_list,
        "present_3_or_more_days": present_3_list,
        "defaulters_less_than_3_days": defaulters_list
    }

    report_path = None
    if export:
        try:
            report_name = f"attendance_compare_{(region_filter or 'all')}_{(location_city or 'all')}_{uuid.uuid4().hex[:8]}.xlsx"
            report_file = OUTPUT_DIR / report_name
            # write Excel with multiple sheets
            with pd.ExcelWriter(report_file, engine="openpyxl") as writer:
                # original selection snapshot
                sel_df_for_export = sel.copy()
                # flatten raw_row for convenience: keep as string
                sel_df_for_export["raw_row_str"] = sel_df_for_export["raw_row"].apply(lambda r: str(r) if not pd.isna(r) else "")
                sel_df_for_export.to_excel(writer, sheet_name="active_sheet_selection", index=False)
                # summary / counts as small DataFrame
                pd.DataFrame([summary["counts"]]).to_excel(writer, sheet_name="summary_counts", index=False)
                # regular attendance summary
                pd.DataFrame([summary["regular_attendance_summary"]]).to_excel(writer, sheet_name="regular_summary", index=False)
                # lists
                pd.DataFrame(details["present_5_days"]).to_excel(writer, sheet_name="present_5_days", index=False)
                pd.DataFrame(details["present_3_or_more_days"]).to_excel(writer, sheet_name="present_3_plus", index=False)
                pd.DataFrame(details["defaulters_less_than_3_days"]).to_excel(writer, sheet_name="defaulters_lt3", index=False)
            report_path = str(report_file.name)
        except Exception:
            logger.exception("Failed to write export report")
            report_path = None

    out = {
        "mode": mode,
        "stats_detail": stats_detail,
        "summary": summary,
        "details": details
    }
    if report_path:
        out["report_path"] = report_path
    return out


# small convenience test function (not run at import)
if __name__ == "__main__":
    # quick smoke test: compute for APAC Pune
    res = compare_ccure_vs_sheets(region_filter="APAC", location_city="Pune", export=False, limit_list=50)
    import json as _json
    print(_json.dumps(res, indent=2, default=str))












