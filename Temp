# Force TLS1.2 for this PowerShell session
[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12

# Set variables (replace with real values if not reading from .env)
$clientId = "6222d611-678e-4d57-a98b-83faa86fce76"
$clientSecret = "DKV8Q~Rn4MvlucbxcMsXvAZ6ub_rBVbo-sb6.bGX"
$tenantId = "ce3a67f2-5a22-4fb8-a511-815f8924cda6"

$body = @{
  client_id = $clientId
  scope = "https://graph.microsoft.com/.default"
  client_secret = $clientSecret
  grant_type = "client_credentials"
}

try {
  $resp = Invoke-RestMethod -Method Post -Uri "https://login.microsoftonline.com/$tenantId/oauth2/v2.0/token" -Body $body -ContentType "application/x-www-form-urlencoded" -TimeoutSec 20
  "Got token. Access token length: $($resp.access_token.Length)"
} catch {
  "Token request failed: $($_.Exception.Message)"
  if ($_.Exception.Response) {
    $_.Exception.Response | Select-Object -Property StatusCode, StatusDescription
    try { $_.Exception.Response.GetResponseStream() | Select-String -Pattern '.' -Context 0,1 } catch {}
  }
}








# Show environment proxy variables
Get-ChildItem Env:*proxy* | Format-Table -AutoSize

# Show WinHTTP proxy (used by system services / some apps)
netsh winhttp show proxy









$env:HTTPS_PROXY = "http://proxy.company.local:8080"   # replace with your proxy
$env:HTTP_PROXY  = $env:HTTPS_PROXY
# re-run the token request after forcing TLS1.2 (repeat the Step A block)







$env:CLIENT_ID    = "6222d611-678e-4d57-a98b-83faa86fce76"
$env:CLIENT_SECRET= "DKV8Q~Rn4MvlucbxcMsXvAZ6ub_rBVbo-sb6.bGX"
$env:TENANT_ID    = "ce3a67f2-5a22-4fb8-a511-815f8924cda6"
$env:PRIMARY_EMAIL= "gsoc-globalsecurityoperationcenter.sharedmailbox@westernunion.com"

# then run Python test
python .\test_graph.py







from dotenv import load_dotenv
import os

# load .env from the backend folder (explicit)
root_dir = os.path.dirname(__file__)
dotenv_path = os.path.join(root_dir, '.env')
load_dotenv(dotenv_path)








Get-Content .\log_file.log -Wait
# then trigger a manual fetch via your UI (Refresh) or via curl to /email/inbox endpoint








