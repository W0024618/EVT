(.venv) PS C:\Users\W0024618\Desktop\Trend Analysis\backend> python scripts/build_90day_training.py --start 2025-11-01 --end 2025-11-24 --outdir ./outputs --city Pune --force
When run this command we have data Generate for all city now only for Pune 
alos data is not store in Pune folder 
C:\Users\W0024618\Desktop\Trend Analysis\backend\outputs\pune
Pune folder is blanl 

alos we 
mention 
start 2025-11-01 --end 2025-11-24
start date end date start date and end date also not Working this are issue we need to fix this carefully...


2025-11-25 12:14:55,326 INFO Fetching swipes for region laca on 2025-09-09
2025-11-25 12:14:59,290 INFO Databases present for server SRVWUSJO0986V: ['ACVSUJournal_00010030', 'ACVSUJournal_00010029', 'ACVSUJournal_00010028', 'ACVSUJournal_00010027', 'ACVSUJournal_00010026', 'ACVSUJournal_00010025']       
2025-11-25 12:14:59,291 INFO Built SQL for region laca, date 2025-09-09
2025-11-25 12:15:20,539 INFO City filter 'Pune' applied for region laca: rows before=14895 after=0
2025-11-25 12:15:20,547 INFO Wrote duration CSV for laca to outputs\laca_duration_20250909.csv (rows=0)
2025-11-25 12:15:20,547 INFO Wrote swipes CSV for laca to outputs\laca_swipes_20250909.csv (rows=0)
2025-11-25 12:15:20,547 INFO Fetching swipes for region namer on 2025-09-09
2025-11-25 12:15:22,464 INFO Databases present for server SRVWUDEN0891V: ['ACVSUJournal_00010030', 'ACVSUJournal_00010029', 'ACVSUJournal_00010028', 'ACVSUJournal_00010027', 'ACVSUJournal_00010026', 'ACVSUJournal_00010025']       
2025-11-25 12:15:22,464 INFO Built SQL for region namer, date 2025-09-09
2025-11-25 12:15:30,734 INFO City filter 'Pune' applied for region namer: rows before=4208 after=0
2025-11-25 12:15:30,743 INFO Wrote duration CSV for namer to outputs\namer_duration_20250909.csv (rows=0)
2025-11-25 12:15:30,743 INFO Wrote swipes CSV for namer to outputs\namer_swipes_20250909.csv (rows=0)
C:\Users\W0024618\Desktop\Trend Analysis\backend\duration_report.py:918: FutureWarning: 'S' is deprecated and will be removed in a future version, please use 's' instead.
  df["_lts_rounded"] = df["LocaleMessageTime"].dt.floor("S")
2025-11-25 12:15:31,336 INFO PersonnelTypeName values example: ['Employee']
2025-11-25 12:15:31,376 INFO PersonnelTypeName filter applied: before=18381 after=18381
2025-11-25 12:15:38,215 INFO Saved raw swipes to outputs\swipes_pune_20250909.csv
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:2192: FutureWarning: DataFrameGroupBy.apply operated on the grouping columns. This behavior is deprecated, and in a future version of pandas the grouping columns will be excluded from the operation. Either pass `include_groups=False` to exclude the groupings or explicitly select the grouping columns after groupby to silence this warning.
  raw_metrics_df = grouped_raw.apply(_agg_metrics).reset_index()
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:2267: FutureWarning: The behavior of array concatenation with empty entries is deprecated. In a future version, this will no longer exclude empty items when determining the result dtype. To retain the old behavior, exclude the empty entries before the concat operation.
  merged_metrics[base_col] = merged_metrics[raw_col].combine_first(merged_metrics.get(base_col))
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:2267: FutureWarning: The behavior of array concatenation with empty entries is deprecated. In a future version, this will no longer exclude empty items when determining the result dtype. To retain the old behavior, exclude the empty entries before the concat operation.
  merged_metrics[base_col] = merged_metrics[raw_col].combine_first(merged_metrics.get(base_col))
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:1722: FutureWarning: Downcasting object dtype arrays on .fillna, .ffill, .bfill is deprecated and will change in a future version. Call result.infer_objects(copy=False) instead. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  for ix, r in df[df['CountSwipes'].fillna(0).astype(int) == 0].iterrows():
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:1788: FutureWarning: Downcasting object dtype arrays on .fillna, .ffill, .bfill is deprecated and will change in a future version. Call result.infer_objects(copy=False) instead. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  df['PresentToday'] = df['CountSwipes'].fillna(0).astype(int) > 0
2025-11-25 12:15:44,047 INFO run_trend_for_date: wrote outputs\trend_pune_20250909.csv (rows=810)
2025-11-25 12:15:44,075 INFO build_monthly_training: running for 2025-09-10 (city=Pune)
2025-11-25 12:15:44,076 INFO Fetching swipes for region apac on 2025-09-10
2025-11-25 12:15:44,138 INFO Databases present for server SRVWUPNQ0986V: ['ACVSUJournal_00010030', 'ACVSUJournal_00010029', 'ACVSUJournal_00010028', 'ACVSUJournal_00010027', 'ACVSUJournal_00010026', 'ACVSUJournal_00010025']       
2025-11-25 12:15:44,139 INFO Built SQL for region apac, date 2025-09-10
2025-11-25 12:15:55,494 INFO APAC PartitionName2 mapping counts example: {'Pune': 18640, 'Quezon City': 6662, 'IN.HYD': 67, 'Taguig City': 16}
2025-11-25 12:15:56,078 INFO City filter 'Pune' applied for region apac: rows before=25385 after=18640
C:\Users\W0024618\Desktop\Trend Analysis\backend\duration_report.py:918: FutureWarning: 'S' is deprecated and will be removed in a future version, please use 's' instead.
  df["_lts_rounded"] = df["LocaleMessageTime"].dt.floor("S")
2025-11-25 12:15:57,326 INFO Wrote duration CSV for apac to outputs\apac_duration_20250910.csv (rows=824)
2025-11-25 12:15:57,326 INFO Wrote swipes CSV for apac to outputs\apac_swipes_20250910.csv (rows=18640)
2025-11-25 12:15:57,326 INFO Fetching swipes for region emea on 2025-09-10
2025-11-25 12:15:58,391 INFO Databases present for server SRVWUFRA0986V: ['ACVSUJournal_00011029', 'ACVSUJournal_00011028', 'ACVSUJournal_00011027', 'ACVSUJournal_00011026', 'ACVSUJournal_00011025', 'ACVSUJournal_00011024', 'ACVSUJournal_00011023']
2025-11-25 12:15:58,392 INFO Built SQL for region emea, date 2025-09-10
2025-11-25 12:16:06,426 INFO City filter 'Pune' applied for region emea: rows before=8023 after=0
2025-11-25 12:16:06,432 INFO Wrote duration CSV for emea to outputs\emea_duration_20250910.csv (rows=0)
2025-11-25 12:16:06,433 INFO Wrote swipes CSV for emea to outputs\emea_swipes_20250910.csv (rows=0)
2025-11-25 12:16:06,433 INFO Fetching swipes for region laca on 2025-09-10
2025-11-25 12:16:10,388 INFO Databases present for server SRVWUSJO0986V: ['ACVSUJournal_00010030', 'ACVSUJournal_00010029', 'ACVSUJournal_00010028', 'ACVSUJournal_00010027', 'ACVSUJournal_00010026', 'ACVSUJournal_00010025']       
2025-11-25 12:16:10,388 INFO Built SQL for region laca, date 2025-09-10
2025-11-25 12:16:24,646 INFO City filter 'Pune' applied for region laca: rows before=15535 after=0
2025-11-25 12:16:24,655 INFO Wrote duration CSV for laca to outputs\laca_duration_20250910.csv (rows=0)
2025-11-25 12:16:24,655 INFO Wrote swipes CSV for laca to outputs\laca_swipes_20250910.csv (rows=0)
2025-11-25 12:16:24,655 INFO Fetching swipes for region namer on 2025-09-10
2025-11-25 12:16:26,565 INFO Databases present for server SRVWUDEN0891V: ['ACVSUJournal_00010030', 'ACVSUJournal_00010029', 'ACVSUJournal_00010028', 'ACVSUJournal_00010027', 'ACVSUJournal_00010026', 'ACVSUJournal_00010025']       
2025-11-25 12:16:26,566 INFO Built SQL for region namer, date 2025-09-10
2025-11-25 12:16:31,828 INFO City filter 'Pune' applied for region namer: rows before=4721 after=0
2025-11-25 12:16:31,836 INFO Wrote duration CSV for namer to outputs\namer_duration_20250910.csv (rows=0)
2025-11-25 12:16:31,837 INFO Wrote swipes CSV for namer to outputs\namer_swipes_20250910.csv (rows=0)
C:\Users\W0024618\Desktop\Trend Analysis\backend\duration_report.py:918: FutureWarning: 'S' is deprecated and will be removed in a future version, please use 's' instead.
  df["_lts_rounded"] = df["LocaleMessageTime"].dt.floor("S")
2025-11-25 12:16:32,467 INFO PersonnelTypeName values example: ['Employee']
2025-11-25 12:16:32,510 INFO PersonnelTypeName filter applied: before=18640 after=18640
2025-11-25 12:16:40,926 INFO Saved raw swipes to outputs\swipes_pune_20250910.csv
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:2192: FutureWarning: DataFrameGroupBy.apply operated on the grouping columns. This behavior is deprecated, and in a future version of pandas the grouping columns will be excluded from the operation. Either pass `include_groups=False` to exclude the groupings or explicitly select the grouping columns after groupby to silence this warning.
  raw_metrics_df = grouped_raw.apply(_agg_metrics).reset_index()
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:2267: FutureWarning: The behavior of array concatenation with empty entries is deprecated. In a future version, this will no longer exclude empty items when determining the result dtype. To retain the old behavior, exclude the empty entries before the concat operation.
  merged_metrics[base_col] = merged_metrics[raw_col].combine_first(merged_metrics.get(base_col))
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:2267: FutureWarning: The behavior of array concatenation with empty entries is deprecated. In a future version, this will no longer exclude empty items when determining the result dtype. To retain the old behavior, exclude the empty entries before the concat operation.
  merged_metrics[base_col] = merged_metrics[raw_col].combine_first(merged_metrics.get(base_col))
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:1722: FutureWarning: Downcasting object dtype arrays on .fillna, .ffill, .bfill is deprecated and will change in a future version. Call result.infer_objects(copy=False) instead. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  for ix, r in df[df['CountSwipes'].fillna(0).astype(int) == 0].iterrows():
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:1788: FutureWarning: Downcasting object dtype arrays on .fillna, .ffill, .bfill is deprecated and will change in a future version. Call result.infer_objects(copy=False) instead. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  df['PresentToday'] = df['CountSwipes'].fillna(0).astype(int) > 0
2025-11-25 12:16:49,349 INFO run_trend_for_date: wrote outputs\trend_pune_20250910.csv (rows=824)
2025-11-25 12:16:49,383 INFO build_monthly_training: running for 2025-09-11 (city=Pune)
2025-11-25 12:16:49,384 INFO Fetching swipes for region apac on 2025-09-11
2025-11-25 12:16:49,446 INFO Databases present for server SRVWUPNQ0986V: ['ACVSUJournal_00010030', 'ACVSUJournal_00010029', 'ACVSUJournal_00010028', 'ACVSUJournal_00010027', 'ACVSUJournal_00010026', 'ACVSUJournal_00010025']       
2025-11-25 12:16:49,446 INFO Built SQL for region apac, date 2025-09-11
2025-11-25 12:17:02,472 INFO APAC PartitionName2 mapping counts example: {'Pune': 12115, 'Quezon City': 5540, 'Taguig City': 42, 'IN.HYD': 6}
2025-11-25 12:17:02,852 INFO City filter 'Pune' applied for region apac: rows before=17703 after=12115
C:\Users\W0024618\Desktop\Trend Analysis\backend\duration_report.py:918: FutureWarning: 'S' is deprecated and will be removed in a future version, please use 's' instead.
  df["_lts_rounded"] = df["LocaleMessageTime"].dt.floor("S")
2025-11-25 12:17:03,691 INFO Wrote duration CSV for apac to outputs\apac_duration_20250911.csv (rows=540)
2025-11-25 12:17:03,691 INFO Wrote swipes CSV for apac to outputs\apac_swipes_20250911.csv (rows=12115)
2025-11-25 12:17:03,691 INFO Fetching swipes for region emea on 2025-09-11
2025-11-25 12:17:04,788 INFO Databases present for server SRVWUFRA0986V: ['ACVSUJournal_00011029', 'ACVSUJournal_00011028', 'ACVSUJournal_00011027', 'ACVSUJournal_00011026', 'ACVSUJournal_00011025', 'ACVSUJournal_00011024', 'ACVSUJournal_00011023']
2025-11-25 12:17:04,788 INFO Built SQL for region emea, date 2025-09-11
2025-11-25 12:17:10,411 INFO City filter 'Pune' applied for region emea: rows before=6688 after=0
2025-11-25 12:17:10,419 INFO Wrote duration CSV for emea to outputs\emea_duration_20250911.csv (rows=0)
2025-11-25 12:17:10,420 INFO Wrote swipes CSV for emea to outputs\emea_swipes_20250911.csv (rows=0)
2025-11-25 12:17:10,420 INFO Fetching swipes for region laca on 2025-09-11
2025-11-25 12:17:12,940 INFO Databases present for server SRVWUSJO0986V: ['ACVSUJournal_00010030', 'ACVSUJournal_00010029', 'ACVSUJournal_00010028', 'ACVSUJournal_00010027', 'ACVSUJournal_00010026', 'ACVSUJournal_00010025']       
2025-11-25 12:17:12,941 INFO Built SQL for region laca, date 2025-09-11
2025-11-25 12:17:19,776 INFO City filter 'Pune' applied for region laca: rows before=11043 after=0
2025-11-25 12:17:19,784 INFO Wrote duration CSV for laca to outputs\laca_duration_20250911.csv (rows=0)
2025-11-25 12:17:19,784 INFO Wrote swipes CSV for laca to outputs\laca_swipes_20250911.csv (rows=0)
2025-11-25 12:17:19,785 INFO Fetching swipes for region namer on 2025-09-11
2025-11-25 12:17:21,726 INFO Databases present for server SRVWUDEN0891V: ['ACVSUJournal_00010030', 'ACVSUJournal_00010029', 'ACVSUJournal_00010028', 'ACVSUJournal_00010027', 'ACVSUJournal_00010026', 'ACVSUJournal_00010025']       
2025-11-25 12:17:21,727 INFO Built SQL for region namer, date 2025-09-11
2025-11-25 12:17:26,014 INFO City filter 'Pune' applied for region namer: rows before=3362 after=0
2025-11-25 12:17:26,021 INFO Wrote duration CSV for namer to outputs\namer_duration_20250911.csv (rows=0)
2025-11-25 12:17:26,021 INFO Wrote swipes CSV for namer to outputs\namer_swipes_20250911.csv (rows=0)
C:\Users\W0024618\Desktop\Trend Analysis\backend\duration_report.py:918: FutureWarning: 'S' is deprecated and will be removed in a future version, please use 's' instead.
  df["_lts_rounded"] = df["LocaleMessageTime"].dt.floor("S")
2025-11-25 12:17:26,650 INFO PersonnelTypeName values example: ['Employee']
2025-11-25 12:17:26,676 INFO PersonnelTypeName filter applied: before=12115 after=12115
2025-11-25 12:17:31,332 INFO Saved raw swipes to outputs\swipes_pune_20250911.csv
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:2192: FutureWarning: DataFrameGroupBy.apply operated on the grouping columns. This behavior is deprecated, and in a future version of pandas the grouping columns will be excluded from the operation. Either pass `include_groups=False` to exclude the groupings or explicitly select the grouping columns after groupby to silence this warning.
  raw_metrics_df = grouped_raw.apply(_agg_metrics).reset_index()
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:2267: FutureWarning: The behavior of array concatenation with empty entries is deprecated. In a future version, this will no longer exclude empty items when determining the result dtype. To retain the old behavior, exclude the empty entries before the concat operation.
  merged_metrics[base_col] = merged_metrics[raw_col].combine_first(merged_metrics.get(base_col))
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:2267: FutureWarning: The behavior of array concatenation with empty entries is deprecated. In a future version, this will no longer exclude empty items when determining the result dtype. To retain the old behavior, exclude the empty entries before the concat operation.
  merged_metrics[base_col] = merged_metrics[raw_col].combine_first(merged_metrics.get(base_col))
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:1722: FutureWarning: Downcasting object dtype arrays on .fillna, .ffill, .bfill is deprecated and will change in a future version. Call result.infer_objects(copy=False) instead. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  for ix, r in df[df['CountSwipes'].fillna(0).astype(int) == 0].iterrows():
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:1788: FutureWarning: Downcasting object dtype arrays on .fillna, .ffill, .bfill is deprecated and will change in a future version. Call result.infer_objects(copy=False) instead. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  df['PresentToday'] = df['CountSwipes'].fillna(0).astype(int) > 0
2025-11-25 12:17:36,553 INFO run_trend_for_date: wrote outputs\trend_pune_20250911.csv (rows=540)
2025-11-25 12:17:36,571 INFO build_monthly_training: running for 2025-09-12 (city=Pune)
2025-11-25 12:17:36,572 INFO Fetching swipes for region apac on 2025-09-12
2025-11-25 12:17:36,639 INFO Databases present for server SRVWUPNQ0986V: ['ACVSUJournal_00010030', 'ACVSUJournal_00010029', 'ACVSUJournal_00010028', 'ACVSUJournal_00010027', 'ACVSUJournal_00010026', 'ACVSUJournal_00010025']       
2025-11-25 12:17:36,640 INFO Built SQL for region apac, date 2025-09-12
2025-11-25 12:17:45,195 INFO APAC PartitionName2 mapping counts example: {'Pune': 7136, 'Quezon City': 3315, 'IN.HYD': 53, 'Taguig City': 24}
2025-11-25 12:17:45,427 INFO City filter 'Pune' applied for region apac: rows before=10528 after=7136
C:\Users\W0024618\Desktop\Trend Analysis\backend\duration_report.py:918: FutureWarning: 'S' is deprecated and will be removed in a future version, please use 's' instead.
  df["_lts_rounded"] = df["LocaleMessageTime"].dt.floor("S")
2025-11-25 12:17:45,905 INFO Wrote duration CSV for apac to outputs\apac_duration_20250912.csv (rows=353)
2025-11-25 12:17:45,905 INFO Wrote swipes CSV for apac to outputs\apac_swipes_20250912.csv (rows=7136)
2025-11-25 12:17:45,905 INFO Fetching swipes for region emea on 2025-09-12
2025-11-25 12:17:46,993 INFO Databases present for server SRVWUFRA0986V: ['ACVSUJournal_00011029', 'ACVSUJournal_00011028', 'ACVSUJournal_00011027', 'ACVSUJournal_00011026', 'ACVSUJournal_00011025', 'ACVSUJournal_00011024', 'ACVSUJournal_00011023']
2025-11-25 12:17:46,994 INFO Built SQL for region emea, date 2025-09-12
2025-11-25 12:17:51,908 INFO City filter 'Pune' applied for region emea: rows before=3361 after=0
2025-11-25 12:17:51,922 INFO Wrote duration CSV for emea to outputs\emea_duration_20250912.csv (rows=0)
2025-11-25 12:17:51,922 INFO Wrote swipes CSV for emea to outputs\emea_swipes_20250912.csv (rows=0)
2025-11-25 12:17:51,923 INFO Fetching swipes for region laca on 2025-09-12
2025-11-25 12:17:54,467 INFO Databases present for server SRVWUSJO0986V: ['ACVSUJournal_00010030', 'ACVSUJournal_00010029', 'ACVSUJournal_00010028', 'ACVSUJournal_00010027', 'ACVSUJournal_00010026', 'ACVSUJournal_00010025']       
2025-11-25 12:17:54,468 INFO Built SQL for region laca, date 2025-09-12
2025-11-25 12:18:27,850 INFO City filter 'Pune' applied for region laca: rows before=4888 after=0
2025-11-25 12:18:27,859 INFO Wrote duration CSV for laca to outputs\laca_duration_20250912.csv (rows=0)
2025-11-25 12:18:27,859 INFO Wrote swipes CSV for laca to outputs\laca_swipes_20250912.csv (rows=0)
2025-11-25 12:18:27,859 INFO Fetching swipes for region namer on 2025-09-12
2025-11-25 12:18:29,775 INFO Databases present for server SRVWUDEN0891V: ['ACVSUJournal_00010030', 'ACVSUJournal_00010029', 'ACVSUJournal_00010028', 'ACVSUJournal_00010027', 'ACVSUJournal_00010026', 'ACVSUJournal_00010025']       
2025-11-25 12:18:29,775 INFO Built SQL for region namer, date 2025-09-12
2025-11-25 12:18:33,164 INFO City filter 'Pune' applied for region namer: rows before=1743 after=0
2025-11-25 12:18:33,174 INFO Wrote duration CSV for namer to outputs\namer_duration_20250912.csv (rows=0)
2025-11-25 12:18:33,174 INFO Wrote swipes CSV for namer to outputs\namer_swipes_20250912.csv (rows=0)
C:\Users\W0024618\Desktop\Trend Analysis\backend\duration_report.py:918: FutureWarning: 'S' is deprecated and will be removed in a future version, please use 's' instead.
  df["_lts_rounded"] = df["LocaleMessageTime"].dt.floor("S")
2025-11-25 12:18:33,536 INFO PersonnelTypeName values example: ['Employee']
2025-11-25 12:18:33,546 INFO PersonnelTypeName filter applied: before=7136 after=7136
2025-11-25 12:18:36,710 INFO Saved raw swipes to outputs\swipes_pune_20250912.csv
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:2192: FutureWarning: DataFrameGroupBy.apply operated on the grouping columns. This behavior is deprecated, and in a future version of pandas the grouping columns will be excluded from the operation. Either pass `include_groups=False` to exclude the groupings or explicitly select the grouping columns after groupby to silence this warning.
  raw_metrics_df = grouped_raw.apply(_agg_metrics).reset_index()
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:2267: FutureWarning: The behavior of array concatenation with empty entries is deprecated. In a future version, this will no longer exclude empty items when determining the result dtype. To retain the old behavior, exclude the empty entries before the concat operation.
  merged_metrics[base_col] = merged_metrics[raw_col].combine_first(merged_metrics.get(base_col))
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:2267: FutureWarning: The behavior of array concatenation with empty entries is deprecated. In a future version, this will no longer exclude empty items when determining the result dtype. To retain the old behavior, exclude the empty entries before the concat operation.
  merged_metrics[base_col] = merged_metrics[raw_col].combine_first(merged_metrics.get(base_col))
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:1722: FutureWarning: Downcasting object dtype arrays on .fillna, .ffill, .bfill is deprecated and will change in a future version. Call result.infer_objects(copy=False) instead. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  for ix, r in df[df['CountSwipes'].fillna(0).astype(int) == 0].iterrows():
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:1788: FutureWarning: Downcasting object dtype arrays on .fillna, .ffill, .bfill is deprecated and will change in a future version. Call result.infer_objects(copy=False) instead. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  df['PresentToday'] = df['CountSwipes'].fillna(0).astype(int) > 0
2025-11-25 12:18:41,236 INFO run_trend_for_date: wrote outputs\trend_pune_20250912.csv (rows=353)
2025-11-25 12:18:41,246 INFO build_monthly_training: running for 2025-09-13 (city=Pune)
2025-11-25 12:18:41,247 INFO Fetching swipes for region apac on 2025-09-13
2025-11-25 12:18:41,280 INFO Databases present for server SRVWUPNQ0986V: ['ACVSUJournal_00010030', 'ACVSUJournal_00010029', 'ACVSUJournal_00010028', 'ACVSUJournal_00010027', 'ACVSUJournal_00010026', 'ACVSUJournal_00010025']       
2025-11-25 12:18:41,281 INFO Built SQL for region apac, date 2025-09-13
2025-11-25 12:18:47,810 INFO APAC PartitionName2 mapping counts example: {'Quezon City': 1652, 'Taguig City': 8}
2025-11-25 12:18:47,857 INFO City filter 'Pune' applied for region apac: rows before=1660 after=0
2025-11-25 12:18:47,865 INFO Wrote duration CSV for apac to outputs\apac_duration_20250913.csv (rows=0)
2025-11-25 12:18:47,865 INFO Wrote swipes CSV for apac to outputs\apac_swipes_20250913.csv (rows=0)
2025-11-25 12:18:47,866 INFO Fetching swipes for region emea on 2025-09-13
2025-11-25 12:18:48,903 INFO Databases present for server SRVWUFRA0986V: ['ACVSUJournal_00011029', 'ACVSUJournal_00011028', 'ACVSUJournal_00011027', 'ACVSUJournal_00011026', 'ACVSUJournal_00011025', 'ACVSUJournal_00011024', 'ACVSUJournal_00011023']
2025-11-25 12:18:48,903 INFO Built SQL for region emea, date 2025-09-13
2025-11-25 12:18:52,838 INFO City filter 'Pune' applied for region emea: rows before=266 after=0
2025-11-25 12:18:52,856 INFO Wrote duration CSV for emea to outputs\emea_duration_20250913.csv (rows=0)
2025-11-25 12:18:52,856 INFO Wrote swipes CSV for emea to outputs\emea_swipes_20250913.csv (rows=0)
2025-11-25 12:18:52,857 INFO Fetching swipes for region laca on 2025-09-13
2025-11-25 12:18:55,366 INFO Databases present for server SRVWUSJO0986V: ['ACVSUJournal_00010030', 'ACVSUJournal_00010029', 'ACVSUJournal_00010028', 'ACVSUJournal_00010027', 'ACVSUJournal_00010026', 'ACVSUJournal_00010025']       
2025-11-25 12:18:55,367 INFO Built SQL for region laca, date 2025-09-13
2025-11-25 12:18:58,919 INFO City filter 'Pune' applied for region laca: rows before=118 after=0
2025-11-25 12:18:58,931 INFO Wrote duration CSV for laca to outputs\laca_duration_20250913.csv (rows=0)
2025-11-25 12:18:58,931 INFO Wrote swipes CSV for laca to outputs\laca_swipes_20250913.csv (rows=0)
2025-11-25 12:18:58,932 INFO Fetching swipes for region namer on 2025-09-13
2025-11-25 12:19:00,842 INFO Databases present for server SRVWUDEN0891V: ['ACVSUJournal_00010030', 'ACVSUJournal_00010029', 'ACVSUJournal_00010028', 'ACVSUJournal_00010027', 'ACVSUJournal_00010026', 'ACVSUJournal_00010025']       
2025-11-25 12:19:00,843 INFO Built SQL for region namer, date 2025-09-13
2025-11-25 12:19:03,620 INFO City filter 'Pune' applied for region namer: rows before=4 after=0
2025-11-25 12:19:03,628 INFO Wrote duration CSV for namer to outputs\namer_duration_20250913.csv (rows=0)
2025-11-25 12:19:03,628 INFO Wrote swipes CSV for namer to outputs\namer_swipes_20250913.csv (rows=0)
2025-11-25 12:19:03,629 WARNING run_trend_for_date: no features computed
2025-11-25 12:19:03,630 INFO build_monthly_training: running for 2025-09-14 (city=Pune)
2025-11-25 12:19:03,631 INFO Fetching swipes for region apac on 2025-09-14
2025-11-25 12:19:03,657 INFO Databases present for server SRVWUPNQ0986V: ['ACVSUJournal_00010030', 'ACVSUJournal_00010029', 'ACVSUJournal_00010028', 'ACVSUJournal_00010027', 'ACVSUJournal_00010026', 'ACVSUJournal_00010025']       
2025-11-25 12:19:03,657 INFO Built SQL for region apac, date 2025-09-14
2025-11-25 12:19:10,099 INFO APAC PartitionName2 mapping counts example: {'Quezon City': 1212, 'Pune': 13}
2025-11-25 12:19:10,136 INFO City filter 'Pune' applied for region apac: rows before=1225 after=13
C:\Users\W0024618\Desktop\Trend Analysis\backend\duration_report.py:918: FutureWarning: 'S' is deprecated and will be removed in a future version, please use 's' instead.
  df["_lts_rounded"] = df["LocaleMessageTime"].dt.floor("S")
2025-11-25 12:19:10,172 INFO Wrote duration CSV for apac to outputs\apac_duration_20250914.csv (rows=1)
2025-11-25 12:19:10,172 INFO Wrote swipes CSV for apac to outputs\apac_swipes_20250914.csv (rows=13)
2025-11-25 12:19:10,172 INFO Fetching swipes for region emea on 2025-09-14
2025-11-25 12:19:11,180 INFO Databases present for server SRVWUFRA0986V: ['ACVSUJournal_00011029', 'ACVSUJournal_00011028', 'ACVSUJournal_00011027', 'ACVSUJournal_00011026', 'ACVSUJournal_00011025', 'ACVSUJournal_00011024', 'ACVSUJournal_00011023']
2025-11-25 12:19:11,180 INFO Built SQL for region emea, date 2025-09-14
2025-11-25 12:19:14,671 INFO City filter 'Pune' applied for region emea: rows before=200 after=0
2025-11-25 12:19:14,680 INFO Wrote duration CSV for emea to outputs\emea_duration_20250914.csv (rows=0)
2025-11-25 12:19:14,680 INFO Wrote swipes CSV for emea to outputs\emea_swipes_20250914.csv (rows=0)
2025-11-25 12:19:14,680 INFO Fetching swipes for region laca on 2025-09-14
2025-11-25 12:19:17,201 INFO Databases present for server SRVWUSJO0986V: ['ACVSUJournal_00010030', 'ACVSUJournal_00010029', 'ACVSUJournal_00010028', 'ACVSUJournal_00010027', 'ACVSUJournal_00010026', 'ACVSUJournal_00010025']       
2025-11-25 12:19:17,201 INFO Built SQL for region laca, date 2025-09-14
2025-11-25 12:19:21,592 INFO City filter 'Pune' applied for region laca: rows before=64 after=0
2025-11-25 12:19:21,604 INFO Wrote duration CSV for laca to outputs\laca_duration_20250914.csv (rows=0)
2025-11-25 12:19:21,604 INFO Wrote swipes CSV for laca to outputs\laca_swipes_20250914.csv (rows=0)
2025-11-25 12:19:21,605 INFO Fetching swipes for region namer on 2025-09-14
2025-11-25 12:19:23,580 INFO Databases present for server SRVWUDEN0891V: ['ACVSUJournal_00010030', 'ACVSUJournal_00010029', 'ACVSUJournal_00010028', 'ACVSUJournal_00010027', 'ACVSUJournal_00010026', 'ACVSUJournal_00010025']       
2025-11-25 12:19:23,580 INFO Built SQL for region namer, date 2025-09-14
2025-11-25 12:19:26,358 INFO City filter 'Pune' applied for region namer: rows before=9 after=0
2025-11-25 12:19:26,367 INFO Wrote duration CSV for namer to outputs\namer_duration_20250914.csv (rows=0)
2025-11-25 12:19:26,367 INFO Wrote swipes CSV for namer to outputs\namer_swipes_20250914.csv (rows=0)
C:\Users\W0024618\Desktop\Trend Analysis\backend\duration_report.py:918: FutureWarning: 'S' is deprecated and will be removed in a future version, please use 's' instead.
  df["_lts_rounded"] = df["LocaleMessageTime"].dt.floor("S")
2025-11-25 12:19:26,417 INFO PersonnelTypeName values example: ['Employee']
2025-11-25 12:19:26,418 INFO PersonnelTypeName filter applied: before=13 after=13
2025-11-25 12:19:26,465 INFO Saved raw swipes to outputs\swipes_pune_20250914.csv
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:2192: FutureWarning: DataFrameGroupBy.apply operated on the grouping columns. This behavior is deprecated, and in a future version of pandas the grouping columns will be excluded from the operation. Either pass `include_groups=False` to exclude the groupings or explicitly select the grouping columns after groupby to silence this warning.
  raw_metrics_df = grouped_raw.apply(_agg_metrics).reset_index()
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:2267: FutureWarning: The behavior of array concatenation with empty entries is deprecated. In a future version, this will no longer exclude empty items when determining the result dtype. To retain the old behavior, exclude the empty entries before the concat operation.
  merged_metrics[base_col] = merged_metrics[raw_col].combine_first(merged_metrics.get(base_col))
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:2267: FutureWarning: The behavior of array concatenation with empty entries is deprecated. In a future version, this will no longer exclude empty items when determining the result dtype. To retain the old behavior, exclude the empty entries before the concat operation.
  merged_metrics[base_col] = merged_metrics[raw_col].combine_first(merged_metrics.get(base_col))
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:1722: FutureWarning: Downcasting object dtype arrays on .fillna, .ffill, .bfill is deprecated and will change in a future version. Call result.infer_objects(copy=False) instead. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  for ix, r in df[df['CountSwipes'].fillna(0).astype(int) == 0].iterrows():
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:1788: FutureWarning: Downcasting object dtype arrays on .fillna, .ffill, .bfill is deprecated and will change in a future version. Call result.infer_objects(copy=False) instead. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  df['PresentToday'] = df['CountSwipes'].fillna(0).astype(int) > 0
2025-11-25 12:19:31,658 INFO run_trend_for_date: wrote outputs\trend_pune_20250914.csv (rows=1)
2025-11-25 12:19:31,658 INFO build_monthly_training: running for 2025-09-15 (city=Pune)
2025-11-25 12:19:31,659 INFO Fetching swipes for region apac on 2025-09-15
2025-11-25 12:19:31,704 INFO Databases present for server SRVWUPNQ0986V: ['ACVSUJournal_00010030', 'ACVSUJournal_00010029', 'ACVSUJournal_00010028', 'ACVSUJournal_00010027', 'ACVSUJournal_00010026', 'ACVSUJournal_00010025']       
2025-11-25 12:19:31,705 INFO Built SQL for region apac, date 2025-09-15
2025-11-25 12:19:41,191 INFO APAC PartitionName2 mapping counts example: {'Pune': 12969, 'Quezon City': 3241, 'IN.HYD': 140, 'Taguig City': 27}
2025-11-25 12:19:41,585 INFO City filter 'Pune' applied for region apac: rows before=16377 after=12969
C:\Users\W0024618\Desktop\Trend Analysis\backend\duration_report.py:918: FutureWarning: 'S' is deprecated and will be removed in a future version, please use 's' instead.
  df["_lts_rounded"] = df["LocaleMessageTime"].dt.floor("S")
2025-11-25 12:19:42,576 INFO Wrote duration CSV for apac to outputs\apac_duration_20250915.csv (rows=568)
2025-11-25 12:19:42,577 INFO Wrote swipes CSV for apac to outputs\apac_swipes_20250915.csv (rows=12969)
2025-11-25 12:19:42,577 INFO Fetching swipes for region emea on 2025-09-15
2025-11-25 12:19:43,588 INFO Databases present for server SRVWUFRA0986V: ['ACVSUJournal_00011029', 'ACVSUJournal_00011028', 'ACVSUJournal_00011027', 'ACVSUJournal_00011026', 'ACVSUJournal_00011025', 'ACVSUJournal_00011024', 'ACVSUJournal_00011023']
2025-11-25 12:19:43,588 INFO Built SQL for region emea, date 2025-09-15
2025-11-25 12:19:47,383 INFO City filter 'Pune' applied for region emea: rows before=6160 after=0
2025-11-25 12:19:47,390 INFO Wrote duration CSV for emea to outputs\emea_duration_20250915.csv (rows=0)
2025-11-25 12:19:47,391 INFO Wrote swipes CSV for emea to outputs\emea_swipes_20250915.csv (rows=0)
2025-11-25 12:19:47,391 INFO Fetching swipes for region laca on 2025-09-15
2025-11-25 12:19:49,891 INFO Databases present for server SRVWUSJO0986V: ['ACVSUJournal_00010030', 'ACVSUJournal_00010029', 'ACVSUJournal_00010028', 'ACVSUJournal_00010027', 'ACVSUJournal_00010026', 'ACVSUJournal_00010025']       
2025-11-25 12:19:49,891 INFO Built SQL for region laca, date 2025-09-15
2025-11-25 12:19:56,286 INFO City filter 'Pune' applied for region laca: rows before=3788 after=0
2025-11-25 12:19:56,294 INFO Wrote duration CSV for laca to outputs\laca_duration_20250915.csv (rows=0)
2025-11-25 12:19:56,294 INFO Wrote swipes CSV for laca to outputs\laca_swipes_20250915.csv (rows=0)
2025-11-25 12:19:56,294 INFO Fetching swipes for region namer on 2025-09-15
2025-11-25 12:19:58,208 INFO Databases present for server SRVWUDEN0891V: ['ACVSUJournal_00010030', 'ACVSUJournal_00010029', 'ACVSUJournal_00010028', 'ACVSUJournal_00010027', 'ACVSUJournal_00010026', 'ACVSUJournal_00010025']       
2025-11-25 12:19:58,210 INFO Built SQL for region namer, date 2025-09-15
2025-11-25 12:20:03,456 INFO City filter 'Pune' applied for region namer: rows before=3482 after=0
2025-11-25 12:20:03,465 INFO Wrote duration CSV for namer to outputs\namer_duration_20250915.csv (rows=0)
2025-11-25 12:20:03,465 INFO Wrote swipes CSV for namer to outputs\namer_swipes_20250915.csv (rows=0)
C:\Users\W0024618\Desktop\Trend Analysis\backend\duration_report.py:918: FutureWarning: 'S' is deprecated and will be removed in a future version, please use 's' instead.
  df["_lts_rounded"] = df["LocaleMessageTime"].dt.floor("S")
2025-11-25 12:20:03,930 INFO PersonnelTypeName values example: ['Employee']
2025-11-25 12:20:03,956 INFO PersonnelTypeName filter applied: before=12969 after=12969
2025-11-25 12:20:08,510 INFO Saved raw swipes to outputs\swipes_pune_20250915.csv
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:2192: FutureWarning: DataFrameGroupBy.apply operated on the grouping columns. This behavior is deprecated, and in a future version of pandas the grouping columns will be excluded from the operation. Either pass `include_groups=False` to exclude the groupings or explicitly select the grouping columns after groupby to silence this warning.
  raw_metrics_df = grouped_raw.apply(_agg_metrics).reset_index()
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:2267: FutureWarning: The behavior of array concatenation with empty entries is deprecated. In a future version, this will no longer exclude empty items when determining the result dtype. To retain the old behavior, exclude the empty entries before the concat operation.
  merged_metrics[base_col] = merged_metrics[raw_col].combine_first(merged_metrics.get(base_col))
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:2267: FutureWarning: The behavior of array concatenation with empty entries is deprecated. In a future version, this will no longer exclude empty items when determining the result dtype. To retain the old behavior, exclude the empty entries before the concat operation.
  merged_metrics[base_col] = merged_metrics[raw_col].combine_first(merged_metrics.get(base_col))
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:1722: FutureWarning: Downcasting object dtype arrays on .fillna, .ffill, .bfill is deprecated and will change in a future version. Call result.infer_objects(copy=False) instead. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  for ix, r in df[df['CountSwipes'].fillna(0).astype(int) == 0].iterrows():
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:1788: FutureWarning: Downcasting object dtype arrays on .fillna, .ffill, .bfill is deprecated and will change in a future version. Call result.infer_objects(copy=False) instead. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  df['PresentToday'] = df['CountSwipes'].fillna(0).astype(int) > 0
2025-11-25 12:20:13,853 INFO run_trend_for_date: wrote outputs\trend_pune_20250915.csv (rows=568)
2025-11-25 12:20:13,871 INFO build_monthly_training: running for 2025-09-16 (city=Pune)
2025-11-25 12:20:13,872 INFO Fetching swipes for region apac on 2025-09-16
2025-11-25 12:20:13,892 INFO Databases present for server SRVWUPNQ0986V: ['ACVSUJournal_00010030', 'ACVSUJournal_00010029', 'ACVSUJournal_00010028', 'ACVSUJournal_00010027', 'ACVSUJournal_00010026', 'ACVSUJournal_00010025']       
2025-11-25 12:20:13,893 INFO Built SQL for region apac, date 2025-09-16
2025-11-25 12:20:24,600 INFO APAC PartitionName2 mapping counts example: {'Pune': 18681, 'Quezon City': 5266, 'IN.HYD': 59, 'Taguig City': 25}
2025-11-25 12:20:25,178 INFO City filter 'Pune' applied for region apac: rows before=24031 after=18681
C:\Users\W0024618\Desktop\Trend Analysis\backend\duration_report.py:918: FutureWarning: 'S' is deprecated and will be removed in a future version, please use 's' instead.
  df["_lts_rounded"] = df["LocaleMessageTime"].dt.floor("S")
2025-11-25 12:20:26,507 INFO Wrote duration CSV for apac to outputs\apac_duration_20250916.csv (rows=821)
2025-11-25 12:20:26,508 INFO Wrote swipes CSV for apac to outputs\apac_swipes_20250916.csv (rows=18681)
2025-11-25 12:20:26,508 INFO Fetching swipes for region emea on 2025-09-16
2025-11-25 12:20:27,542 INFO Databases present for server SRVWUFRA0986V: ['ACVSUJournal_00011029', 'ACVSUJournal_00011028', 'ACVSUJournal_00011027', 'ACVSUJournal_00011026', 'ACVSUJournal_00011025', 'ACVSUJournal_00011024', 'ACVSUJournal_00011023']
2025-11-25 12:20:27,542 INFO Built SQL for region emea, date 2025-09-16
2025-11-25 12:20:31,466 INFO City filter 'Pune' applied for region emea: rows before=7385 after=0
2025-11-25 12:20:31,473 INFO Wrote duration CSV for emea to outputs\emea_duration_20250916.csv (rows=0)
2025-11-25 12:20:31,473 INFO Wrote swipes CSV for emea to outputs\emea_swipes_20250916.csv (rows=0)
2025-11-25 12:20:31,474 INFO Fetching swipes for region laca on 2025-09-16
2025-11-25 12:20:34,025 INFO Databases present for server SRVWUSJO0986V: ['ACVSUJournal_00010030', 'ACVSUJournal_00010029', 'ACVSUJournal_00010028', 'ACVSUJournal_00010027', 'ACVSUJournal_00010026', 'ACVSUJournal_00010025']       
2025-11-25 12:20:34,025 INFO Built SQL for region laca, date 2025-09-16
2025-11-25 12:20:48,041 INFO City filter 'Pune' applied for region laca: rows before=12952 after=0
2025-11-25 12:20:48,049 INFO Wrote duration CSV for laca to outputs\laca_duration_20250916.csv (rows=0)
2025-11-25 12:20:48,050 INFO Wrote swipes CSV for laca to outputs\laca_swipes_20250916.csv (rows=0)
2025-11-25 12:20:48,050 INFO Fetching swipes for region namer on 2025-09-16
2025-11-25 12:20:49,970 INFO Databases present for server SRVWUDEN0891V: ['ACVSUJournal_00010030', 'ACVSUJournal_00010029', 'ACVSUJournal_00010028', 'ACVSUJournal_00010027', 'ACVSUJournal_00010026', 'ACVSUJournal_00010025']       
2025-11-25 12:20:49,971 INFO Built SQL for region namer, date 2025-09-16
2025-11-25 12:21:03,039 INFO City filter 'Pune' applied for region namer: rows before=4184 after=0
2025-11-25 12:21:03,054 INFO Wrote duration CSV for namer to outputs\namer_duration_20250916.csv (rows=0)
2025-11-25 12:21:03,054 INFO Wrote swipes CSV for namer to outputs\namer_swipes_20250916.csv (rows=0)
C:\Users\W0024618\Desktop\Trend Analysis\backend\duration_report.py:918: FutureWarning: 'S' is deprecated and will be removed in a future version, please use 's' instead.
  df["_lts_rounded"] = df["LocaleMessageTime"].dt.floor("S")
2025-11-25 12:21:03,884 INFO PersonnelTypeName values example: ['Employee']
2025-11-25 12:21:03,922 INFO PersonnelTypeName filter applied: before=18681 after=18681
2025-11-25 12:21:10,746 INFO Saved raw swipes to outputs\swipes_pune_20250916.csv
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:2192: FutureWarning: DataFrameGroupBy.apply operated on the grouping columns. This behavior is deprecated, and in a future version of pandas the grouping columns will be excluded from the operation. Either pass `include_groups=False` to exclude the groupings or explicitly select the grouping columns after groupby to silence this warning.
  raw_metrics_df = grouped_raw.apply(_agg_metrics).reset_index()
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:2267: FutureWarning: The behavior of array concatenation with empty entries is deprecated. In a future version, this will no longer exclude empty items when determining the result dtype. To retain the old behavior, exclude the empty entries before the concat operation.
  merged_metrics[base_col] = merged_metrics[raw_col].combine_first(merged_metrics.get(base_col))
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:2267: FutureWarning: The behavior of array concatenation with empty entries is deprecated. In a future version, this will no longer exclude empty items when determining the result dtype. To retain the old behavior, exclude the empty entries before the concat operation.
  merged_metrics[base_col] = merged_metrics[raw_col].combine_first(merged_metrics.get(base_col))
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:1722: FutureWarning: Downcasting object dtype arrays on .fillna, .ffill, .bfill is deprecated and will change in a future version. Call result.infer_objects(copy=False) instead. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  for ix, r in df[df['CountSwipes'].fillna(0).astype(int) == 0].iterrows():
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:1788: FutureWarning: Downcasting object dtype arrays on .fillna, .ffill, .bfill is deprecated and will change in a future version. Call result.infer_objects(copy=False) instead. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  df['PresentToday'] = df['CountSwipes'].fillna(0).astype(int) > 0
2025-11-25 12:21:18,197 INFO run_trend_for_date: wrote outputs\trend_pune_20250916.csv (rows=821)
2025-11-25 12:21:18,224 INFO build_monthly_training: running for 2025-09-17 (city=Pune)
2025-11-25 12:21:18,225 INFO Fetching swipes for region apac on 2025-09-17
2025-11-25 12:21:18,258 INFO Databases present for server SRVWUPNQ0986V: ['ACVSUJournal_00010030', 'ACVSUJournal_00010029', 'ACVSUJournal_00010028', 'ACVSUJournal_00010027', 'ACVSUJournal_00010026', 'ACVSUJournal_00010025']       
2025-11-25 12:21:18,258 INFO Built SQL for region apac, date 2025-09-17
2025-11-25 12:21:29,745 INFO APAC PartitionName2 mapping counts example: {'Pune': 20475, 'Quezon City': 6907, 'IN.HYD': 55, 'Taguig City': 30}
2025-11-25 12:21:30,393 INFO City filter 'Pune' applied for region apac: rows before=27467 after=20475
C:\Users\W0024618\Desktop\Trend Analysis\backend\duration_report.py:918: FutureWarning: 'S' is deprecated and will be removed in a future version, please use 's' instead.
  df["_lts_rounded"] = df["LocaleMessageTime"].dt.floor("S")
2025-11-25 12:21:31,658 INFO Wrote duration CSV for apac to outputs\apac_duration_20250917.csv (rows=872)
2025-11-25 12:21:31,659 INFO Wrote swipes CSV for apac to outputs\apac_swipes_20250917.csv (rows=20475)
2025-11-25 12:21:31,659 INFO Fetching swipes for region emea on 2025-09-17
2025-11-25 12:21:33,205 INFO Databases present for server SRVWUFRA0986V: ['ACVSUJournal_00011029', 'ACVSUJournal_00011028', 'ACVSUJournal_00011027', 'ACVSUJournal_00011026', 'ACVSUJournal_00011025', 'ACVSUJournal_00011024', 'ACVSUJournal_00011023']
2025-11-25 12:21:33,206 INFO Built SQL for region emea, date 2025-09-17
2025-11-25 12:21:37,068 INFO City filter 'Pune' applied for region emea: rows before=8164 after=0
2025-11-25 12:21:37,076 INFO Wrote duration CSV for emea to outputs\emea_duration_20250917.csv (rows=0)
2025-11-25 12:21:37,076 INFO Wrote swipes CSV for emea to outputs\emea_swipes_20250917.csv (rows=0)
2025-11-25 12:21:37,076 INFO Fetching swipes for region laca on 2025-09-17
2025-11-25 12:21:39,586 INFO Databases present for server SRVWUSJO0986V: ['ACVSUJournal_00010030', 'ACVSUJournal_00010029', 'ACVSUJournal_00010028', 'ACVSUJournal_00010027', 'ACVSUJournal_00010026', 'ACVSUJournal_00010025']       
2025-11-25 12:21:39,587 INFO Built SQL for region laca, date 2025-09-17
2025-11-25 12:21:53,369 INFO City filter 'Pune' applied for region laca: rows before=15317 after=0
2025-11-25 12:21:53,378 INFO Wrote duration CSV for laca to outputs\laca_duration_20250917.csv (rows=0)
2025-11-25 12:21:53,379 INFO Wrote swipes CSV for laca to outputs\laca_swipes_20250917.csv (rows=0)
2025-11-25 12:21:53,379 INFO Fetching swipes for region namer on 2025-09-17
2025-11-25 12:21:55,295 INFO Databases present for server SRVWUDEN0891V: ['ACVSUJournal_00010030', 'ACVSUJournal_00010029', 'ACVSUJournal_00010028', 'ACVSUJournal_00010027', 'ACVSUJournal_00010026', 'ACVSUJournal_00010025']       
2025-11-25 12:21:55,295 INFO Built SQL for region namer, date 2025-09-17
2025-11-25 12:22:00,911 INFO City filter 'Pune' applied for region namer: rows before=5450 after=0
2025-11-25 12:22:00,919 INFO Wrote duration CSV for namer to outputs\namer_duration_20250917.csv (rows=0)
2025-11-25 12:22:00,919 INFO Wrote swipes CSV for namer to outputs\namer_swipes_20250917.csv (rows=0)
C:\Users\W0024618\Desktop\Trend Analysis\backend\duration_report.py:918: FutureWarning: 'S' is deprecated and will be removed in a future version, please use 's' instead.
  df["_lts_rounded"] = df["LocaleMessageTime"].dt.floor("S")
2025-11-25 12:22:01,800 INFO PersonnelTypeName values example: ['Employee']
2025-11-25 12:22:01,846 INFO PersonnelTypeName filter applied: before=20475 after=20475
2025-11-25 12:22:09,674 INFO Saved raw swipes to outputs\swipes_pune_20250917.csv
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:2192: FutureWarning: DataFrameGroupBy.apply operated on the grouping columns. This behavior is deprecated, and in a future version of pandas the grouping columns will be excluded from the operation. Either pass `include_groups=False` to exclude the groupings or explicitly select the grouping columns after groupby to silence this warning.
  raw_metrics_df = grouped_raw.apply(_agg_metrics).reset_index()
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:2267: FutureWarning: The behavior of array concatenation with empty entries is deprecated. In a future version, this will no longer exclude empty items when determining the result dtype. To retain the old behavior, exclude the empty entries before the concat operation.
  merged_metrics[base_col] = merged_metrics[raw_col].combine_first(merged_metrics.get(base_col))
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:2267: FutureWarning: The behavior of array concatenation with empty entries is deprecated. In a future version, this will no longer exclude empty items when determining the result dtype. To retain the old behavior, exclude the empty entries before the concat operation.
  merged_metrics[base_col] = merged_metrics[raw_col].combine_first(merged_metrics.get(base_col))
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:1722: FutureWarning: Downcasting object dtype arrays on .fillna, .ffill, .bfill is deprecated and will change in a future version. Call result.infer_objects(copy=False) instead. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  for ix, r in df[df['CountSwipes'].fillna(0).astype(int) == 0].iterrows():
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:1788: FutureWarning: Downcasting object dtype arrays on .fillna, .ffill, .bfill is deprecated and will change in a future version. Call result.infer_objects(copy=False) instead. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  df['PresentToday'] = df['CountSwipes'].fillna(0).astype(int) > 0
2025-11-25 12:22:18,709 INFO run_trend_for_date: wrote outputs\trend_pune_20250917.csv (rows=872)
2025-11-25 12:22:18,746 INFO build_monthly_training: running for 2025-09-18 (city=Pune)
2025-11-25 12:22:18,747 INFO Fetching swipes for region apac on 2025-09-18
2025-11-25 12:22:18,871 INFO Databases present for server SRVWUPNQ0986V: ['ACVSUJournal_00010030', 'ACVSUJournal_00010029', 'ACVSUJournal_00010028', 'ACVSUJournal_00010027', 'ACVSUJournal_00010026', 'ACVSUJournal_00010025']       
2025-11-25 12:22:18,872 INFO Built SQL for region apac, date 2025-09-18
2025-11-25 12:22:28,460 INFO APAC PartitionName2 mapping counts example: {'Pune': 13082, 'Quezon City': 5517, 'IN.HYD': 32, 'Taguig City': 20}
2025-11-25 12:22:28,888 INFO City filter 'Pune' applied for region apac: rows before=18651 after=13082
C:\Users\W0024618\Desktop\Trend Analysis\backend\duration_report.py:918: FutureWarning: 'S' is deprecated and will be removed in a future version, please use 's' instead.
  df["_lts_rounded"] = df["LocaleMessageTime"].dt.floor("S")
2025-11-25 12:22:29,831 INFO Wrote duration CSV for apac to outputs\apac_duration_20250918.csv (rows=579)
2025-11-25 12:22:29,831 INFO Wrote swipes CSV for apac to outputs\apac_swipes_20250918.csv (rows=13082)
2025-11-25 12:22:29,831 INFO Fetching swipes for region emea on 2025-09-18
2025-11-25 12:22:30,875 INFO Databases present for server SRVWUFRA0986V: ['ACVSUJournal_00011029', 'ACVSUJournal_00011028', 'ACVSUJournal_00011027', 'ACVSUJournal_00011026', 'ACVSUJournal_00011025', 'ACVSUJournal_00011024', 'ACVSUJournal_00011023']
2025-11-25 12:22:30,876 INFO Built SQL for region emea, date 2025-09-18
2025-11-25 12:22:34,594 INFO City filter 'Pune' applied for region emea: rows before=6005 after=0
2025-11-25 12:22:34,605 INFO Wrote duration CSV for emea to outputs\emea_duration_20250918.csv (rows=0)
2025-11-25 12:22:34,605 INFO Wrote swipes CSV for emea to outputs\emea_swipes_20250918.csv (rows=0)
2025-11-25 12:22:34,605 INFO Fetching swipes for region laca on 2025-09-18
2025-11-25 12:22:37,107 INFO Databases present for server SRVWUSJO0986V: ['ACVSUJournal_00010030', 'ACVSUJournal_00010029', 'ACVSUJournal_00010028', 'ACVSUJournal_00010027', 'ACVSUJournal_00010026', 'ACVSUJournal_00010025']       
2025-11-25 12:22:37,107 INFO Built SQL for region laca, date 2025-09-18
2025-11-25 12:22:57,152 INFO City filter 'Pune' applied for region laca: rows before=13275 after=0
2025-11-25 12:22:57,160 INFO Wrote duration CSV for laca to outputs\laca_duration_20250918.csv (rows=0)
2025-11-25 12:22:57,161 INFO Wrote swipes CSV for laca to outputs\laca_swipes_20250918.csv (rows=0)
2025-11-25 12:22:57,161 INFO Fetching swipes for region namer on 2025-09-18
2025-11-25 12:22:59,070 INFO Databases present for server SRVWUDEN0891V: ['ACVSUJournal_00010030', 'ACVSUJournal_00010029', 'ACVSUJournal_00010028', 'ACVSUJournal_00010027', 'ACVSUJournal_00010026', 'ACVSUJournal_00010025']       
2025-11-25 12:22:59,071 INFO Built SQL for region namer, date 2025-09-18
2025-11-25 12:23:03,126 INFO City filter 'Pune' applied for region namer: rows before=3241 after=0
2025-11-25 12:23:03,134 INFO Wrote duration CSV for namer to outputs\namer_duration_20250918.csv (rows=0)
2025-11-25 12:23:03,134 INFO Wrote swipes CSV for namer to outputs\namer_swipes_20250918.csv (rows=0)
C:\Users\W0024618\Desktop\Trend Analysis\backend\duration_report.py:918: FutureWarning: 'S' is deprecated and will be removed in a future version, please use 's' instead.
  df["_lts_rounded"] = df["LocaleMessageTime"].dt.floor("S")
2025-11-25 12:23:03,619 INFO PersonnelTypeName values example: ['Employee']
2025-11-25 12:23:03,644 INFO PersonnelTypeName filter applied: before=13082 after=13082
2025-11-25 12:23:08,451 INFO Saved raw swipes to outputs\swipes_pune_20250918.csv
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:2192: FutureWarning: DataFrameGroupBy.apply operated on the grouping columns. This behavior is deprecated, and in a future version of pandas the grouping columns will be excluded from the operation. Either pass `include_groups=False` to exclude the groupings or explicitly select the grouping columns after groupby to silence this warning.
  raw_metrics_df = grouped_raw.apply(_agg_metrics).reset_index()
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:2267: FutureWarning: The behavior of array concatenation with empty entries is deprecated. In a future version, this will no longer exclude empty items when determining the result dtype. To retain the old behavior, exclude the empty entries before the concat operation.
  merged_metrics[base_col] = merged_metrics[raw_col].combine_first(merged_metrics.get(base_col))
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:2267: FutureWarning: The behavior of array concatenation with empty entries is deprecated. In a future version, this will no longer exclude empty items when determining the result dtype. To retain the old behavior, exclude the empty entries before the concat operation.
  merged_metrics[base_col] = merged_metrics[raw_col].combine_first(merged_metrics.get(base_col))
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:1722: FutureWarning: Downcasting object dtype arrays on .fillna, .ffill, .bfill is deprecated and will change in a future version. Call result.infer_objects(copy=False) instead. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  for ix, r in df[df['CountSwipes'].fillna(0).astype(int) == 0].iterrows():
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:1788: FutureWarning: Downcasting object dtype arrays on .fillna, .ffill, .bfill is deprecated and will change in a future version. Call result.infer_objects(copy=False) instead. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  df['PresentToday'] = df['CountSwipes'].fillna(0).astype(int) > 0
2025-11-25 12:23:14,983 INFO run_trend_for_date: wrote outputs\trend_pune_20250918.csv (rows=579)
2025-11-25 12:23:15,000 INFO build_monthly_training: running for 2025-09-19 (city=Pune)
2025-11-25 12:23:15,001 INFO Fetching swipes for region apac on 2025-09-19
2025-11-25 12:23:15,373 INFO Databases present for server SRVWUPNQ0986V: ['ACVSUJournal_00010030', 'ACVSUJournal_00010029', 'ACVSUJournal_00010028', 'ACVSUJournal_00010027', 'ACVSUJournal_00010026', 'ACVSUJournal_00010025']       
2025-11-25 12:23:15,374 INFO Built SQL for region apac, date 2025-09-19
2025-11-25 12:23:27,735 INFO APAC PartitionName2 mapping counts example: {'Pune': 6618, 'Quezon City': 2891, 'IN.HYD': 38, 'Taguig City': 24}
2025-11-25 12:23:28,676 INFO City filter 'Pune' applied for region apac: rows before=9571 after=6618
C:\Users\W0024618\Desktop\Trend Analysis\backend\duration_report.py:918: FutureWarning: 'S' is deprecated and will be removed in a future version, please use 's' instead.
  df["_lts_rounded"] = df["LocaleMessageTime"].dt.floor("S")
2025-11-25 12:23:29,745 INFO Wrote duration CSV for apac to outputs\apac_duration_20250919.csv (rows=302)
2025-11-25 12:23:29,746 INFO Wrote swipes CSV for apac to outputs\apac_swipes_20250919.csv (rows=6618)
2025-11-25 12:23:29,746 INFO Fetching swipes for region emea on 2025-09-19
2025-11-25 12:23:31,151 INFO Databases present for server SRVWUFRA0986V: ['ACVSUJournal_00011029', 'ACVSUJournal_00011028', 'ACVSUJournal_00011027', 'ACVSUJournal_00011026', 'ACVSUJournal_00011025', 'ACVSUJournal_00011024', 'ACVSUJournal_00011023']
2025-11-25 12:23:31,151 INFO Built SQL for region emea, date 2025-09-19
2025-11-25 12:23:34,751 INFO City filter 'Pune' applied for region emea: rows before=3671 after=0
2025-11-25 12:23:34,760 INFO Wrote duration CSV for emea to outputs\emea_duration_20250919.csv (rows=0)
2025-11-25 12:23:34,760 INFO Wrote swipes CSV for emea to outputs\emea_swipes_20250919.csv (rows=0)
2025-11-25 12:23:34,760 INFO Fetching swipes for region laca on 2025-09-19
2025-11-25 12:23:37,509 INFO Databases present for server SRVWUSJO0986V: ['ACVSUJournal_00010030', 'ACVSUJournal_00010029', 'ACVSUJournal_00010028', 'ACVSUJournal_00010027', 'ACVSUJournal_00010026', 'ACVSUJournal_00010025']       
2025-11-25 12:23:37,510 INFO Built SQL for region laca, date 2025-09-19
2025-11-25 12:23:50,972 INFO City filter 'Pune' applied for region laca: rows before=6556 after=0
2025-11-25 12:23:50,982 INFO Wrote duration CSV for laca to outputs\laca_duration_20250919.csv (rows=0)
2025-11-25 12:23:50,982 INFO Wrote swipes CSV for laca to outputs\laca_swipes_20250919.csv (rows=0)
2025-11-25 12:23:50,982 INFO Fetching swipes for region namer on 2025-09-19
2025-11-25 12:23:53,181 INFO Databases present for server SRVWUDEN0891V: ['ACVSUJournal_00010030', 'ACVSUJournal_00010029', 'ACVSUJournal_00010028', 'ACVSUJournal_00010027', 'ACVSUJournal_00010026', 'ACVSUJournal_00010025']       
2025-11-25 12:23:53,182 INFO Built SQL for region namer, date 2025-09-19
2025-11-25 12:23:56,692 INFO City filter 'Pune' applied for region namer: rows before=1639 after=0
2025-11-25 12:23:56,699 INFO Wrote duration CSV for namer to outputs\namer_duration_20250919.csv (rows=0)
2025-11-25 12:23:56,700 INFO Wrote swipes CSV for namer to outputs\namer_swipes_20250919.csv (rows=0)
C:\Users\W0024618\Desktop\Trend Analysis\backend\duration_report.py:918: FutureWarning: 'S' is deprecated and will be removed in a future version, please use 's' instead.
  df["_lts_rounded"] = df["LocaleMessageTime"].dt.floor("S")
2025-11-25 12:23:57,011 INFO PersonnelTypeName values example: ['Employee']
2025-11-25 12:23:57,025 INFO PersonnelTypeName filter applied: before=6618 after=6618
2025-11-25 12:23:59,568 INFO Saved raw swipes to outputs\swipes_pune_20250919.csv
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:2192: FutureWarning: DataFrameGroupBy.apply operated on the grouping columns. This behavior is deprecated, and in a future version of pandas the grouping columns will be excluded from the operation. Either pass `include_groups=False` to exclude the groupings or explicitly select the grouping columns after groupby to silence this warning.
  raw_metrics_df = grouped_raw.apply(_agg_metrics).reset_index()
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:2267: FutureWarning: The behavior of array concatenation with empty entries is deprecated. In a future version, this will no longer exclude empty items when determining the result dtype. To retain the old behavior, exclude the empty entries before the concat operation.
  merged_metrics[base_col] = merged_metrics[raw_col].combine_first(merged_metrics.get(base_col))
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:2267: FutureWarning: The behavior of array concatenation with empty entries is deprecated. In a future version, this will no longer exclude empty items when determining the result dtype. To retain the old behavior, exclude the empty entries before the concat operation.
  merged_metrics[base_col] = merged_metrics[raw_col].combine_first(merged_metrics.get(base_col))
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:1722: FutureWarning: Downcasting object dtype arrays on .fillna, .ffill, .bfill is deprecated and will change in a future version. Call result.infer_objects(copy=False) instead. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  for ix, r in df[df['CountSwipes'].fillna(0).astype(int) == 0].iterrows():
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:1788: FutureWarning: Downcasting object dtype arrays on .fillna, .ffill, .bfill is deprecated and will change in a future version. Call result.infer_objects(copy=False) instead. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  df['PresentToday'] = df['CountSwipes'].fillna(0).astype(int) > 0
2025-11-25 12:24:04,878 INFO run_trend_for_date: wrote outputs\trend_pune_20250919.csv (rows=303)
2025-11-25 12:24:04,888 INFO build_monthly_training: running for 2025-09-20 (city=Pune)
2025-11-25 12:24:04,889 INFO Fetching swipes for region apac on 2025-09-20
2025-11-25 12:24:05,402 INFO Databases present for server SRVWUPNQ0986V: ['ACVSUJournal_00010030', 'ACVSUJournal_00010029', 'ACVSUJournal_00010028', 'ACVSUJournal_00010027', 'ACVSUJournal_00010026', 'ACVSUJournal_00010025']       
2025-11-25 12:24:05,402 INFO Built SQL for region apac, date 2025-09-20
2025-11-25 12:24:16,463 INFO APAC PartitionName2 mapping counts example: {'Quezon City': 1161, 'Pune': 86, 'Taguig City': 8}
2025-11-25 12:24:16,509 INFO City filter 'Pune' applied for region apac: rows before=1255 after=86
C:\Users\W0024618\Desktop\Trend Analysis\backend\duration_report.py:918: FutureWarning: 'S' is deprecated and will be removed in a future version, please use 's' instead.
  df["_lts_rounded"] = df["LocaleMessageTime"].dt.floor("S")
2025-11-25 12:24:16,563 INFO Wrote duration CSV for apac to outputs\apac_duration_20250920.csv (rows=5)
2025-11-25 12:24:16,564 INFO Wrote swipes CSV for apac to outputs\apac_swipes_20250920.csv (rows=86)
2025-11-25 12:24:16,564 INFO Fetching swipes for region emea on 2025-09-20
2025-11-25 12:24:18,154 INFO Databases present for server SRVWUFRA0986V: ['ACVSUJournal_00011029', 'ACVSUJournal_00011028', 'ACVSUJournal_00011027', 'ACVSUJournal_00011026', 'ACVSUJournal_00011025', 'ACVSUJournal_00011024', 'ACVSUJournal_00011023']
2025-11-25 12:24:18,154 INFO Built SQL for region emea, date 2025-09-20
2025-11-25 12:24:21,810 INFO City filter 'Pune' applied for region emea: rows before=222 after=0
2025-11-25 12:24:21,829 INFO Wrote duration CSV for emea to outputs\emea_duration_20250920.csv (rows=0)
2025-11-25 12:24:21,829 INFO Wrote swipes CSV for emea to outputs\emea_swipes_20250920.csv (rows=0)
2025-11-25 12:24:21,830 INFO Fetching swipes for region laca on 2025-09-20
2025-11-25 12:24:24,473 INFO Databases present for server SRVWUSJO0986V: ['ACVSUJournal_00010030', 'ACVSUJournal_00010029', 'ACVSUJournal_00010028', 'ACVSUJournal_00010027', 'ACVSUJournal_00010026', 'ACVSUJournal_00010025']       
2025-11-25 12:24:24,473 INFO Built SQL for region laca, date 2025-09-20
2025-11-25 12:24:29,724 INFO City filter 'Pune' applied for region laca: rows before=102 after=0
2025-11-25 12:24:29,734 INFO Wrote duration CSV for laca to outputs\laca_duration_20250920.csv (rows=0)
2025-11-25 12:24:29,735 INFO Wrote swipes CSV for laca to outputs\laca_swipes_20250920.csv (rows=0)
2025-11-25 12:24:29,736 INFO Fetching swipes for region namer on 2025-09-20
2025-11-25 12:24:31,779 INFO Databases present for server SRVWUDEN0891V: ['ACVSUJournal_00010030', 'ACVSUJournal_00010029', 'ACVSUJournal_00010028', 'ACVSUJournal_00010027', 'ACVSUJournal_00010026', 'ACVSUJournal_00010025']       
2025-11-25 12:24:31,779 INFO Built SQL for region namer, date 2025-09-20
2025-11-25 12:24:34,565 INFO City filter 'Pune' applied for region namer: rows before=43 after=0
2025-11-25 12:24:34,575 INFO Wrote duration CSV for namer to outputs\namer_duration_20250920.csv (rows=0)
2025-11-25 12:24:34,576 INFO Wrote swipes CSV for namer to outputs\namer_swipes_20250920.csv (rows=0)
C:\Users\W0024618\Desktop\Trend Analysis\backend\duration_report.py:918: FutureWarning: 'S' is deprecated and will be removed in a future version, please use 's' instead.
  df["_lts_rounded"] = df["LocaleMessageTime"].dt.floor("S")
2025-11-25 12:24:34,621 INFO PersonnelTypeName values example: ['Employee']
2025-11-25 12:24:34,623 INFO PersonnelTypeName filter applied: before=86 after=86
2025-11-25 12:24:34,697 INFO Saved raw swipes to outputs\swipes_pune_20250920.csv
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:2192: FutureWarning: DataFrameGroupBy.apply operated on the grouping columns. This behavior is deprecated, and in a future version of pandas the grouping columns will be excluded from the operation. Either pass `include_groups=False` to exclude the groupings or explicitly select the grouping columns after groupby to silence this warning.
  raw_metrics_df = grouped_raw.apply(_agg_metrics).reset_index()
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:2267: FutureWarning: The behavior of array concatenation with empty entries is deprecated. In a future version, this will no longer exclude empty items when determining the result dtype. To retain the old behavior, exclude the empty entries before the concat operation.
  merged_metrics[base_col] = merged_metrics[raw_col].combine_first(merged_metrics.get(base_col))
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:2267: FutureWarning: The behavior of array concatenation with empty entries is deprecated. In a future version, this will no longer exclude empty items when determining the result dtype. To retain the old behavior, exclude the empty entries before the concat operation.
  merged_metrics[base_col] = merged_metrics[raw_col].combine_first(merged_metrics.get(base_col))
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:1722: FutureWarning: Downcasting object dtype arrays on .fillna, .ffill, .bfill is deprecated and will change in a future version. Call result.infer_objects(copy=False) instead. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  for ix, r in df[df['CountSwipes'].fillna(0).astype(int) == 0].iterrows():
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:1788: FutureWarning: Downcasting object dtype arrays on .fillna, .ffill, .bfill is deprecated and will change in a future version. Call result.infer_objects(copy=False) instead. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  df['PresentToday'] = df['CountSwipes'].fillna(0).astype(int) > 0
2025-11-25 12:24:39,852 INFO run_trend_for_date: wrote outputs\trend_pune_20250920.csv (rows=5)
2025-11-25 12:24:39,853 INFO build_monthly_training: running for 2025-09-21 (city=Pune)
2025-11-25 12:24:39,854 INFO Fetching swipes for region apac on 2025-09-21
2025-11-25 12:24:39,929 INFO Databases present for server SRVWUPNQ0986V: ['ACVSUJournal_00010030', 'ACVSUJournal_00010029', 'ACVSUJournal_00010028', 'ACVSUJournal_00010027', 'ACVSUJournal_00010026', 'ACVSUJournal_00010025']       
2025-11-25 12:24:39,929 INFO Built SQL for region apac, date 2025-09-21
2025-11-25 12:24:46,385 INFO APAC PartitionName2 mapping counts example: {'Quezon City': 852, 'Pune': 164}
2025-11-25 12:24:46,433 INFO City filter 'Pune' applied for region apac: rows before=1016 after=164
C:\Users\W0024618\Desktop\Trend Analysis\backend\duration_report.py:918: FutureWarning: 'S' is deprecated and will be removed in a future version, please use 's' instead.
  df["_lts_rounded"] = df["LocaleMessageTime"].dt.floor("S")
2025-11-25 12:24:46,505 INFO Wrote duration CSV for apac to outputs\apac_duration_20250921.csv (rows=12)
2025-11-25 12:24:46,506 INFO Wrote swipes CSV for apac to outputs\apac_swipes_20250921.csv (rows=164)
2025-11-25 12:24:46,506 INFO Fetching swipes for region emea on 2025-09-21
2025-11-25 12:24:47,576 INFO Databases present for server SRVWUFRA0986V: ['ACVSUJournal_00011029', 'ACVSUJournal_00011028', 'ACVSUJournal_00011027', 'ACVSUJournal_00011026', 'ACVSUJournal_00011025', 'ACVSUJournal_00011024', 'ACVSUJournal_00011023']
2025-11-25 12:24:47,577 INFO Built SQL for region emea, date 2025-09-21
2025-11-25 12:24:50,364 INFO City filter 'Pune' applied for region emea: rows before=262 after=0
2025-11-25 12:24:50,375 INFO Wrote duration CSV for emea to outputs\emea_duration_20250921.csv (rows=0)
2025-11-25 12:24:50,375 INFO Wrote swipes CSV for emea to outputs\emea_swipes_20250921.csv (rows=0)
2025-11-25 12:24:50,375 INFO Fetching swipes for region laca on 2025-09-21
2025-11-25 12:24:52,919 INFO Databases present for server SRVWUSJO0986V: ['ACVSUJournal_00010030', 'ACVSUJournal_00010029', 'ACVSUJournal_00010028', 'ACVSUJournal_00010027', 'ACVSUJournal_00010026', 'ACVSUJournal_00010025']       
2025-11-25 12:24:52,919 INFO Built SQL for region laca, date 2025-09-21
2025-11-25 12:24:58,900 INFO City filter 'Pune' applied for region laca: rows before=114 after=0
2025-11-25 12:24:58,907 INFO Wrote duration CSV for laca to outputs\laca_duration_20250921.csv (rows=0)
2025-11-25 12:24:58,907 INFO Wrote swipes CSV for laca to outputs\laca_swipes_20250921.csv (rows=0)
2025-11-25 12:24:58,907 INFO Fetching swipes for region namer on 2025-09-21
2025-11-25 12:25:00,864 INFO Databases present for server SRVWUDEN0891V: ['ACVSUJournal_00010030', 'ACVSUJournal_00010029', 'ACVSUJournal_00010028', 'ACVSUJournal_00010027', 'ACVSUJournal_00010026', 'ACVSUJournal_00010025']       
2025-11-25 12:25:00,865 INFO Built SQL for region namer, date 2025-09-21
2025-11-25 12:25:03,671 INFO City filter 'Pune' applied for region namer: rows before=9 after=0
2025-11-25 12:25:03,681 INFO Wrote duration CSV for namer to outputs\namer_duration_20250921.csv (rows=0)
2025-11-25 12:25:03,681 INFO Wrote swipes CSV for namer to outputs\namer_swipes_20250921.csv (rows=0)
C:\Users\W0024618\Desktop\Trend Analysis\backend\duration_report.py:918: FutureWarning: 'S' is deprecated and will be removed in a future version, please use 's' instead.
  df["_lts_rounded"] = df["LocaleMessageTime"].dt.floor("S")
2025-11-25 12:25:03,737 INFO PersonnelTypeName values example: ['Employee']
2025-11-25 12:25:03,739 INFO PersonnelTypeName filter applied: before=164 after=164
2025-11-25 12:25:03,859 INFO Saved raw swipes to outputs\swipes_pune_20250921.csv
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:2192: FutureWarning: DataFrameGroupBy.apply operated on the grouping columns. This behavior is deprecated, and in a future version of pandas the grouping columns will be excluded from the operation. Either pass `include_groups=False` to exclude the groupings or explicitly select the grouping columns after groupby to silence this warning.
  raw_metrics_df = grouped_raw.apply(_agg_metrics).reset_index()
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:2267: FutureWarning: The behavior of array concatenation with empty entries is deprecated. In a future version, this will no longer exclude empty items when determining the result dtype. To retain the old behavior, exclude the empty entries before the concat operation.
  merged_metrics[base_col] = merged_metrics[raw_col].combine_first(merged_metrics.get(base_col))
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:2267: FutureWarning: The behavior of array concatenation with empty entries is deprecated. In a future version, this will no longer exclude empty items when determining the result dtype. To retain the old behavior, exclude the empty entries before the concat operation.
  merged_metrics[base_col] = merged_metrics[raw_col].combine_first(merged_metrics.get(base_col))
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:1722: FutureWarning: Downcasting object dtype arrays on .fillna, .ffill, .bfill is deprecated and will change in a future version. Call result.infer_objects(copy=False) instead. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  for ix, r in df[df['CountSwipes'].fillna(0).astype(int) == 0].iterrows():
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:1788: FutureWarning: Downcasting object dtype arrays on .fillna, .ffill, .bfill is deprecated and will change in a future version. Call result.infer_objects(copy=False) instead. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  df['PresentToday'] = df['CountSwipes'].fillna(0).astype(int) > 0
2025-11-25 12:25:08,068 INFO run_trend_for_date: wrote outputs\trend_pune_20250921.csv (rows=12)
2025-11-25 12:25:08,069 INFO build_monthly_training: running for 2025-09-22 (city=Pune)
2025-11-25 12:25:08,070 INFO Fetching swipes for region apac on 2025-09-22
2025-11-25 12:25:08,184 INFO Databases present for server SRVWUPNQ0986V: ['ACVSUJournal_00010030', 'ACVSUJournal_00010029', 'ACVSUJournal_00010028', 'ACVSUJournal_00010027', 'ACVSUJournal_00010026', 'ACVSUJournal_00010025']       
2025-11-25 12:25:08,185 INFO Built SQL for region apac, date 2025-09-22
2025-11-25 12:25:17,993 INFO APAC PartitionName2 mapping counts example: {'Pune': 15107, 'Quezon City': 2884, 'IN.HYD': 122, 'Taguig City': 29}
2025-11-25 12:25:18,434 INFO City filter 'Pune' applied for region apac: rows before=18142 after=15107
C:\Users\W0024618\Desktop\Trend Analysis\backend\duration_report.py:918: FutureWarning: 'S' is deprecated and will be removed in a future version, please use 's' instead.
  df["_lts_rounded"] = df["LocaleMessageTime"].dt.floor("S")
2025-11-25 12:25:19,438 INFO Wrote duration CSV for apac to outputs\apac_duration_20250922.csv (rows=652)
2025-11-25 12:25:19,439 INFO Wrote swipes CSV for apac to outputs\apac_swipes_20250922.csv (rows=15107)
2025-11-25 12:25:19,439 INFO Fetching swipes for region emea on 2025-09-22
2025-11-25 12:25:20,471 INFO Databases present for server SRVWUFRA0986V: ['ACVSUJournal_00011029', 'ACVSUJournal_00011028', 'ACVSUJournal_00011027', 'ACVSUJournal_00011026', 'ACVSUJournal_00011025', 'ACVSUJournal_00011024', 'ACVSUJournal_00011023']
2025-11-25 12:25:20,472 INFO Built SQL for region emea, date 2025-09-22
2025-11-25 12:25:24,090 INFO City filter 'Pune' applied for region emea: rows before=5560 after=0
2025-11-25 12:25:24,098 INFO Wrote duration CSV for emea to outputs\emea_duration_20250922.csv (rows=0)
2025-11-25 12:25:24,099 INFO Wrote swipes CSV for emea to outputs\emea_swipes_20250922.csv (rows=0)
2025-11-25 12:25:24,099 INFO Fetching swipes for region laca on 2025-09-22
2025-11-25 12:25:26,629 INFO Databases present for server SRVWUSJO0986V: ['ACVSUJournal_00010030', 'ACVSUJournal_00010029', 'ACVSUJournal_00010028', 'ACVSUJournal_00010027', 'ACVSUJournal_00010026', 'ACVSUJournal_00010025']       
2025-11-25 12:25:26,630 INFO Built SQL for region laca, date 2025-09-22
2025-11-25 12:25:37,644 INFO City filter 'Pune' applied for region laca: rows before=9056 after=0
2025-11-25 12:25:37,652 INFO Wrote duration CSV for laca to outputs\laca_duration_20250922.csv (rows=0)
2025-11-25 12:25:37,652 INFO Wrote swipes CSV for laca to outputs\laca_swipes_20250922.csv (rows=0)
2025-11-25 12:25:37,652 INFO Fetching swipes for region namer on 2025-09-22
2025-11-25 12:25:39,588 INFO Databases present for server SRVWUDEN0891V: ['ACVSUJournal_00010030', 'ACVSUJournal_00010029', 'ACVSUJournal_00010028', 'ACVSUJournal_00010027', 'ACVSUJournal_00010026', 'ACVSUJournal_00010025']       
2025-11-25 12:25:39,589 INFO Built SQL for region namer, date 2025-09-22
2025-11-25 12:25:43,692 INFO City filter 'Pune' applied for region namer: rows before=3562 after=0
2025-11-25 12:25:43,700 INFO Wrote duration CSV for namer to outputs\namer_duration_20250922.csv (rows=0)
2025-11-25 12:25:43,700 INFO Wrote swipes CSV for namer to outputs\namer_swipes_20250922.csv (rows=0)
C:\Users\W0024618\Desktop\Trend Analysis\backend\duration_report.py:918: FutureWarning: 'S' is deprecated and will be removed in a future version, please use 's' instead.
  df["_lts_rounded"] = df["LocaleMessageTime"].dt.floor("S")
2025-11-25 12:25:44,247 INFO PersonnelTypeName values example: ['Employee']
2025-11-25 12:25:44,273 INFO PersonnelTypeName filter applied: before=15107 after=15107
2025-11-25 12:25:49,593 INFO Saved raw swipes to outputs\swipes_pune_20250922.csv
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:2192: FutureWarning: DataFrameGroupBy.apply operated on the grouping columns. This behavior is deprecated, and in a future version of pandas the grouping columns will be excluded from the operation. Either pass `include_groups=False` to exclude the groupings or explicitly select the grouping columns after groupby to silence this warning.
  raw_metrics_df = grouped_raw.apply(_agg_metrics).reset_index()
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:2267: FutureWarning: The behavior of array concatenation with empty entries is deprecated. In a future version, this will no longer exclude empty items when determining the result dtype. To retain the old behavior, exclude the empty entries before the concat operation.
  merged_metrics[base_col] = merged_metrics[raw_col].combine_first(merged_metrics.get(base_col))
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:2267: FutureWarning: The behavior of array concatenation with empty entries is deprecated. In a future version, this will no longer exclude empty items when determining the result dtype. To retain the old behavior, exclude the empty entries before the concat operation.
  merged_metrics[base_col] = merged_metrics[raw_col].combine_first(merged_metrics.get(base_col))
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:1722: FutureWarning: Downcasting object dtype arrays on .fillna, .ffill, .bfill is deprecated and will change in a future version. Call result.infer_objects(copy=False) instead. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  for ix, r in df[df['CountSwipes'].fillna(0).astype(int) == 0].iterrows():
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:1788: FutureWarning: Downcasting object dtype arrays on .fillna, .ffill, .bfill is deprecated and will change in a future version. Call result.infer_objects(copy=False) instead. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  df['PresentToday'] = df['CountSwipes'].fillna(0).astype(int) > 0
2025-11-25 12:25:57,616 INFO run_trend_for_date: wrote outputs\trend_pune_20250922.csv (rows=652)
2025-11-25 12:25:57,636 INFO build_monthly_training: running for 2025-09-23 (city=Pune)
2025-11-25 12:25:57,637 INFO Fetching swipes for region apac on 2025-09-23
2025-11-25 12:25:57,667 INFO Databases present for server SRVWUPNQ0986V: ['ACVSUJournal_00010030', 'ACVSUJournal_00010029', 'ACVSUJournal_00010028', 'ACVSUJournal_00010027', 'ACVSUJournal_00010026', 'ACVSUJournal_00010025']       
2025-11-25 12:25:57,667 INFO Built SQL for region apac, date 2025-09-23
2025-11-25 12:26:07,564 INFO APAC PartitionName2 mapping counts example: {'Pune': 16651, 'Quezon City': 3562, 'IN.HYD': 103, 'Taguig City': 25}
2025-11-25 12:26:08,111 INFO City filter 'Pune' applied for region apac: rows before=20341 after=16651
C:\Users\W0024618\Desktop\Trend Analysis\backend\duration_report.py:918: FutureWarning: 'S' is deprecated and will be removed in a future version, please use 's' instead.
  df["_lts_rounded"] = df["LocaleMessageTime"].dt.floor("S")
2025-11-25 12:26:09,177 INFO Wrote duration CSV for apac to outputs\apac_duration_20250923.csv (rows=739)
2025-11-25 12:26:09,178 INFO Wrote swipes CSV for apac to outputs\apac_swipes_20250923.csv (rows=16651)
2025-11-25 12:26:09,178 INFO Fetching swipes for region emea on 2025-09-23
2025-11-25 12:26:10,269 INFO Databases present for server SRVWUFRA0986V: ['ACVSUJournal_00011029', 'ACVSUJournal_00011028', 'ACVSUJournal_00011027', 'ACVSUJournal_00011026', 'ACVSUJournal_00011025', 'ACVSUJournal_00011024', 'ACVSUJournal_00011023']
2025-11-25 12:26:10,270 INFO Built SQL for region emea, date 2025-09-23
2025-11-25 12:26:14,064 INFO City filter 'Pune' applied for region emea: rows before=7630 after=0
2025-11-25 12:26:14,073 INFO Wrote duration CSV for emea to outputs\emea_duration_20250923.csv (rows=0)
2025-11-25 12:26:14,074 INFO Wrote swipes CSV for emea to outputs\emea_swipes_20250923.csv (rows=0)
2025-11-25 12:26:14,074 INFO Fetching swipes for region laca on 2025-09-23
2025-11-25 12:26:16,674 INFO Databases present for server SRVWUSJO0986V: ['ACVSUJournal_00010030', 'ACVSUJournal_00010029', 'ACVSUJournal_00010028', 'ACVSUJournal_00010027', 'ACVSUJournal_00010026', 'ACVSUJournal_00010025']       
2025-11-25 12:26:16,674 INFO Built SQL for region laca, date 2025-09-23
2025-11-25 12:26:27,232 INFO City filter 'Pune' applied for region laca: rows before=14269 after=0
2025-11-25 12:26:27,242 INFO Wrote duration CSV for laca to outputs\laca_duration_20250923.csv (rows=0)
2025-11-25 12:26:27,242 INFO Wrote swipes CSV for laca to outputs\laca_swipes_20250923.csv (rows=0)
2025-11-25 12:26:27,243 INFO Fetching swipes for region namer on 2025-09-23
2025-11-25 12:26:29,181 INFO Databases present for server SRVWUDEN0891V: ['ACVSUJournal_00010030', 'ACVSUJournal_00010029', 'ACVSUJournal_00010028', 'ACVSUJournal_00010027', 'ACVSUJournal_00010026', 'ACVSUJournal_00010025']       
2025-11-25 12:26:29,182 INFO Built SQL for region namer, date 2025-09-23
2025-11-25 12:26:33,711 INFO City filter 'Pune' applied for region namer: rows before=4660 after=0
2025-11-25 12:26:33,719 INFO Wrote duration CSV for namer to outputs\namer_duration_20250923.csv (rows=0)
2025-11-25 12:26:33,720 INFO Wrote swipes CSV for namer to outputs\namer_swipes_20250923.csv (rows=0)
C:\Users\W0024618\Desktop\Trend Analysis\backend\duration_report.py:918: FutureWarning: 'S' is deprecated and will be removed in a future version, please use 's' instead.
  df["_lts_rounded"] = df["LocaleMessageTime"].dt.floor("S")
2025-11-25 12:26:34,296 INFO PersonnelTypeName values example: ['Employee']
2025-11-25 12:26:34,331 INFO PersonnelTypeName filter applied: before=16651 after=16651
2025-11-25 12:26:40,918 INFO Saved raw swipes to outputs\swipes_pune_20250923.csv
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:2192: FutureWarning: DataFrameGroupBy.apply operated on the grouping columns. This behavior is deprecated, and in a future version of pandas the grouping columns will be excluded from the operation. Either pass `include_groups=False` to exclude the groupings or explicitly select the grouping columns after groupby to silence this warning.
  raw_metrics_df = grouped_raw.apply(_agg_metrics).reset_index()
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:2267: FutureWarning: The behavior of array concatenation with empty entries is deprecated. In a future version, this will no longer exclude empty items when determining the result dtype. To retain the old behavior, exclude the empty entries before the concat operation.
  merged_metrics[base_col] = merged_metrics[raw_col].combine_first(merged_metrics.get(base_col))
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:2267: FutureWarning: The behavior of array concatenation with empty entries is deprecated. In a future version, this will no longer exclude empty items when determining the result dtype. To retain the old behavior, exclude the empty entries before the concat operation.
  merged_metrics[base_col] = merged_metrics[raw_col].combine_first(merged_metrics.get(base_col))
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:1722: FutureWarning: Downcasting object dtype arrays on .fillna, .ffill, .bfill is deprecated and will change in a future version. Call result.infer_objects(copy=False) instead. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  for ix, r in df[df['CountSwipes'].fillna(0).astype(int) == 0].iterrows():
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:1788: FutureWarning: Downcasting object dtype arrays on .fillna, .ffill, .bfill is deprecated and will change in a future version. Call result.infer_objects(copy=False) instead. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  df['PresentToday'] = df['CountSwipes'].fillna(0).astype(int) > 0
2025-11-25 12:26:49,178 INFO run_trend_for_date: wrote outputs\trend_pune_20250923.csv (rows=739)
2025-11-25 12:26:49,202 INFO build_monthly_training: running for 2025-09-24 (city=Pune)
2025-11-25 12:26:49,202 INFO Fetching swipes for region apac on 2025-09-24
2025-11-25 12:26:49,262 INFO Databases present for server SRVWUPNQ0986V: ['ACVSUJournal_00010030', 'ACVSUJournal_00010029', 'ACVSUJournal_00010028', 'ACVSUJournal_00010027', 'ACVSUJournal_00010026', 'ACVSUJournal_00010025']       
2025-11-25 12:26:49,262 INFO Built SQL for region apac, date 2025-09-24
2025-11-25 12:27:00,653 INFO APAC PartitionName2 mapping counts example: {'Pune': 23067, 'Quezon City': 7440, 'IN.HYD': 61, 'Taguig City': 30}
2025-11-25 12:27:01,372 INFO City filter 'Pune' applied for region apac: rows before=30598 after=23067
C:\Users\W0024618\Desktop\Trend Analysis\backend\duration_report.py:918: FutureWarning: 'S' is deprecated and will be removed in a future version, please use 's' instead.
  df["_lts_rounded"] = df["LocaleMessageTime"].dt.floor("S")
2025-11-25 12:27:02,850 INFO Wrote duration CSV for apac to outputs\apac_duration_20250924.csv (rows=878)
2025-11-25 12:27:02,850 INFO Wrote swipes CSV for apac to outputs\apac_swipes_20250924.csv (rows=23067)
2025-11-25 12:27:02,850 INFO Fetching swipes for region emea on 2025-09-24
2025-11-25 12:27:03,972 INFO Databases present for server SRVWUFRA0986V: ['ACVSUJournal_00011029', 'ACVSUJournal_00011028', 'ACVSUJournal_00011027', 'ACVSUJournal_00011026', 'ACVSUJournal_00011025', 'ACVSUJournal_00011024', 'ACVSUJournal_00011023']
2025-11-25 12:27:03,973 INFO Built SQL for region emea, date 2025-09-24
2025-11-25 12:27:10,972 INFO City filter 'Pune' applied for region emea: rows before=8345 after=0
2025-11-25 12:27:11,014 INFO Wrote duration CSV for emea to outputs\emea_duration_20250924.csv (rows=0)
2025-11-25 12:27:11,015 INFO Wrote swipes CSV for emea to outputs\emea_swipes_20250924.csv (rows=0)
2025-11-25 12:27:11,015 INFO Fetching swipes for region laca on 2025-09-24
2025-11-25 12:27:13,571 INFO Databases present for server SRVWUSJO0986V: ['ACVSUJournal_00010030', 'ACVSUJournal_00010029', 'ACVSUJournal_00010028', 'ACVSUJournal_00010027', 'ACVSUJournal_00010026', 'ACVSUJournal_00010025']       
2025-11-25 12:27:13,620 INFO Built SQL for region laca, date 2025-09-24
2025-11-25 12:27:36,085 INFO City filter 'Pune' applied for region laca: rows before=15263 after=0
2025-11-25 12:27:36,107 INFO Wrote duration CSV for laca to outputs\laca_duration_20250924.csv (rows=0)
2025-11-25 12:27:36,108 INFO Wrote swipes CSV for laca to outputs\laca_swipes_20250924.csv (rows=0)
2025-11-25 12:27:36,109 INFO Fetching swipes for region namer on 2025-09-24
2025-11-25 12:27:38,099 INFO Databases present for server SRVWUDEN0891V: ['ACVSUJournal_00010030', 'ACVSUJournal_00010029', 'ACVSUJournal_00010028', 'ACVSUJournal_00010027', 'ACVSUJournal_00010026', 'ACVSUJournal_00010025']       
2025-11-25 12:27:38,100 INFO Built SQL for region namer, date 2025-09-24
2025-11-25 12:28:02,625 INFO City filter 'Pune' applied for region namer: rows before=5405 after=0
2025-11-25 12:28:02,634 INFO Wrote duration CSV for namer to outputs\namer_duration_20250924.csv (rows=0)
2025-11-25 12:28:02,635 INFO Wrote swipes CSV for namer to outputs\namer_swipes_20250924.csv (rows=0)
C:\Users\W0024618\Desktop\Trend Analysis\backend\duration_report.py:918: FutureWarning: 'S' is deprecated and will be removed in a future version, please use 's' instead.
  df["_lts_rounded"] = df["LocaleMessageTime"].dt.floor("S")
2025-11-25 12:28:03,550 INFO PersonnelTypeName values example: ['Employee']
2025-11-25 12:28:03,619 INFO PersonnelTypeName filter applied: before=23067 after=23067
2025-11-25 12:28:21,732 INFO Saved raw swipes to outputs\swipes_pune_20250924.csv
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:2192: FutureWarning: DataFrameGroupBy.apply operated on the grouping columns. This behavior is deprecated, and in a future version of pandas the grouping columns will be excluded from the operation. Either pass `include_groups=False` to exclude the groupings or explicitly select the grouping columns after groupby to silence this warning.
  raw_metrics_df = grouped_raw.apply(_agg_metrics).reset_index()
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:2267: FutureWarning: The behavior of array concatenation with empty entries is deprecated. In a future version, this will no longer exclude empty items when determining the result dtype. To retain the old behavior, exclude the empty entries before the concat operation.
  merged_metrics[base_col] = merged_metrics[raw_col].combine_first(merged_metrics.get(base_col))
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:2267: FutureWarning: The behavior of array concatenation with empty entries is deprecated. In a future version, this will no longer exclude empty items when determining the result dtype. To retain the old behavior, exclude the empty entries before the concat operation.
  merged_metrics[base_col] = merged_metrics[raw_col].combine_first(merged_metrics.get(base_col))
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:1722: FutureWarning: Downcasting object dtype arrays on .fillna, .ffill, .bfill is deprecated and will change in a future version. Call result.infer_objects(copy=False) instead. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  for ix, r in df[df['CountSwipes'].fillna(0).astype(int) == 0].iterrows():
C:\Users\W0024618\Desktop\Trend Analysis\backend\trend_runner.py:1788: FutureWarning: Downcasting object dtype arrays on .fillna, .ffill, .bfill is deprecated and will change in a future version. Call result.infer_objects(copy=False) instead. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  df['PresentToday'] = df['CountSwipes'].fillna(0).astype(int) > 0
2025-11-25 12:28:38,763 INFO run_trend_for_date: wrote outputs\trend_pune_20250924.csv (rows=878)
2025-11-25 12:28:38,800 INFO build_monthly_training: running for 2025-09-25 (city=Pune)
2025-11-25 12:28:38,801 INFO Fetching swipes for region apac on 2025-09-25
2025-11-25 12:28:38,945 INFO Databases present for server SRVWUPNQ0986V: ['ACVSUJournal_00010030', 'ACVSUJournal_00010029', 'ACVSUJournal_00010028', 'ACVSUJournal_00010027', 'ACVSUJournal_00010026', 'ACVSUJournal_00010025']       
2025-11-25 12:28:38,945 INFO Built SQL for region apac, date 2025-09-25
2025-11-25 12:28:55,174 INFO APAC PartitionName2 mapping counts example: {'Pune': 10856, 'Quezon City': 6133, 'IN.HYD': 175, 'Taguig City': 21}
2025-11-25 12:28:55,487 INFO City filter 'Pune' applied for region apac: rows before=17185 after=10856
C:\Users\W0024618\Desktop\Trend Analysis\backend\duration_report.py:918: FutureWarning: 'S' is deprecated and will be removed in a future version, please use 's' instead.
  df["_lts_rounded"] = df["LocaleMessageTime"].dt.floor("S")
2025-11-25 12:28:56,013 INFO Wrote duration CSV for apac to outputs\apac_duration_20250925.csv (rows=478)
2025-11-25 12:28:56,013 INFO Wrote swipes CSV for apac to outputs\apac_swipes_20250925.csv (rows=10856)
2025-11-25 12:28:56,014 INFO Fetching swipes for region emea on 2025-09-25
2025-11-25 12:28:57,579 INFO Databases present for server SRVWUFRA0986V: ['ACVSUJournal_00011029', 'ACVSUJournal_00011028', 'ACVSUJournal_00011027', 'ACVSUJournal_00011026', 'ACVSUJournal_00011025', 'ACVSUJournal_00011024', 'ACVSUJournal_00011023']
2025-11-25 12:28:57,579 INFO Built SQL for region emea, date 2025-09-25

(.venv) PS C:\Users\W0024618\Desktop\Trend Analysis\backend> 








#C:\Users\W0024618\Desktop\Trend Analysis\backend\scripts\generate_90_days.py
#!/usr/bin/env python3
"""
Generate trend CSVs for a sliding window of days by calling trend_runner.run_trend_for_date.

New features:
 - --all-cities: discover cities from duration CSVs (since --start) and generate trend CSVs for each city into outdir/<city_slug>/.
 - Keeps retry logic and permissive fallback to positional call if run_trend_for_date doesn't accept kwargs.

Usage:
  # single city (old behavior)
  python generate_90_days.py --end 2025-11-09 --window 90 --city Pune --outdir ./outputs

  # generate for all cities discovered in ./outputs since 2025-10-01
  python generate_90_days.py --end 2025-11-09 --window 90 --all-cities --outdir ./outputs --start 2025-10-01
"""
from datetime import date, timedelta, datetime
from pathlib import Path
import sys
import os
import argparse
import logging
import time
import pandas as pd
import re

logging.basicConfig(level=logging.INFO, format='%(asctime)s %(levelname)s %(message)s')

# Make the backend project root importable when running the script directly.
HERE = Path(__file__).resolve()
PROJECT_ROOT = HERE.parents[1]
if str(PROJECT_ROOT) not in sys.path:
    sys.path.insert(0, str(PROJECT_ROOT))

os.chdir(str(PROJECT_ROOT))

try:
    from trend_runner import run_trend_for_date, OUTDIR as TREND_OUTDIR
except Exception:
    run_trend_for_date = None
    TREND_OUTDIR = None

def _slug(s: str) -> str:
    return re.sub(r'[^a-z0-9]+', '_', str(s or "").strip().lower()).strip('_') or "unknown"

def find_cities_from_duration_files(outdir: Path, start_date: date) -> list:
    pattern = re.compile(r'.*_duration_(\d{8})\.csv$', flags=re.IGNORECASE)
    cities = set()
    if not outdir.exists():
        return []
    for p in outdir.glob("*_duration_*.csv"):
        m = pattern.match(p.name)
        if not m:
            continue
        try:
            dt = datetime.strptime(m.group(1), "%Y%m%d").date()
        except Exception:
            continue
        if dt < start_date:
            continue
        try:
            # attempt to read PartitionName2 column first
            df = pd.read_csv(p, usecols=[c for c in ['PartitionName2'] if c in pd.read_csv(p, nrows=0).columns], dtype=str, low_memory=True)
            if 'PartitionName2' in df.columns:
                for v in df['PartitionName2'].dropna().unique():
                    vs = str(v).strip()
                    if vs:
                        cities.add(vs)
        except Exception:
            try:
                df = pd.read_csv(p, dtype=str, low_memory=True)
                if 'PartitionName2' in df.columns:
                    for v in df['PartitionName2'].dropna().unique():
                        vs = str(v).strip()
                        if vs:
                            cities.add(vs)
            except Exception:
                logging.debug("Failed reading %s for city discovery", p)
                continue
    return sorted(cities)

def process_dates(start_date: date, end_date: date, outdir: Path, city: str, max_retries: int = 1, pause_seconds: float = 1.0):
    d = start_date
    while d <= end_date:
        attempt = 0
        success = False
        while attempt <= max_retries and not success:
            try:
                logging.info("Processing %s (city=%s) attempt %s", d.isoformat(), city, attempt + 1)
                if run_trend_for_date is None:
                    raise RuntimeError("trend_runner.run_trend_for_date not importable. Ensure trend_runner is on PYTHONPATH.")
                run_trend_for_date(d, outdir=str(outdir), city=city)
                success = True
            except TypeError as te:
                # try positional fallback
                logging.warning("run_trend_for_date signature mismatch (%s). Trying positional call.", te)
                try:
                    run_trend_for_date(d)
                    success = True
                except Exception as e2:
                    logging.exception("Positional run_trend_for_date call also failed: %s", e2)
            except Exception as e:
                logging.exception("Failed for %s (city=%s): %s", d.isoformat(), city, e)
            attempt += 1
            if not success and attempt <= max_retries:
                time.sleep(pause_seconds)
        if not success:
            logging.error("Giving up for %s after %s attempts (city=%s)", d.isoformat(), max_retries + 1, city)
        d = d + timedelta(days=1)

def main(end_date=None, window_days=90, outdir="./outputs", city="Pune", start_date_override=None, all_cities=False):
    if end_date:
        end_dt = date.fromisoformat(end_date)
    else:
        end_dt = date.today()

    if start_date_override:
        start_dt = date.fromisoformat(start_date_override)
    else:
        start_dt = end_dt - timedelta(days=window_days - 1)

    out_path = Path(outdir)
    if TREND_OUTDIR and outdir in ("./outputs", None, ""):
        try:
            out_path = Path(TREND_OUTDIR)
        except Exception:
            pass

    out_path.mkdir(parents=True, exist_ok=True)

    if all_cities:
        # discover cities using duration files since provided start (default Oct 1)
        discovery_start = date.fromisoformat("2025-10-01")
        logging.info("Discovering cities in %s (duration files since %s)", out_path, discovery_start.isoformat())
        cities = find_cities_from_duration_files(out_path, discovery_start)
        if not cities:
            logging.warning("No cities discovered. Exiting.")
            return
        logging.info("Discovered %d cities: %s", len(cities), ", ".join(cities[:10]))
        for c in cities:
            slug = _slug(c)
            city_outdir = out_path / slug
            logging.info("Generating for city %s -> outputs in %s", c, city_outdir)
            process_dates(start_dt, end_dt, city_outdir, c, max_retries=1, pause_seconds=1.0)
    else:
        out_path.mkdir(parents=True, exist_ok=True)
        process_dates(start_dt, end_dt, out_path, city, max_retries=1, pause_seconds=1.0)


# --- Extended main + CLI: add regions, primary-city and hybrid-store support ---
try:
    # optional import for region config discovery (duration_report used in backend)
    from duration_report import REGION_CONFIG as _REGION_CONFIG
except Exception:
    _REGION_CONFIG = None

def _maybe_filter_cities_by_region(cities_list, regions_input):
    """
    If regions_input provided (list of region names), try to filter the discovered city list.
    If REGION_CONFIG is available and maps sites -> region, prefer that mapping.
    Otherwise, do a best-effort substring match on the city string.
    """
    if not regions_input:
        return cities_list
    regions_normalized = [r.strip().lower() for r in regions_input if r and str(r).strip()]
    if not regions_normalized:
        return cities_list

    if _REGION_CONFIG:
        # REGION_CONFIG likely maps region_name -> config; try to build reverse map for site names
        try:
            site_to_region = {}
            for rname, cfg in _REGION_CONFIG.items():
                # cfg may include a 'sites' or 'cities' list - be permissive
                sites = cfg.get('sites') if isinstance(cfg, dict) and cfg.get('sites') else cfg.get('cities') if isinstance(cfg, dict) and cfg.get('cities') else None
                if sites:
                    for s in sites:
                        if s:
                            site_to_region[str(s).strip().lower()] = str(rname).strip().lower()
        except Exception:
            site_to_region = {}

        filtered = []
        for c in cities_list:
            slug = re.sub(r'[^a-z0-9]+', '_', str(c).strip().lower())
            if site_to_region:
                # direct exact match if exists
                if slug in site_to_region and site_to_region[slug] in regions_normalized:
                    filtered.append(c)
                    continue
            # fallback substring match
            for r in regions_normalized:
                if r in slug:
                    filtered.append(c)
                    break
        return sorted(set(filtered), key=lambda x: str(x).lower())

    # fallback: substring match against requested region tokens
    out = []
    for c in cities_list:
        cl = str(c).strip().lower()
        for r in regions_normalized:
            if r in cl:
                out.append(c)
                break
    return sorted(set(out), key=lambda x: str(x).lower()) if out else cities_list


def main(end_date=None, window_days=90, outdir="./outputs", city="Pune", start_date_override=None, all_cities=False, regions=None, primary_city="Pune", hybrid_store=False):
    if end_date:
        end_dt = date.fromisoformat(end_date)
    else:
        end_dt = date.today()

    if start_date_override:
        start_dt = date.fromisoformat(start_date_override)
    else:
        start_dt = end_dt - timedelta(days=window_days - 1)

    out_path = Path(outdir)
    if TREND_OUTDIR and outdir in ("./outputs", None, ""):
        try:
            out_path = Path(TREND_OUTDIR)
        except Exception:
            pass

    out_path.mkdir(parents=True, exist_ok=True)

    # helper wrapper which lets us pass regions and hybrid_store through to run_trend_for_date where supported
    def _run_for_city(city_name):
        logging.info("Start generating trends for city=%s dates=%s..%s", city_name, start_dt.isoformat(), end_dt.isoformat())
        # create city specific outdir
        city_slug = _slug(city_name)
        city_outdir = out_path if not hybrid_store else (out_path / city_slug)
        city_outdir.mkdir(parents=True, exist_ok=True)
        process_dates(start_dt, end_dt, city_outdir, city_name, max_retries=1, pause_seconds=1.0)

    if all_cities:
        # discover cities
        discovery_start = start_dt
        logging.info("Discovering cities in %s (duration files since %s)", out_path, discovery_start.isoformat())
        cities = find_cities_from_duration_files(out_path, discovery_start)
        if not cities:
            logging.warning("No cities discovered. Exiting.")
            return

        # filter by regions param if provided
        if regions:
            cities = _maybe_filter_cities_by_region(cities, regions)

        # ensure primary city runs first (if present)
        primary = primary_city or city
        ordered = []
        primary_lower = str(primary).strip().lower()
        for c in cities:
            if str(c).strip().lower() == primary_lower:
                ordered.append(c)
        for c in cities:
            if str(c).strip().lower() != primary_lower:
                ordered.append(c)

        logging.info("Will generate for %d cities, primary first: %s", len(ordered), ", ".join(ordered[:6]))
        for c in ordered:
            try:
                _run_for_city(c)
            except Exception:
                logging.exception("Failed generating for city %s", c)
    else:
        # single city run (city param)
        _run_for_city(city)


if __name__ == "__main__":
    parser = argparse.ArgumentParser()
    parser.add_argument("--end", help="end date (YYYY-MM-DD). default = today", default=None)
    parser.add_argument("--start", help="start date (YYYY-MM-DD). optional, overrides window", default=None)
    parser.add_argument("--outdir", help="outputs dir", default="./outputs")
    parser.add_argument("--window", type=int, default=90, help="window days (default 90)")
    parser.add_argument("--city", default="Pune")
    parser.add_argument("--primary-city", default="Pune", help="Primary city to run first when --all-cities used")
    parser.add_argument("--all-cities", action="store_true", help="discover cities from duration files and generate for each")
    parser.add_argument("--regions", default=None, help="Optional comma-separated regions to filter when using --all-cities")
    parser.add_argument("--hybrid-store", action="store_true", help="When set, write outputs into per-city subfolders instead of only root outdir")
    args = parser.parse_args()

    region_list = [r.strip() for r in args.regions.split(",")] if args.regions else None
    main(end_date=args.end, window_days=args.window, outdir=args.outdir, city=args.city, start_date_override=args.start, all_cities=args.all_cities, regions=region_list, primary_city=args.primary_city, hybrid_store=args.hybrid_store)





check above file and fix this issue carefully
