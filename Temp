Read Beloow HeadCount Query carefully check all (APAC + EMEA + LACA + NAMER ) all query carefully and build Time Dusration report 
so Basically we are 
initially calculate Duration report using First swipe and last swipe for day ..
then will improve Logic for those Who are work in Shift.
check below db connection details and
create new .py file for Duration 
in attendance analytics folder and start building duration repot caredfully...
create file here ..
C:\Users\W0024618\Desktop\global-page\backend\attendance-analytics
create new python file below for duration .


 apac: 
    user: 'GSOC_Test',
    password: 'Westernccure@2025',
    server: 'SRVWUPNQ0986V',
    database: 'ACVSUJournal_00010029',
 
  emea: 
    user: 'GSOC_Test',
    password: 'Westernccure@2025',
    server: 'SRVWUFRA0986V',
    database: 'ACVSUJournal_00011028,


  laca: 
    user: 'GSOC_Test',
    password: 'Westernccure@2025',
    server: 'SRVWUSJO0986V',
    database: 'ACVSUJournal_00010029',

 
  namer: 
    user: 'GSOC_Test',
    password: 'Westernccure@2025',
    server: 'SRVWUDEN0891V',
    database: 'ACVSUJournal_00010029',







1)APAC HeadCouint Query


/*SELECT 
    t1.[ObjectName1],
    t1.[ObjectName2],
   CASE
        WHEN t2.[Int1] = 0 THEN t2.[Text12]
        ELSE CAST(t2.[Int1] AS NVARCHAR)
    END AS EmployeeID,
    t2.[PersonnelTypeID],
    t3.[Name],  -- Adding the PersonnelType from the third table
	Case
		WHEN t1.ObjectName2 LIKE 'APAC_PI%' THEN 'Taguig City'
		WHEN t1.ObjectName2 LIKE 'APAC_PH%' THEN 'Quezon City'
		WHEN t1.ObjectName2 LIKE '%PUN%' THEN 'Pune'
		ELSE t1.PartitionName2
	END AS Location,
	t1.PartitionName2,
    DATEADD(MINUTE, -1 * t1.[MessageLocaleOffset], t1.[MessageUTC]) AS LocaleMessageTime,
	t1.MessageType
INTO 
    #CombinedEmployeeData  -- Temporary table
FROM 
    [ACVSUJournal_00010020].[dbo].[ACVSUJournalLog] AS t1  -- Replace with your actual table name
INNER JOIN 
    [ACVSCore].[Access].[Personnel] AS t2  -- Replace with the actual table name
ON 
    t1.ObjectIdentity1 = t2.GUID
INNER JOIN 
    [ACVSCore].[Access].[PersonnelType] AS t3  -- Replace with the actual table name containing PersonnelType
ON 
    t2.[PersonnelTypeId] = t3.[ObjectID];
	SELECT DISTINCT
    [ObjectName1],
    [Name],
	EmployeeID,
	Location,
	Messagetype,
    CONVERT(DATE, LocaleMessageTime) AS Date
	FROM 
    #CombinedEmployeeData  -- Use the temporary table with combined data
	WHERE 
    CONVERT (DATE, LocaleMessageTime) = '2025-05-5' 
	AND PartitionName2 IN ('APAC.Default', 'CN.Beijing', 'JP.Tokyo', 'PH.Manila', 'MY.Kuala Lumpur') 
	AND MessageType = 'CardAdmitted';
	*/
	


	WITH CombinedEmployeeData AS (
    SELECT
        t1.[ObjectName1],
        t1.[ObjectName2],
        CASE
            WHEN t2.[Int1] = 0 THEN t2.[Text12]
            ELSE CAST(t2.[Int1] AS NVARCHAR)
        END AS EmployeeID,
        t2.[PersonnelTypeID],
        t3.[Name] AS PersonnelTypeName,
		t1.Objectidentity1 AS EmployeeIdentity,
        CASE
            WHEN t1.ObjectName2 LIKE 'APAC_PI%' THEN 'Taguig City'
            WHEN t1.ObjectName2 LIKE 'APAC_PH%' THEN 'Quezon City'
            WHEN t1.ObjectName2 LIKE '%PUN%' THEN 'Pune'
            ELSE t1.PartitionName2
        END AS Location,
        t1.PartitionName2,
        DATEADD(MINUTE, -1 * t1.[MessageLocaleOffset], t1.[MessageUTC]) AS LocaleMessageTime,
        t1.MessageType
    FROM
        [ACVSUJournal_00010028].[dbo].[ACVSUJournalLog] AS t1
        INNER JOIN [ACVSCore].[Access].[Personnel] AS t2 ON t1.ObjectIdentity1 = t2.GUID
        INNER JOIN [ACVSCore].[Access].[PersonnelType] AS t3 ON t2.PersonnelTypeID = t3.ObjectID
    WHERE
        t1.MessageType = 'CardAdmitted'
        AND t1.PartitionName2 IN ('APAC.Default', 'CN.Beijing', 'JP.Tokyo', 'PH.Manila', 'MY.Kuala Lumpur')
        AND CONVERT(DATE, DATEADD(MINUTE, -1 * t1.[MessageLocaleOffset], t1.[MessageUTC])) = '2025-06-26'
),
RankedEmployeeData AS (
    SELECT *,
        ROW_NUMBER() OVER (PARTITION BY EmployeeIdentity, CONVERT(DATE, LocaleMessageTime) ORDER BY LocaleMessageTime DESC) AS rn
    FROM
        CombinedEmployeeData
)
SELECT
    [ObjectName1],
    PersonnelTypeName,
    EmployeeID,
    Location,
    MessageType,
    CONVERT(DATE, LocaleMessageTime) AS Date
FROM
    RankedEmployeeData
WHERE
    rn = 1;

	--DROP Table #CombinedEmployeeData;



2)NAMER HeadCount Query


-- Step 1: Build the temp table with corrected logical location using door name (ObjectName2)
SELECT
    t1.[ObjectName1],
    t1.[ObjectName2],
    CASE
        WHEN t2.[Int1] = 0 THEN t2.[Text12]
        ELSE CAST(t2.[Int1] AS NVARCHAR)
    END AS EmployeeID,
    t2.[PersonnelTypeID],
    t3.[Name], -- Personnel type
    t2.[Text5],
    t1.[PartitionName2],
 
    -- Assign accurate LogicalLocation using door name (ObjectName2)
    CASE
        WHEN t1.[ObjectName2] LIKE '%HQ%' THEN 'Denver'
        WHEN t1.[ObjectName2] LIKE '%Austin%' THEN 'Austin'
        WHEN t1.[ObjectName2] LIKE '%Miami%' THEN 'Miami'
        WHEN t1.[ObjectName2] LIKE '%NYC%' THEN 'New York'
        ELSE 'Other'
    END AS LogicalLocation,
 
    t1.[MessageType],
    DATEADD(MINUTE, -1 * t1.[MessageLocaleOffset], t1.[MessageUTC]) AS LocaleMessageTime
 
INTO #CombinedEmployeeData
FROM [ACVSUJournal_00010028].[dbo].[ACVSUJournalLog] AS t1
INNER JOIN [ACVSCore].[Access].[Personnel] AS t2
    ON t1.ObjectIdentity1 = t2.GUID
INNER JOIN [ACVSCore].[Access].[PersonnelType] AS t3
    ON t2.[PersonnelTypeID] = t3.[ObjectID];
 
-- Step 2: Select cleaned data for specific logical locations
SELECT DISTINCT
    [ObjectName1],
    [Name],
    EmployeeID,
    Text5,
    LogicalLocation,
    MessageType,
    CONVERT(DATE, LocaleMessageTime) AS [Date]
FROM #CombinedEmployeeData
WHERE
    CONVERT(DATE, LocaleMessageTime) = '2025-07-21'
    AND LogicalLocation IN ('Denver', 'Austin', 'Miami', 'New York')
    AND MessageType = 'CardAdmitted';

DROP TABLE #CombinedEmployeeData;







3) EMEA Headcount Query 

SELECT 
    t1.[ObjectName1],
    t1.[ObjectName2],
   CASE
        WHEN t2.[Int1] = 0 THEN t2.[Text12]
        ELSE CAST(t2.[Int1] AS NVARCHAR)
    END AS EmployeeID,
    t2.[PersonnelTypeID],
    t3.[Name],  -- Adding the PersonnelType from the third table
	t2.text5,
	t1.PartitionName2,
    DATEADD(MINUTE, -1 * t1.[MessageLocaleOffset], t1.[MessageUTC]) AS LocaleMessageTime,
	t1.MessageType
INTO 
    #CombinedEmployeeData  -- Temporary table
FROM 
    [ACVSUJournal_00011027].[dbo].[ACVSUJournalLog] AS t1  -- Replace with your actual table name
INNER JOIN 
    [ACVSCore].[Access].[Personnel] AS t2  -- Replace with the actual table name
ON 
    t1.ObjectIdentity1 = t2.GUID
INNER JOIN 
    [ACVSCore].[Access].[PersonnelType] AS t3  -- Replace with the actual table name containing PersonnelType
ON 
    t2.[PersonnelTypeId] = t3.[ObjectID];
	SELECT DISTINCT
    [ObjectName1],
    [Name],
	EmployeeID,
	text5,
	PartitionName2,
	Messagetype,
    CONVERT(DATE, LocaleMessageTime) AS Date
	FROM 
    #CombinedEmployeeData  -- Use the temporary table with combined data
	WHERE 
    CONVERT (DATE, LocaleMessageTime) = '2025-06-26' 
	AND PartitionName2 IN ('LT.Vilnius', 'AUT.Vienna', 'IE.DUblin', 'DU.Abu Dhab', 'ES.Madrid', 'IT.Rome', 'MA.Casablanca', 'RU.Moscow',
	'UK.London') 
	AND MessageType = 'CardAdmitted';

	DROP Table #CombinedEmployeeData;





4) Laca  Headcount Query
SELECT 
    t1.[ObjectName1],
    t1.[ObjectName2],
   CASE
        WHEN t2.[Int1] = 0 THEN t2.[Text12]
        ELSE CAST(t2.[Int1] AS NVARCHAR)
    END AS EmployeeID,
    t2.[PersonnelTypeID],
    t3.[Name],  -- Adding the PersonnelType from the third table
	t2.text5,
	t1.PartitionName2,
    DATEADD(MINUTE, -1 * t1.[MessageLocaleOffset], t1.[MessageUTC]) AS LocaleMessageTime,
	t1.MessageType
INTO 
    #CombinedEmployeeData  -- Temporary table
FROM 
    [ACVSUJournal_00010028].[dbo].[ACVSUJournalLog] AS t1  -- Replace with your actual table name
INNER JOIN 
    [ACVSCore].[Access].[Personnel] AS t2  -- Replace with the actual table name
ON 
    t1.ObjectIdentity1 = t2.GUID
INNER JOIN 
    [ACVSCore].[Access].[PersonnelType] AS t3  -- Replace with the actual table name containing PersonnelType
ON 
    t2.[PersonnelTypeId] = t3.[ObjectID];
	SELECT DISTINCT
    [ObjectName1],
    [Name],
	EmployeeID,
	text5,
	PartitionName2,
	Messagetype,
    CONVERT(DATE, LocaleMessageTime) AS Date
	FROM 
    #CombinedEmployeeData  -- Use the temporary table with combined data
	WHERE 
    CONVERT (DATE, LocaleMessageTime) = '2025-07-12' 
	AND PartitionName2 IN ('AR.Cordoba', 'BR.Sao Paulo', 'CR.Costa Rica Partition', 'MX.Mexico City', 'PA.Panama City', 'PE.Lima') 
	AND MessageType = 'CardAdmitted';

	DROP Table #CombinedEmployeeData;
