start_backend.ps1




[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12

$env:HTTPS_PROXY = "http://proxy.wuintranet.net:8080"
$env:HTTP_PROXY  = $env:HTTPS_PROXY
$env:NO_PROXY = "localhost,127.0.0.1,10.199.22.0/24,10.199.22.57"

$env:CLIENT_ID = "6222d611-678e-4d57-a98b-83faa86fce76"
$env:CLIENT_SECRET = "DKV8Q~Rn4MvlucbxcMsXvAZ6ub_rBVbo-sb6.bGX"
$env:TENANT_ID = "ce3a67f2-5a22-4fb8-a511-815f8924cda6"
$env:PRIMARY_EMAIL = "gsoc-globalsecurityoperationcenter.sharedmailbox@westernunion.com"

python .\app.py





.\start_backend.ps1












Now check below details carefully and give me next step 


PS D:\Email Automation\backend-arun> # Proxy (system-wide)
>> setx HTTPS_PROXY "http://proxy.wuintranet.net:8080" /M
>> setx HTTP_PROXY  "http://proxy.wuintranet.net:8080" /M
>> setx NO_PROXY "localhost,127.0.0.1,10.199.22.0/24,10.199.22.57" /M
>>
>> # Graph / App credentials (if acceptable in your environment)
>> setx CLIENT_ID "6222d611-678e-4d57-a98b-83faa86fce76" /M
>> setx CLIENT_SECRET "DKV8Q~Rn4MvlucbxcMsXvAZ6ub_rBVbo-sb6.bGX" /M
>> setx TENANT_ID "ce3a67f2-5a22-4fb8-a511-815f8924cda6" /M
>> setx PRIMARY_EMAIL "gsoc-globalsecurityoperationcenter.sharedmailbox@westernunion.com" /M
>>
ERROR: Access to the registry path is denied.
ERROR: Access to the registry path is denied.
ERROR: Access to the registry path is denied.
ERROR: Access to the registry path is denied.
ERROR: Access to the registry path is denied.
ERROR: Access to the registry path is denied.
ERROR: Access to the registry path is denied.
PS D:\Email Automation\backend-arun> # start_backend.ps1
>> [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
>>
>> $env:HTTPS_PROXY = "http://proxy.wuintranet.net:8080"
>> $env:HTTP_PROXY  = $env:HTTPS_PROXY
>> $env:NO_PROXY = "localhost,127.0.0.1,10.199.22.0/24,10.199.22.57"
>>
>> # If you prefer reading from .env, ensure python code calls load_dotenv()
>> # But set important envs explicitly here:
>> $env:CLIENT_ID = "6222d611-678e-4d57-a98b-83faa86fce76"
>> $env:CLIENT_SECRET = "DKV8Q~Rn4MvlucbxcMsXvAZ6ub_rBVbo-sb6.bGX"
>> $env:TENANT_ID = "ce3a67f2-5a22-4fb8-a511-815f8924cda6"
>> $env:PRIMARY_EMAIL = "gsoc-globalsecurityoperationcenter.sharedmailbox@westernunion.com"
>>
>> # Start the backend (run in foreground so logs stream)
>> python .\app.py
>>
DEBUG:filelock:Attempting to acquire lock 2307245163584 on D:\Email Automation\backend-arun\templates.json.lock
DEBUG:filelock:Lock 2307245163584 acquired on D:\Email Automation\backend-arun\templates.json.lock
DEBUG:config:Loaded templates from templates.json
DEBUG:filelock:Attempting to release lock 2307245163584 on D:\Email Automation\backend-arun\templates.json.lock
DEBUG:filelock:Lock 2307245163584 released on D:\Email Automation\backend-arun\templates.json.lock
INFO:log_handler:Ensured email_logs table exists.
INFO:log_handler:Ensured employee_images table exists.
INFO:log_handler:Database writer thread started.
DEBUG:tzlocal:Looking up time zone info from registry
INFO:apscheduler.scheduler:Adding job tentatively -- it will be properly scheduled when the scheduler starts
 * Serving Flask app 'app'
 * Debug mode: on
DEBUG:filelock:Attempting to acquire lock 2739821406608 on D:\Email Automation\backend-arun\templates.json.lock
DEBUG:filelock:Lock 2739821406608 acquired on D:\Email Automation\backend-arun\templates.json.lock
DEBUG:config:Loaded templates from templates.json
DEBUG:filelock:Attempting to release lock 2739821406608 on D:\Email Automation\backend-arun\templates.json.lock
DEBUG:filelock:Lock 2739821406608 released on D:\Email Automation\backend-arun\templates.json.lock
INFO:log_handler:Ensured email_logs table exists.
INFO:log_handler:Ensured employee_images table exists.
INFO:log_handler:Database writer thread started.
DEBUG:tzlocal:Looking up time zone info from registry
INFO:apscheduler.scheduler:Adding job tentatively -- it will be properly scheduled when the scheduler starts
INFO:__main__:Starting scheduler in the main worker process ONLY.
INFO:apscheduler.scheduler:Added job "check_all_regions" to job store "default"
INFO:apscheduler.scheduler:Scheduler started
DEBUG:apscheduler.scheduler:Looking for jobs to run
DEBUG:apscheduler.scheduler:Next wakeup is due at 2025-12-12 11:44:00.134515+05:30 (in 59.987998 seconds)
DEBUG:__main__:Fetching count of sent emails
DEBUG:__main__:Fetching exception list
DEBUG:__main__:Fetching count of sent emails
DEBUG:__main__:Fetching exception list
DEBUG:__main__:Fetching email templates
DEBUG:__main__:Fetching email templates
DEBUG:__main__:Fetching exception list
DEBUG:__main__:Fetching exception list
DEBUG:__main__:Fetching count of sent emails
DEBUG:__main__:Fetching count of acknowledged emails
DEBUG:__main__:Fetching exception list
DEBUG:__main__:Fetching exception list
DEBUG:__main__:Fetching count of acknowledged emails
DEBUG:__main__:Fetching count of sent emails
DEBUG:__main__:Fetching count of sent emails
DEBUG:__main__:Fetching exception list
DEBUG:apscheduler.scheduler:Looking for jobs to run
INFO:apscheduler.executors.default:Running job "check_all_regions (trigger: interval[0:01:00], next run at: 2025-1
2-12 11:44:00 IST)" (scheduled at 2025-12-12 11:44:00.134515+05:30)
DEBUG:apscheduler.scheduler:Next wakeup is due at 2025-12-12 11:45:00.134515+05:30 (in 59.994379 seconds)
INFO:__main__:Master lock acquired. Starting check_all_regions job.
INFO:alerts:Checking alerts for APAC server
DEBUG:alerts:[APAC] Fetching rejection data...
INFO:alerts:[APAC] Fetched 8 rejection records.
DEBUG:alerts:[APAC] Fetching alarm data...
INFO:alerts:[APAC] Fetched 10 alarm records.
INFO:alerts:[APAC] Database connection closed.
INFO:alerts:Location filter is active. Only processing emails for: {('apac', 'pune')}
INFO:alerts:Checking alerts for NAMER server
DEBUG:alerts:[NAMER] Fetching rejection data...
INFO:alerts:[NAMER] Fetched 0 rejection records.
DEBUG:alerts:[NAMER] Fetching alarm data...
INFO:alerts:[NAMER] Fetched 3 alarm records.
INFO:alerts:[NAMER] Database connection closed.
INFO:alerts:Location filter is active. Only processing emails for: {('apac', 'pune')}
INFO:alerts:Checking alerts for EMEA server
DEBUG:alerts:[EMEA] Fetching rejection data...
INFO:alerts:[EMEA] Fetched 5 rejection records.
DEBUG:alerts:[EMEA] Fetching alarm data...
INFO:alerts:[EMEA] Fetched 0 alarm records.
INFO:alerts:[EMEA] Database connection closed.
INFO:alerts:Location filter is active. Only processing emails for: {('apac', 'pune')}
INFO:alerts:Checking alerts for LACA server
DEBUG:alerts:[LACA] Fetching rejection data...
INFO:alerts:[LACA] Fetched 0 rejection records.
DEBUG:alerts:[LACA] Fetching alarm data...
INFO:alerts:[LACA] Fetched 0 alarm records.
DEBUG:__main__:Fetching count of sent emails
DEBUG:__main__:Fetching count of acknowledged emails
DEBUG:__main__:Fetching exception list
DEBUG:__main__:Fetching exception list
DEBUG:__main__:Fetching count of sent emails
INFO:alerts:[LACA] Database connection closed.
INFO:alerts:Location filter is active. Only processing emails for: {('apac', 'pune')}
INFO:__main__:Finished check_all_regions job. Releasing master lock.
INFO:apscheduler.executors.default:Job "check_all_regions (trigger: interval[0:01:00], next run at: 2025-12-12 11:
45:00 IST)" executed successfully
DEBUG:__main__:Fetching count of acknowledged emails
PS D:\Email Automation\backend-arun> # Kill any running Python app (be careful)
>> Get-Process -Name python -ErrorAction SilentlyContinue | Where-Object { $_.Path -like "*app.py*" } | Stop-Proce
ss -Force
>>
>> # Start with wrapper
>> .\start_backend.ps1
>>
.\start_backend.ps1 : The term '.\start_backend.ps1' is not recognized as the name of a cmdlet, function, script 
file, or operable program. Check the spelling of the name, or if a path was included, verify that the path is 
correct and try again.
At line:5 char:1
+ .\start_backend.ps1
+ ~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : ObjectNotFound: (.\start_backend.ps1:String) [], CommandNotFoundException
    + FullyQualifiedErrorId : CommandNotFoundException
 
PS D:\Email Automation\backend-arun> Get-Process -Name python -ErrorAction SilentlyContinue | Where-Object { $_.Pa
th -like "*app.py*" } | Stop-Process -Force
>>
PS D:\Email Automation\backend-arun> python app.py
DEBUG:filelock:Attempting to acquire lock 2163564416176 on D:\Email Automation\backend-arun\templates.json.lock
DEBUG:filelock:Lock 2163564416176 acquired on D:\Email Automation\backend-arun\templates.json.lock
DEBUG:config:Loaded templates from templates.json
DEBUG:filelock:Attempting to release lock 2163564416176 on D:\Email Automation\backend-arun\templates.json.lock
DEBUG:filelock:Lock 2163564416176 released on D:\Email Automation\backend-arun\templates.json.lock
INFO:log_handler:Ensured email_logs table exists.
INFO:log_handler:Ensured employee_images table exists.
INFO:log_handler:Database writer thread started.
DEBUG:tzlocal:Looking up time zone info from registry
INFO:apscheduler.scheduler:Adding job tentatively -- it will be properly scheduled when the scheduler starts
 * Serving Flask app 'app'
 * Debug mode: on
DEBUG:filelock:Attempting to acquire lock 1764938738496 on D:\Email Automation\backend-arun\templates.json.lock
DEBUG:filelock:Lock 1764938738496 acquired on D:\Email Automation\backend-arun\templates.json.lock
DEBUG:config:Loaded templates from templates.json
DEBUG:filelock:Attempting to release lock 1764938738496 on D:\Email Automation\backend-arun\templates.json.lock
DEBUG:filelock:Lock 1764938738496 released on D:\Email Automation\backend-arun\templates.json.lock
INFO:log_handler:Ensured email_logs table exists.
INFO:log_handler:Ensured employee_images table exists.
INFO:log_handler:Database writer thread started.
DEBUG:tzlocal:Looking up time zone info from registry
INFO:apscheduler.scheduler:Adding job tentatively -- it will be properly scheduled when the scheduler starts
INFO:__main__:Starting scheduler in the main worker process ONLY.
INFO:apscheduler.scheduler:Added job "check_all_regions" to job store "default"
INFO:apscheduler.scheduler:Scheduler started
DEBUG:apscheduler.scheduler:Looking for jobs to run
DEBUG:apscheduler.scheduler:Next wakeup is due at 2025-12-12 11:47:12.315796+05:30 (in 59.991999 seconds)
DEBUG:__main__:Fetching count of sent emails
DEBUG:__main__:Fetching count of acknowledged emails
DEBUG:__main__:Fetching exception list
DEBUG:__main__:Fetching count of acknowledged emails
DEBUG:__main__:Fetching exception list
DEBUG:__main__:Fetching count of sent emails
DEBUG:__main__:Fetching exception list
DEBUG:__main__:Fetching count of sent emails
DEBUG:apscheduler.scheduler:Looking for jobs to run
INFO:apscheduler.executors.default:Running job "check_all_regions (trigger: interval[0:01:00], next run at: 2025-1
2-12 11:47:12 IST)" (scheduled at 2025-12-12 11:47:12.315796+05:30)
DEBUG:apscheduler.scheduler:Next wakeup is due at 2025-12-12 11:48:12.315796+05:30 (in 59.993057 seconds)
INFO:__main__:Master lock acquired. Starting check_all_regions job.
INFO:alerts:Checking alerts for APAC server
DEBUG:alerts:[APAC] Fetching rejection data...
INFO:alerts:[APAC] Fetched 8 rejection records.
DEBUG:alerts:[APAC] Fetching alarm data...
INFO:alerts:[APAC] Fetched 10 alarm records.
INFO:alerts:[APAC] Database connection closed.
INFO:alerts:Location filter is active. Only processing emails for: {('apac', 'pune')}
INFO:alerts:Checking alerts for NAMER server
DEBUG:alerts:[NAMER] Fetching rejection data...
INFO:alerts:[NAMER] Fetched 0 rejection records.
DEBUG:alerts:[NAMER] Fetching alarm data...
INFO:alerts:[NAMER] Fetched 3 alarm records.
INFO:alerts:[NAMER] Database connection closed.
INFO:alerts:Location filter is active. Only processing emails for: {('apac', 'pune')}
INFO:alerts:Checking alerts for EMEA server
DEBUG:alerts:[EMEA] Fetching rejection data...
INFO:alerts:[EMEA] Fetched 5 rejection records.
DEBUG:alerts:[EMEA] Fetching alarm data...
INFO:alerts:[EMEA] Fetched 0 alarm records.
INFO:alerts:[EMEA] Database connection closed.
INFO:alerts:Location filter is active. Only processing emails for: {('apac', 'pune')}
INFO:alerts:Checking alerts for LACA server
DEBUG:__main__:Fetching count of sent emails
DEBUG:__main__:Fetching exception list
DEBUG:alerts:[LACA] Fetching rejection data...
INFO:alerts:[LACA] Fetched 0 rejection records.
DEBUG:alerts:[LACA] Fetching alarm data...
INFO:alerts:[LACA] Fetched 0 alarm records.
INFO:alerts:[LACA] Database connection closed.
INFO:alerts:Location filter is active. Only processing emails for: {('apac', 'pune')}
INFO:__main__:Finished check_all_regions job. Releasing master lock.
INFO:apscheduler.executors.default:Job "check_all_regions (trigger: interval[0:01:00], next run at: 2025-12-12 11:
48:12 IST)" executed successfully
DEBUG:__main__:Fetching count of sent emails
DEBUG:__main__:Fetching exception list
DEBUG:__main__:Fetching inbox emails
DEBUG:__main__:Fetching emails with top=5, skip=0, folder=inbox
DEBUG:msal.authority:Initializing with Entra authority: https://login.microsoftonline.com/ce3a67f2-5a22-4fb8-a511-
815f8924cda6
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): login.microsoftonline.com:443
DEBUG:urllib3.connectionpool:https://login.microsoftonline.com:443 "GET /ce3a67f2-5a22-4fb8-a511-815f8924cda6/v2.0
/.well-known/openid-configuration HTTP/1.1" 200 1964
DEBUG:msal.authority:openid_config("https://login.microsoftonline.com/ce3a67f2-5a22-4fb8-a511-815f8924cda6/v2.0/.w
ell-known/openid-configuration") = {'token_endpoint': 'https://login.microsoftonline.com/ce3a67f2-5a22-4fb8-a511-8
15f8924cda6/oauth2/v2.0/token', 'token_endpoint_auth_methods_supported': ['client_secret_post', 'private_key_jwt',
 'client_secret_basic', 'self_signed_tls_client_auth'], 'jwks_uri': 'https://login.microsoftonline.com/ce3a67f2-5a
22-4fb8-a511-815f8924cda6/discovery/v2.0/keys', 'response_modes_supported': ['query', 'fragment', 'form_post'], 's
ubject_types_supported': ['pairwise'], 'id_token_signing_alg_values_supported': ['RS256'], 'response_types_support
ed': ['code', 'id_token', 'code id_token', 'id_token token'], 'scopes_supported': ['openid', 'profile', 'email', '
offline_access'], 'issuer': 'https://login.microsoftonline.com/ce3a67f2-5a22-4fb8-a511-815f8924cda6/v2.0', 'reques
t_uri_parameter_supported': False, 'userinfo_endpoint': 'https://graph.microsoft.com/oidc/userinfo', 'authorizatio
n_endpoint': 'https://login.microsoftonline.com/ce3a67f2-5a22-4fb8-a511-815f8924cda6/oauth2/v2.0/authorize', 'devi
ce_authorization_endpoint': 'https://login.microsoftonline.com/ce3a67f2-5a22-4fb8-a511-815f8924cda6/oauth2/v2.0/de
vicecode', 'http_logout_supported': True, 'frontchannel_logout_supported': True, 'end_session_endpoint': 'https://
login.microsoftonline.com/ce3a67f2-5a22-4fb8-a511-815f8924cda6/oauth2/v2.0/logout', 'claims_supported': ['sub', 'i
ss', 'cloud_instance_name', 'cloud_instance_host_name', 'cloud_graph_host_name', 'msgraph_host', 'aud', 'exp', 'ia
t', 'auth_time', 'acr', 'nonce', 'preferred_username', 'name', 'tid', 'ver', 'at_hash', 'c_hash', 'email'], 'kerbe
ros_endpoint': 'https://login.microsoftonline.com/ce3a67f2-5a22-4fb8-a511-815f8924cda6/kerberos', 'mtls_endpoint_a
liases': {'token_endpoint': 'https://mtlsauth.microsoft.com/ce3a67f2-5a22-4fb8-a511-815f8924cda6/oauth2/v2.0/token
'}, 'tls_client_certificate_bound_access_tokens': True, 'tenant_region_scope': 'NA', 'cloud_instance_name': 'micro
softonline.com', 'cloud_graph_host_name': 'graph.windows.net', 'msgraph_host': 'graph.microsoft.com', 'rbac_url':
'https://pas.windows.net'}
DEBUG:msal.application:Broker enabled? None
DEBUG:msal.application:Region to be used: None
DEBUG:msal.telemetry:Generate or reuse correlation_id: d117797d-706f-459b-a3cd-617dfb559105
DEBUG:apscheduler.scheduler:Looking for jobs to run
DEBUG:apscheduler.scheduler:Next wakeup is due at 2025-12-12 11:49:12.315796+05:30 (in 59.997113 seconds)
INFO:apscheduler.executors.default:Running job "check_all_regions (trigger: interval[0:01:00], next run at: 2025-1
2-12 11:49:12 IST)" (scheduled at 2025-12-12 11:48:12.315796+05:30)
INFO:__main__:Master lock acquired. Starting check_all_regions job.
INFO:alerts:Checking alerts for APAC server
DEBUG:alerts:[APAC] Fetching rejection data...
INFO:alerts:[APAC] Fetched 8 rejection records.
DEBUG:alerts:[APAC] Fetching alarm data...
INFO:alerts:[APAC] Fetched 10 alarm records.
INFO:alerts:[APAC] Database connection closed.
INFO:alerts:Location filter is active. Only processing emails for: {('apac', 'pune')}
INFO:alerts:Checking alerts for NAMER server
DEBUG:urllib3.connectionpool:https://login.microsoftonline.com:443 "POST /ce3a67f2-5a22-4fb8-a511-815f8924cda6/oau
th2/v2.0/token HTTP/1.1" 200 2037
DEBUG:msal.token_cache:event={
    "client_id": "6222d611-678e-4d57-a98b-83faa86fce76",
    "data": {
        "claims": null,
        "scope": [
            "https://graph.microsoft.com/.default"
        ]
    },
    "environment": "login.microsoftonline.com",
    "grant_type": "client_credentials",
    "params": null,
    "response": {
        "access_token": "********",
        "expires_in": 3599,
        "ext_expires_in": 3599,
        "token_type": "Bearer"
    },
    "scope": [
        "https://graph.microsoft.com/.default"
    ],
    "token_endpoint": "https://login.microsoftonline.com/ce3a67f2-5a22-4fb8-a511-815f8924cda6/oauth2/v2.0/token"
}
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): graph.microsoft.com:443
DEBUG:alerts:[NAMER] Fetching rejection data...
INFO:alerts:[NAMER] Fetched 0 rejection records.
DEBUG:alerts:[NAMER] Fetching alarm data...
INFO:alerts:[NAMER] Fetched 3 alarm records.
DEBUG:urllib3.connectionpool:https://graph.microsoft.com:443 "GET /v1.0/users/gsoc-globalsecurityoperationcenter.s
haredmailbox@westernunion.com/mailFolders/inbox/messages?$select=subject,from,toRecipients,ccRecipients,bccRecipie
nts,receivedDateTime,body,internetMessageHeaders&$top=5&$skip=0&$orderby=receivedDateTime%20desc HTTP/1.1" 200 Non
e
INFO:alerts:[NAMER] Database connection closed.
INFO:alerts:Location filter is active. Only processing emails for: {('apac', 'pune')}
INFO:alerts:Checking alerts for EMEA server
DEBUG:alerts:[EMEA] Fetching rejection data...
INFO:alerts:[EMEA] Fetched 5 rejection records.
DEBUG:alerts:[EMEA] Fetching alarm data...
DEBUG:log_handler:Queued email for logging: Your Verkada archive is complete
DEBUG:log_handler:Queued email for logging: Your Verkada archive is complete
INFO:alerts:[EMEA] Fetched 0 alarm records.
DEBUG:log_handler:Queued email for logging: Your Verkada archive is complete
DEBUG:log_handler:Queued email for logging: Your Verkada archive is complete
DEBUG:log_handler:Queued email for logging: Your Verkada archive is complete
INFO:alerts:[EMEA] Database connection closed.
INFO:alerts:Location filter is active. Only processing emails for: {('apac', 'pune')}
INFO:alerts:Checking alerts for LACA server
DEBUG:alerts:[LACA] Fetching rejection data...
INFO:alerts:[LACA] Fetched 0 rejection records.
DEBUG:alerts:[LACA] Fetching alarm data...
INFO:alerts:[LACA] Fetched 0 alarm records.
INFO:alerts:[LACA] Database connection closed.
INFO:alerts:Location filter is active. Only processing emails for: {('apac', 'pune')}
INFO:__main__:Finished check_all_regions job. Releasing master lock.
INFO:apscheduler.executors.default:Job "check_all_regions (trigger: interval[0:01:00], next run at: 2025-12-12 11:
49:12 IST)" executed successfully
DEBUG:__main__:Fetching count of sent emails
DEBUG:__main__:Fetching exception list
DEBUG:__main__:Fetching count of sent emails
DEBUG:__main__:Fetching exception list
DEBUG:apscheduler.scheduler:Looking for jobs to run
DEBUG:apscheduler.scheduler:Next wakeup is due at 2025-12-12 11:50:12.315796+05:30 (in 59.995172 seconds)
INFO:apscheduler.executors.default:Running job "check_all_regions (trigger: interval[0:01:00], next run at: 2025-1
2-12 11:50:12 IST)" (scheduled at 2025-12-12 11:49:12.315796+05:30)
INFO:__main__:Master lock acquired. Starting check_all_regions job.
INFO:alerts:Checking alerts for APAC server
DEBUG:alerts:[APAC] Fetching rejection data...
INFO:alerts:[APAC] Fetched 8 rejection records.
DEBUG:alerts:[APAC] Fetching alarm data...
INFO:alerts:[APAC] Fetched 10 alarm records.
INFO:alerts:[APAC] Database connection closed.
INFO:alerts:Location filter is active. Only processing emails for: {('apac', 'pune')}
INFO:alerts:Checking alerts for NAMER server
DEBUG:alerts:[NAMER] Fetching rejection data...
INFO:alerts:[NAMER] Fetched 0 rejection records.
DEBUG:alerts:[NAMER] Fetching alarm data...
INFO:alerts:[NAMER] Fetched 3 alarm records.
INFO:alerts:[NAMER] Database connection closed.
INFO:alerts:Location filter is active. Only processing emails for: {('apac', 'pune')}
INFO:alerts:Checking alerts for EMEA server
DEBUG:alerts:[EMEA] Fetching rejection data...
INFO:alerts:[EMEA] Fetched 5 rejection records.
DEBUG:alerts:[EMEA] Fetching alarm data...
INFO:alerts:[EMEA] Fetched 0 alarm records.
INFO:alerts:[EMEA] Database connection closed.
INFO:alerts:Location filter is active. Only processing emails for: {('apac', 'pune')}
INFO:alerts:Checking alerts for LACA server
DEBUG:alerts:[LACA] Fetching rejection data...
INFO:alerts:[LACA] Fetched 0 rejection records.
DEBUG:alerts:[LACA] Fetching alarm data...
INFO:alerts:[LACA] Fetched 0 alarm records.
INFO:alerts:[LACA] Database connection closed.
INFO:alerts:Location filter is active. Only processing emails for: {('apac', 'pune')}
INFO:__main__:Finished check_all_regions job. Releasing master lock.
INFO:apscheduler.executors.default:Job "check_all_regions (trigger: interval[0:01:00], next run at: 2025-12-12 11:
50:12 IST)" executed successfully
DEBUG:__main__:Fetching count of sent emails
DEBUG:__main__:Fetching exception list
DEBUG:__main__:Fetching count of sent emails
DEBUG:__main__:Fetching count of acknowledged emails
DEBUG:__main__:Fetching exception list
DEBUG:__main__:Fetching exception list
DEBUG:__main__:Fetching count of acknowledged emails
DEBUG:__main__:Fetching count of sent emails
DEBUG:__main__:Fetching count of sent emails
DEBUG:__main__:Fetching exception list
DEBUG:apscheduler.scheduler:Looking for jobs to run
DEBUG:apscheduler.scheduler:Next wakeup is due at 2025-12-12 11:51:12.315796+05:30 (in 59.993231 seconds)
INFO:apscheduler.executors.default:Running job "check_all_regions (trigger: interval[0:01:00], next run at: 2025-1
2-12 11:51:12 IST)" (scheduled at 2025-12-12 11:50:12.315796+05:30)
INFO:__main__:Master lock acquired. Starting check_all_regions job.
INFO:alerts:Checking alerts for APAC server
DEBUG:alerts:[APAC] Fetching rejection data...
INFO:alerts:[APAC] Fetched 8 rejection records.
DEBUG:alerts:[APAC] Fetching alarm data...
INFO:alerts:[APAC] Fetched 10 alarm records.
INFO:alerts:[APAC] Database connection closed.
INFO:alerts:Location filter is active. Only processing emails for: {('apac', 'pune')}
INFO:alerts:Checking alerts for NAMER server
DEBUG:alerts:[NAMER] Fetching rejection data...
INFO:alerts:[NAMER] Fetched 0 rejection records.
DEBUG:alerts:[NAMER] Fetching alarm data...
INFO:alerts:[NAMER] Fetched 3 alarm records.
INFO:alerts:[NAMER] Database connection closed.
INFO:alerts:Location filter is active. Only processing emails for: {('apac', 'pune')}
INFO:alerts:Checking alerts for EMEA server
DEBUG:alerts:[EMEA] Fetching rejection data...
INFO:alerts:[EMEA] Fetched 5 rejection records.
DEBUG:alerts:[EMEA] Fetching alarm data...
INFO:alerts:[EMEA] Fetched 0 alarm records.
INFO:alerts:[EMEA] Database connection closed.
INFO:alerts:Location filter is active. Only processing emails for: {('apac', 'pune')}
INFO:alerts:Checking alerts for LACA server
DEBUG:alerts:[LACA] Fetching rejection data...
INFO:alerts:[LACA] Fetched 0 rejection records.
DEBUG:alerts:[LACA] Fetching alarm data...
INFO:alerts:[LACA] Fetched 0 alarm records.
INFO:alerts:[LACA] Database connection closed.
INFO:alerts:Location filter is active. Only processing emails for: {('apac', 'pune')}
INFO:__main__:Finished check_all_regions job. Releasing master lock.
INFO:apscheduler.executors.default:Job "check_all_regions (trigger: interval[0:01:00], next run at: 2025-12-12 11:
51:12 IST)" executed successfully
DEBUG:__main__:Fetching count of sent emails
DEBUG:__main__:Fetching exception list
DEBUG:__main__:Fetching count of sent emails
DEBUG:__main__:Fetching exception list
DEBUG:apscheduler.scheduler:Looking for jobs to run
DEBUG:apscheduler.scheduler:Next wakeup is due at 2025-12-12 11:52:12.315796+05:30 (in 59.994284 seconds)
INFO:apscheduler.executors.default:Running job "check_all_regions (trigger: interval[0:01:00], next run at: 2025-1
2-12 11:52:12 IST)" (scheduled at 2025-12-12 11:51:12.315796+05:30)
INFO:__main__:Master lock acquired. Starting check_all_regions job.
INFO:alerts:Checking alerts for APAC server
DEBUG:alerts:[APAC] Fetching rejection data...
INFO:alerts:[APAC] Fetched 8 rejection records.
DEBUG:alerts:[APAC] Fetching alarm data...
INFO:alerts:[APAC] Fetched 10 alarm records.
INFO:alerts:[APAC] Database connection closed.
INFO:alerts:Location filter is active. Only processing emails for: {('apac', 'pune')}
INFO:alerts:Checking alerts for NAMER server
DEBUG:alerts:[NAMER] Fetching rejection data...
INFO:alerts:[NAMER] Fetched 0 rejection records.
DEBUG:alerts:[NAMER] Fetching alarm data...
INFO:alerts:[NAMER] Fetched 3 alarm records.
INFO:alerts:[NAMER] Database connection closed.
INFO:alerts:Location filter is active. Only processing emails for: {('apac', 'pune')}
INFO:alerts:Checking alerts for EMEA server
DEBUG:alerts:[EMEA] Fetching rejection data...
INFO:alerts:[EMEA] Fetched 5 rejection records.
DEBUG:alerts:[EMEA] Fetching alarm data...
INFO:alerts:[EMEA] Fetched 0 alarm records.
INFO:alerts:[EMEA] Database connection closed.
INFO:alerts:Location filter is active. Only processing emails for: {('apac', 'pune')}
INFO:alerts:Checking alerts for LACA server
DEBUG:alerts:[LACA] Fetching rejection data...
INFO:alerts:[LACA] Fetched 0 rejection records.
DEBUG:alerts:[LACA] Fetching alarm data...
INFO:alerts:[LACA] Fetched 0 alarm records.
INFO:alerts:[LACA] Database connection closed.
INFO:alerts:Location filter is active. Only processing emails for: {('apac', 'pune')}
INFO:__main__:Finished check_all_regions job. Releasing master lock.
INFO:apscheduler.executors.default:Job "check_all_regions (trigger: interval[0:01:00], next run at: 2025-12-12 11:
52:12 IST)" executed successfully










PS D:\Email Automation\backend-arun> $api_key = "1b9d6bcd-bbfd-4b2d-9b5d-ab8dfbbd4bed"   # replace if different
>> Invoke-RestMethod -Uri "http://127.0.0.1:5000/email/inbox?top=5" -Headers @{"X-API-Key"=$api_key} -Method GET -
TimeoutSec 30 | ConvertTo-Json -Depth 4
>>
>>
{
    "emails":  [
                   {
                       "subject":  "Your Verkada archive is complete",
                       "from":  "no-reply@command.verkada.com",
                       "received_date":  "2025-12-12T05:44:45Z",
                       "email_id":  "e5a6f403-036b-4b40-ade9-0eddfddeb39a",
                       "body":  "Here\u0027s your archive from Nov 29, 2025, 3: 34: 09 PM. Your archive from Weste
rn Union is ready to view and download. View Archive KC7J-MQLJ-9AAM 13 S Elevator Lobby HQ Floor 13 Need Help? Con
tact Support © Copyright 2025 Verkada Inc. All\nZjQcmQRYFpfptBannerStart\nThis Message Is From an External Sender\
nThis message came from outside your organization.\nReport Suspicious\nZjQcmQRYFpfptBannerEnd\nHere\u0027s your ar
chive from Nov 29, 2025, 3:34:09 PM.\nYour archive from Western Union is ready to view and download.\nView Archive
\nKC7J-MQLJ-9AAM\n13 S Elevator Lobby\nHQ Floor 13\nNeed Help?\nContact Support\n© Copyright 2025 Verkada Inc. All
 rights reserved.",
                       "cc":  [

                              ],
                       "bcc":  [

                               ]
                   },
                   {
                       "subject":  "Your Verkada archive is complete",
                       "from":  "no-reply@command.verkada.com",
                       "received_date":  "2025-12-12T05:44:01Z",
                       "email_id":  "f0440e67-7c2f-46c1-923f-f113abcc9c89",
                       "body":  "Here\u0027s your archive from Nov 29, 2025, 3: 28: 17 PM. Your archive from Weste
rn Union is ready to view and download. View Archive KC7J-MQLJ-9AAM 13 S Elevator Lobby HQ Floor 13 Need Help? Con
tact Support © Copyright 2025 Verkada Inc. All\nZjQcmQRYFpfptBannerStart\nThis Message Is From an External Sender\
nThis message came from outside your organization.\nReport Suspicious\nZjQcmQRYFpfptBannerEnd\nHere\u0027s your ar
chive from Nov 29, 2025, 3:28:17 PM.\nYour archive from Western Union is ready to view and download.\nView Archive
\nKC7J-MQLJ-9AAM\n13 S Elevator Lobby\nHQ Floor 13\nNeed Help?\nContact Support\n© Copyright 2025 Verkada Inc. All
 rights reserved.",
                       "cc":  [

                              ],
                       "bcc":  [

                               ]
                   },
                   {
                       "subject":  "Your Verkada archive is complete",
                       "from":  "no-reply@command.verkada.com",
                       "received_date":  "2025-12-12T05:32:57Z",
                       "email_id":  "697267c8-efc4-4d01-a3a0-f08a356941d8",
                       "body":  "Here\u0027s your archive from Nov 29, 2025, 3: 28: 19 PM. Your archive from Weste
rn Union is ready to view and download. View Archive KC7J-MQLJ-9AAM 13 S Elevator Lobby HQ Floor 13 Need Help? Con
tact Support © Copyright 2025 Verkada Inc. All\nZjQcmQRYFpfptBannerStart\nThis Message Is From an External Sender\
nThis message came from outside your organization.\nReport Suspicious\nZjQcmQRYFpfptBannerEnd\nHere\u0027s your ar
chive from Nov 29, 2025, 3:28:19 PM.\nYour archive from Western Union is ready to view and download.\nView Archive
\nKC7J-MQLJ-9AAM\n13 S Elevator Lobby\nHQ Floor 13\nNeed Help?\nContact Support\n© Copyright 2025 Verkada Inc. All
 rights reserved.",
                       "cc":  [

                              ],
                       "bcc":  [

                               ]
                   },
                   {
                       "subject":  "Your Verkada archive is complete",
                       "from":  "no-reply@command.verkada.com",
                       "received_date":  "2025-12-12T05:31:53Z",
                       "email_id":  "7750d5f8-2772-4985-b3ef-fae95ed2b028",
                       "body":  "Here\u0027s your archive from Nov 29, 2025, 12: 27: 48 PM. Your archive from West
ern Union is ready to view and download. View Archive KC7J-MQLJ-9AAM 13 S Elevator Lobby HQ Floor 13 Need Help? Co
ntact Support © Copyright 2025 Verkada Inc. All\nZjQcmQRYFpfptBannerStart\nThis Message Is From an External Sender
\nThis message came from outside your organization.\nReport Suspicious\nZjQcmQRYFpfptBannerEnd\nHere\u0027s your a
rchive from Nov 29, 2025, 12:27:48 PM.\nYour archive from Western Union is ready to view and download.\nView Archi
ve\nKC7J-MQLJ-9AAM\n13 S Elevator Lobby\nHQ Floor 13\nNeed Help?\nContact Support\n© Copyright 2025 Verkada Inc. A
ll rights reserved.",
                       "cc":  [

                              ],
                       "bcc":  [

                               ]
                   },
                   {
                       "subject":  "Your Verkada archive is complete",
                       "from":  "no-reply@command.verkada.com",
                       "received_date":  "2025-12-12T05:17:11Z",
                       "email_id":  "9fbe6a72-4695-4876-b15a-4d6463f41893",
                       "body":  "Here\u0027s your archive from Nov 24, 2025, 7: 43: 27 AM. Your archive from Weste
rn Union is ready to view and download. View Archive KC7J-MQLJ-9AAM 13 S Elevator Lobby HQ Floor 13 Need Help? Con
tact Support © Copyright 2025 Verkada Inc. All\nZjQcmQRYFpfptBannerStart\nThis Message Is From an External Sender\
nThis message came from outside your organization.\nReport Suspicious\nZjQcmQRYFpfptBannerEnd\nHere\u0027s your ar
chive from Nov 24, 2025, 7:43:27 AM.\nYour archive from Western Union is ready to view and download.\nView Archive
\nKC7J-MQLJ-9AAM\n13 S Elevator Lobby\nHQ Floor 13\nNeed Help?\nContact Support\n© Copyright 2025 Verkada Inc. All
 rights reserved.",
                       "cc":  [

                              ],
                       "bcc":  [

                               ]
                   }
               ],
    "total":  5,
    "top":  5,
    "skip":  0,
    "folder":  "inbox",
    "has_more":  true
}
PS D:\Email Automation\backend-arun> Get-Content .\log_file.log -Wait -Tail 200
>>
2025-09-01 17:20:25,801 - __main__ - INFO - Displayed 137 records from email_logs table.















